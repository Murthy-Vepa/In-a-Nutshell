<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Azure Service Bus - In a Nutshell</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 18 18'%3E%3Cdefs%3E%3ClinearGradient id='bbd02878-309a-4490-8196-946338d0f593' x1='8.995' y1='10.299' x2='8.995' y2='13.199' gradientUnits='userSpaceOnUse'%3E%3Cstop offset='0' stop-color='%23005ba1'/%3E%3Cstop offset='0.258' stop-color='%2300589d'/%3E%3Cstop offset='0.525' stop-color='%23004f90'/%3E%3Cstop offset='0.796' stop-color='%23003f7c'/%3E%3Cstop offset='1' stop-color='%23003067'/%3E%3C/linearGradient%3E%3C/defs%3E%3Cg%3E%3Cg id='b532e600-3623-4be6-9fa6-30d05fff56b1'%3E%3Cpolygon points='13.387 7.4 13.382 7.396 13.382 7.384 13.363 7.384 8.997 4.405 4.631 7.384 4.612 7.384 4.612 7.396 4.606 7.4 4.612 7.4 4.612 13.201 13.382 13.201 13.382 7.4 13.387 7.4' fill='%2350e6ff'/%3E%3Cpath d='M4.606,7.4c0-.1.008,5.681.008,5.8L8.995,10.3Z' fill='%2332bedd'/%3E%3Cpath d='M13.384,7.4,8.995,10.3,13.376,13.2C13.376,13.083,13.384,7.3,13.384,7.4Z' fill='%23198ab3'/%3E%3Cpolygon points='8.995 10.299 4.614 13.194 4.614 13.199 13.376 13.199 13.376 13.194 8.995 10.299' fill='url(%23bbd02878-309a-4490-8196-946338d0f593)'/%3E%3Cg%3E%3Cpath d='M1.072,1.43h1.29a0,0,0,0,1,0,0v3.6a.286.286,0,0,1-.286.286H.786A.286.286,0,0,1,.5,5.035V2A.572.572,0,0,1,1.072,1.43Z' fill='%23999'/%3E%3Cpath d='M1.072,1.43h1.29a0,0,0,0,1,0,0v3.6a.286.286,0,0,1-.286.286H.786A.286.286,0,0,1,.5,5.035V2A.572.572,0,0,1,1.072,1.43Z' fill='%23999' opacity='0.5'/%3E%3C/g%3E%3Cg%3E%3Cpath d='M15.638,1.43h1.29A.572.572,0,0,1,17.5,2V5.035a.286.286,0,0,1-.286.286h-1.29a.286.286,0,0,1-.286-.286V1.43A0,0,0,0,1,15.638,1.43Z' fill='%23999'/%3E%3Cpath d='M15.638,1.43h1.29A.572.572,0,0,1,17.5,2V5.035a.286.286,0,0,1-.286.286h-1.29a.286.286,0,0,1-.286-.286V1.43A0,0,0,0,1,15.638,1.43Z' fill='%23999' opacity='0.5'/%3E%3C/g%3E%3Cpath d='M8.66-6.163H9.907a0,0,0,0,1,0,0v17a0,0,0,0,1,0,0H8.66a.567.567,0,0,1-.567-.567V-5.6A.567.567,0,0,1,8.66-6.163Z' transform='translate(11.337 -6.663) rotate(90)' fill='%23949494'/%3E%3Cg%3E%3Cpath d='M.786,12.679h1.29a.286.286,0,0,1,.286.286v3.6a0,0,0,0,1,0,0H1.072A.572.572,0,0,1,.5,16V12.965A.286.286,0,0,1,.786,12.679Z' fill='%23999'/%3E%3Cpath d='M.786,12.679h1.29a.286.286,0,0,1,.286.286v3.6a0,0,0,0,1,0,0H1.072A.572.572,0,0,1,.5,16V12.965A.286.286,0,0,1,.786,12.679Z' fill='%23999' opacity='0.5'/%3E%3C/g%3E%3Cg%3E%3Cpath d='M15.924,12.679h1.29a.286.286,0,0,1,.286.286V16a.572.572,0,0,1-.572.572h-1.29a0,0,0,0,1,0,0v-3.6A.286.286,0,0,1,15.924,12.679Z' fill='%23999'/%3E%3Cpath d='M15.924,12.679h1.29a.286.286,0,0,1,.286.286V16a.572.572,0,0,1-.572.572h-1.29a0,0,0,0,1,0,0v-3.6A.286.286,0,0,1,15.924,12.679Z' fill='%23999' opacity='0.5'/%3E%3C/g%3E%3Cpath d='M8.66,7.163H9.907a0,0,0,0,1,0,0v17a0,0,0,0,1,0,0H8.66a.567.567,0,0,1-.567-.567V7.73A.567.567,0,0,1,8.66,7.163Z' transform='translate(-6.663 24.663) rotate(-90)' fill='%23949494'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E" />
<meta name="description" content="A comprehensive guide to Azure Service Bus." />
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root{
      --bg: #ffffff;
      --fg: #0f172a;
      --muted: #64748b;
      --accent: #3b82f6;
      --accent-light: #dbeafe;
      --border: #e2e8f0;
      --sidebar-bg: #ffffff;
      --sidebar-fg: #0f172a;
      --code-bg: linear-gradient(90deg, rgba(59, 130, 246, 0.08) 0%, rgba(59, 130, 246, 0.12) 100%);
      --focus: #10b981;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
      --shadow-md: 0 4px 6px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.06);
      --shadow-lg: 0 10px 20px rgba(0,0,0,0.12), 0 6px 6px rgba(0,0,0,0.08);
      --gradient: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    }
    
    /* Bootstrap Gradient Utility Classes */
    .bg-gradient-blue { background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%) !important; }
    .bg-gradient-green { background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%) !important; }
    .bg-gradient-yellow { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%) !important; }
    .bg-gradient-pink { background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%) !important; }
    .bg-gradient-purple { background: linear-gradient(135deg, #e9d5ff 0%, #d8b4fe 100%) !important; }
    .bg-gradient-teal { background: linear-gradient(135deg, #ccfbf1 0%, #99f6e4 100%) !important; }
    .bg-gradient-blue-dark { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%) !important; }
    .bg-gradient-gray { background: linear-gradient(135deg, #64748b 0%, #475569 100%) !important; }
    .bg-gradient-purple-dark { background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%) !important; }
    .bg-gradient-teal-dark { background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%) !important; }
    .bg-gradient-green-dark { background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important; }
    .bg-gradient-red { background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%) !important; }
    .bg-gradient-green-light { background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%) !important; }
    .bg-gradient-blue-sky { background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%) !important; }
    .bg-gradient-red-dark { background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%) !important; }
    .bg-gradient-indigo { background: linear-gradient(135deg, #4f46e5 0%, #4338ca 100%) !important; }
    .bg-gradient-green-medium { background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important; }
    .bg-gradient-orange { background: linear-gradient(135deg, #f97316 0%, #ea580c 100%) !important; }
    .bg-gradient-violet { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%) !important; }
    .bg-gradient-lime { background: linear-gradient(135deg, #84cc16 0%, #65a30d 100%) !important; }
    .bg-gradient-sky { background: linear-gradient(135deg, #0284c7 0%, #0369a1 100%) !important; }
    
    /* Apply theme colors to Bootstrap elements */
    body { background-color: var(--bg); color: var(--fg); overflow: hidden; }
    .navbar { background-color: var(--fg) !important; border-bottom: none !important; box-shadow: var(--shadow-md) !important; }
    .navbar-brand { cursor: pointer; color: var(--bg) !important; font-weight: 600; letter-spacing: 0px; }
    .navbar-toggler-icon { 
      filter: invert(1);
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%2896, 165, 250, 0.9%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
    }
    
    .btn-outline-secondary { border-color: var(--border) !important; color: var(--fg) !important; }
    .btn-outline-secondary:hover { background-color: var(--accent-light) !important; border-color: var(--accent) !important; color: var(--accent) !important; }
    
    /* Sidebar - Modern Design */
    nav.sidebar { 
      background: linear-gradient(180deg, #f3f4f6 0%, #e5e7eb 100%); 
      border-right: 1px solid rgba(0, 0, 0, 0.05) !important;  
      overflow-y: auto; 
      box-shadow: 4px 0 16px rgba(0, 0, 0, 0.06);
      padding-top: 0;
    }
    
    .menu-header {  
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.15), rgba(0, 0, 0, 0.1) 100%);
      font-weight: bold; 
      padding: 1.25rem 1.25rem; 
      letter-spacing: 0px; 
      font-size: 1.1rem;
      position: relative;
      overflow: hidden;
      border: none;
      border-bottom: 2px solid #a5aab3;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.12);
      color: #0c346c;
      text-shadow: none;
      margin: 0;
      text-transform: none;
    }
    .menu-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);
      transition: left 0.6s ease;
    }
    .menu-header:hover::before {
      left: 100%;
    }
    .menu-header::after {
      content: 'üìã';
      position: absolute;
      right: 1.5rem;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1.3rem;
      opacity: 0.9;
      filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.2));
    }
    
    .toc { 
      list-style: none; 
      padding: 0rem 0; 
      margin: 0; 
      background: transparent;
    }
    .toc li { 
      margin: 0; 
    }
    
    /* Section grouping */
    .toc li[data-group="overview"] { margin-bottom: 0.75rem; }
    .toc li[data-group="solid"]:first-of-type { 
      margin-top: 1rem; 
      border-top: 2px solid rgba(59, 130, 246, 0.15);
      padding-top: 1rem;
    }
    .toc li[data-group="other-principles"]:first-of-type { 
      margin-top: 1rem; 
      border-top: 2px solid rgba(16, 185, 129, 0.15);
      padding-top: 1rem;
    }
    .toc li[data-group="resources"] { 
      margin-top: 1rem; 
      border-top: 2px solid rgba(100, 116, 139, 0.15);
      padding-top: 1rem;
    }
    
    .list-group-item { 
      background: transparent; 
      border-color: transparent; 
      padding: 0; 
      margin: 0.25rem 0.75rem; 
      border-radius: 0rem;
      transition: all 0.2s ease;
    }
    .list-group-item a { 
      color: #1f2937; 
      text-decoration: none; 
      display: flex; 
      flex-direction: column; 
      align-items: flex-start; 
      gap: 0.4rem; 
      border-left: 3px solid transparent; 
      padding: 0.85rem 1.25rem; 
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
      font-weight: 500; 
      border-radius: 0rem;
      font-size: 0.95rem;
      position: relative;
      overflow: hidden;
      background: linear-gradient(90deg, rgba(255, 255, 255, 0.4) 0%, rgba(255, 255, 255, 0.1) 100%);
      border: 1px solid rgba(0, 0, 0, 0.06);
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }
    .list-group-item a::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 4px;
      background: linear-gradient(180deg, #3b82f6 0%, #2563eb 100%);
      transform: scaleY(0);
      transition: transform 0.3s ease;
      border-radius: 0 0px 0px 0;
    }
    .list-group-item a::after {
      content: '‚ñ∂';
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%) scale(0.7);
      font-size: 0.7rem;
      color: #9ca3af;
      opacity: 0;
      transition: all 0.3s ease;
    }
    .list-group-item a:hover { 
      background: linear-gradient(90deg, rgba(59, 130, 246, 0.15) 0%, rgba(59, 130, 246, 0.08) 100%); 
      border-left-color: transparent;
      color: #1e40af;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2), 0 2px 4px rgba(0, 0, 0, 0.08);
      border-color: rgba(59, 130, 246, 0.2);
      text-decoration: none;
    }
    .list-group-item a:hover::before {
      transform: scaleY(1);
    }
    .list-group-item a:hover::after {
      opacity: 1;
      transform: translateY(-50%) scale(1);
      color: #3b82f6;
    }
    .list-group-item a.active { 
      background: linear-gradient(90deg, rgba(59, 130, 246, 0.22) 0%, rgba(59, 130, 246, 0.12) 100%); 
      color: #1e40af; 
      font-weight: 600; 
      border-left-color: transparent;
      box-shadow: 0 4px 16px rgba(59, 130, 246, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.3);
      border-color: rgba(59, 130, 246, 0.3);
    }
    .list-group-item a.active::before {
      transform: scaleY(1);
      background: linear-gradient(180deg, #3b82f6 0%, #2563eb 100%);
      width: 5px;
      box-shadow: 0 0 8px rgba(59, 130, 246, 0.5);
    }
    .list-group-item a.active::after {
      opacity: 1;
      color: #2563eb;
      transform: translateY(-50%) scale(1);
    }
    .list-group-item a.active:hover { 
      background: linear-gradient(90deg, rgba(59, 130, 246, 0.28) 0%, rgba(59, 130, 246, 0.16) 100%); 
      box-shadow: 0 6px 20px rgba(59, 130, 246, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.4);
    }
    
    /* Sub-items tree connectors */
    .list-group-sub-item a::before { 
      content: '‚îú‚îÄ';
      font-size: 0.85rem;
      margin-right: 0.5rem;
      color: #6b7280;
      z-index: 1;
      position: relative;
    }
    
    /* Sub-items styling - similar to main items but smaller and indented */
    .list-group-sub-item {
      background: transparent; 
      border-color: transparent; 
      padding: 0px; 
      margin: 0.2rem 0.75rem 0.2rem 1.5rem;
      border-radius: 0rem;
      transition: all 0.2s ease;
      position: relative;
      list-style-type: none;
    }
    .list-group-sub-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 4px;
      background: linear-gradient(180deg, #3b82f6 0%, #2563eb 100%);
      transform: scaleY(0);
      transition: transform 0.3s ease;
      border-radius: 0 0px 0px 0;
      z-index: 1;
    }
    .list-group-sub-item a {
      color: #1f2937; 
      text-decoration: none; 
      display: block;
      border-left: 3px solid transparent; 
      padding: 0.65rem 1rem 0.65rem 2.00rem;
      transition: all 0.2s ease; 
      font-weight: 500; 
      border-radius: 0rem;
      font-size: 0.8125rem;
      line-height: 1.4;
      position: relative;
      overflow: hidden;
      background: rgba(255, 255, 255, 0.5);
      border: 1px solid rgba(0, 0, 0, 0.04);
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
    }
    
    /* Sub-items hover and active states - same as main items */
    .list-group-sub-item a::after {
      content: '‚ñ∂';
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%) scale(0.7);
      font-size: 0.7rem;
      color: #9ca3af;
      opacity: 0;
      transition: all 0.3s ease;
    }
    
    .list-group-sub-item:hover::before {
      transform: scaleY(1);
    }
    .list-group-sub-item a:hover { 
      background: linear-gradient(90deg, rgba(59, 130, 246, 0.15) 0%, rgba(59, 130, 246, 0.08) 100%); 
      border-left-color: transparent;
      color: #1e40af;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2), 0 2px 4px rgba(0, 0, 0, 0.08);
      border-color: rgba(59, 130, 246, 0.2);
      text-decoration: none;
    }
    .list-group-sub-item a:hover::after {
      opacity: 1;
      transform: translateY(-50%) scale(1);
      color: #3b82f6;
    }
    
    .list-group-sub-item.active::before {
      transform: scaleY(1);
      width: 5px;
      box-shadow: 0 0 8px rgba(59, 130, 246, 0.5);
    }
    .list-group-sub-item a.active { 
      background: linear-gradient(90deg, rgba(59, 130, 246, 0.22) 0%, rgba(59, 130, 246, 0.12) 100%); 
      color: #1e40af; 
      font-weight: 600; 
      border-left-color: transparent;
      box-shadow: 0 4px 16px rgba(59, 130, 246, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.3);
      border-color: rgba(59, 130, 246, 0.3);
    }
    .list-group-sub-item a.active::after {
      opacity: 1;
      color: #2563eb;
      transform: translateY(-50%) scale(1);
    }
    .list-group-sub-item a.active:hover { 
      background: linear-gradient(90deg, rgba(59, 130, 246, 0.28) 0%, rgba(59, 130, 246, 0.16) 100%); 
      box-shadow: 0 6px 20px rgba(59, 130, 246, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.4);
    }
    
    .list-group-item a::after {
      content: '‚ñ∂';
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%) scale(0.7);
      font-size: 0.7rem;
      color: #9ca3af;
      opacity: 0;
      transition: all 0.3s ease;
    }
    
    .list-group-item a:hover { 
      background: linear-gradient(90deg, rgba(59, 130, 246, 0.15) 0%, rgba(59, 130, 246, 0.08) 100%); 
      border-left-color: transparent;
      color: #1e40af;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2), 0 2px 4px rgba(0, 0, 0, 0.08);
      border-color: rgba(59, 130, 246, 0.2);
      text-decoration: none;
    }
    .list-group-item a:hover::before {
      transform: scaleY(1);
    }
    .list-group-item a:hover::after {
      opacity: 1;
      transform: translateY(-50%) scale(1);
      color: #3b82f6;
    }
    .list-group-item a.active { 
      background: linear-gradient(90deg, rgba(59, 130, 246, 0.22) 0%, rgba(59, 130, 246, 0.12) 100%); 
      color: #1e40af; 
      font-weight: 600; 
      border-left-color: transparent;
      box-shadow: 0 4px 16px rgba(59, 130, 246, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.3);
      border-color: rgba(59, 130, 246, 0.3);
    }
    .list-group-item a.active::after {
      opacity: 1;
      color: #2563eb;
      transform: translateY(-50%) scale(1);
    }
    .list-group-item a.active:hover { 
      background: linear-gradient(90deg, rgba(59, 130, 246, 0.28) 0%, rgba(59, 130, 246, 0.16) 100%); 
      box-shadow: 0 6px 20px rgba(59, 130, 246, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.4);
    }
    
    /* Badge styling */
    .badge { font-size: 0.8rem; padding: 0.15rem 0.4rem; background: var(--accent-light); color: var(--accent); border: 1px solid var(--accent); font-weight: 600; border-radius: 0.25rem; font-style: normal; line-height: 1.2; opacity: 0.9; }
    .badge { background: var(--accent); color: white; border: none; font-size: 0.6rem; padding: 0.25rem 0.5rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; display: inline-block; margin-top: 0.5rem; margin-right: 0.35rem; }
    .list-group-item a:hover .badge { opacity: 1; background: var(--accent); color: white; }
    .list-group-item a.active .badge { background: rgba(255, 255, 255, 0.3); color: white; border-color: rgba(255, 255, 255, 0.6); font-weight: 600; opacity: 1; }
        
    /* Content */
    .content { width: 100%; max-width: 100%; margin: 0 auto; background: #ffffff; padding: 2rem; border-radius: 0.75rem; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); }
    section { display: none !important; margin-bottom: 2rem; }
    section.active { display: block !important; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    
    h1 { font-size: 2rem; font-weight: 700; margin: 1rem 0 0.25rem 0; letter-spacing: -0.5px; color: var(--fg); display: block; border: none; }
    h2 { font-size: 1.5rem; font-weight: 600; margin: 1.5rem 0 0.75rem 0; color: var(--fg); border-bottom: 2px solid var(--accent-light); padding-bottom: 0.5rem; }
    h3 { font-size: 1.1rem; color: var(--accent); font-weight: 600; margin: 1rem 0 0.5rem 0; }
    h4 { font-size: 0.8rem; color: var(--fg); font-weight: 600; margin: 0.75rem 0 0.4rem 0; }
    p { margin: 1rem 0; line-height: 1.65; color: var(--fg); }
    ul, ol { margin: 1rem 0; padding-left: 2rem; }
    li { margin: 0.5rem 0; color: var(--fg); }
    
    code { background: var(--code-bg); border: 1px solid var(--border); padding: 0.2rem 0.5rem; font-family: ui-monospace, 'Cascadia Code', 'Source Code Pro', monospace; font-size: 0.9em; color: var(--accent); border-radius: 0.5rem; }
    pre { background: var(--code-bg); border: 0px solid var(--border); padding: 1rem; border-radius: 0.5rem; overflow: auto; box-shadow: var(--shadow-sm); margin: 1rem 0; }
    pre code { padding: 0; background: transparent; border: none; color: var(--fg); }
    
    .callout { border-left: 5px solid var(--accent); background: var(--accent-light); padding: 1rem 1.2rem; margin: 1.5rem 0; border-radius: 0.5rem; box-shadow: var(--shadow-sm); font-weight: 500; color: var(--fg); }
    
    /* Table styling */
    .table { color: var(--fg); }
    .table thead th { background: var(--accent-light); color: var(--accent); border-color: var(--border); font-weight: 600; }
    .table tbody td { border-color: var(--border); }
    .table-striped tbody tr:nth-of-type(odd) { background-color: rgba(0,0,0,0.02); }
    .table-striped tbody tr:hover { background-color: var(--accent-light); }
    
    /* Controls/Pagination */
    .controls { opacity: 0.5; position: fixed; bottom: 0.25rem; right: 1rem; width: auto; z-index: 1000; background: transparent; display: flex; align-items: center; justify-content: center; gap: 0rem; padding: 0; min-height: 40px; }
    @media (max-width: 991px) {
      .controls { bottom: 0.25rem; right: 1rem; }
      .menu-header { color: var(--focus); }
    }
    .controls:hover { opacity: 1; }
    
    .page-indicator { color: var(--accent); font-weight: 600; font-size: 0.875rem; }
    .btn-group .btn { margin: 0px 2px; padding: 0.2rem 0.5rem; background: var(--accent); color: white; border-color: var(--accent); font-size: 1rem; font-weight: bold; }
    .btn-group .btn:hover { background: var(--accent); }
    .btn-group .btn + .btn { margin-left: -1px; }
    
    /* Mobile/Offcanvas */
    .offcanvas { background: var(--bg) !important; }
    .offcanvas-header { border-bottom: 1px solid var(--border); }
    .offcanvas-title { color: var(--fg); font-weight: 600; }
    .btn-close { color: var(--fg); }
    
    /* Scrollbar */
    nav.sidebar::-webkit-scrollbar { width: 6px; }
    nav.sidebar::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.05); }
    nav.sidebar::-webkit-scrollbar-thumb { background: rgba(0, 0, 0, 0.2); border-radius: 0px; }
    nav.sidebar::-webkit-scrollbar-thumb:hover { background: rgba(0, 0, 0, 0.3); }
    
    /* Mermaid Diagrams */
    .mermaid {
      background: #ffffff;
      border: 1px solid #e2e8f0;
      border-radius: 0.5rem;
      padding: 2rem;
      margin: 1.5rem 0;
      min-height: 400px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: visible;
      position: relative;
    }
    .mermaid.rendered {
      min-height: 0;
    }
    .mermaid svg {
      max-width: 100%;
      height: auto;
      min-height: 300px;
      transition: transform 0.3s ease;
      transform-origin: center center;
    }
    .mermaid.zoomed {
      overflow: auto;
      cursor: grab;
    }
    .mermaid.zoomed:active {
      cursor: grabbing;
    }
    .mermaid svg text {
      font-size: 14px !important;
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif !important;
    }
    
    /* Mermaid title styling */
    .mermaid svg text, .diagram-modal-content svg text {
      font-size: 1rem !important;
      font-weight: bold !important;
      fill: var(--fg) !important;
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif !important;
    }

    .mermaid svg *
    {
        color: #333;
    }

    .mermaid[data-processed="true"] {
      min-height: 0;
    }
    
    .mermaid svg {
      max-width: 100%;
      height: auto;
      display: inline-block;
    }
    
    /* Zoom controls */
    .zoom-controls {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 10;
      opacity: 0.5;
      transition: opacity 0.3s ease;
    }
    .mermaid:hover .zoom-controls {
      opacity: 1;
    }
    .zoom-btn {
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 0.25rem;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      transition: all 0.2s ease;
    }
    .zoom-btn:hover {
      background: #2563eb;
      transform: scale(1.1);
    }

    /* Modal for diagram zoom */
    .diagram-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.95);
      z-index: 9999;
      align-items: center;
      justify-content: center;
      padding: 0;
    }
    .diagram-modal.active {
      display: flex;
    }
    .diagram-modal-content {
      position: relative;
      width: 100%;
      height: 100%;
      background: white;
      border-radius: 0;
      padding: 3rem 3rem 3rem 3rem;
      overflow: auto;
      display: flex;
      align-items: flex-start;
      justify-content: center;
    }
    .diagram-modal-content svg {
      max-width: 100%;
      height: auto;
    }
    .modal-close {
      position: fixed;
      top: 1.5rem;
      right: 1.5rem;
      background: #ef4444;
      color: white;
      border: none;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      transition: all 0.2s ease;
      z-index: 10000;
    }
    .modal-close:hover {
      background: #dc2626;
      transform: scale(1.1);
    }
    .modal-zoom-controls {
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      display: flex;
      gap: 0.5rem;
      z-index: 10000;
      padding: 0rem;
      border-radius: 0.4rem;
    }
    .modal-zoom-btn {
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 0.25rem;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      transition: all 0.2s ease;
    }
    .modal-zoom-btn:hover {
      background: #2563eb;
      transform: scale(1.1);
    }
    
    /* Utilities */
    .search { height: 0; overflow: hidden; padding: 0 !important; }
    .search input { display: none; }
    .min-vh-100 { min-height: 100vh; }
    .skip-link { position: absolute; left: -9999px; top: auto; width: 1px; height: 1px; overflow: hidden; }
    .skip-link:focus { position: static; width: auto; height: auto; padding: 0.4rem 0.6rem; background: var(--accent); color: white; border-radius: 0.4rem; }
    
    /* Override Bootstrap defaults for theme */
    a { color: var(--accent); }
    a:hover { color: var(--accent); text-decoration: underline; }
    
    /* Responsive - keep sidebar visible on desktop, offcanvas on mobile */
    @media (max-width: 991px) {
      nav.sidebar { display: none; }
      #main { width: 100%; }
      .row { --bs-gutter-x: 0; }
    }
    
    /* Layout - prevent unnecessary scrolling */
    html, body { height: 100%; margin: 0; }
    #appContainer { display: flex; flex-direction: column; height: calc(100vh - 50px); }
    #mainRow { flex: 1; overflow: hidden; display: flex; }
    nav.sidebar { overflow-y: auto; max-height: 100%; position: relative; padding-bottom: 0px; }
    #main { overflow: hidden; display: flex; flex-direction: column; height: 100%; -webkit-tap-highlight-color: transparent; outline: none; border: none; }
    #main:focus { outline: none; }
    .content { overflow-y: auto; flex: 1; width: 100%; min-height: 0; padding: 0rem 1.5rem 0rem 1.5rem; }
    
    /* Contact Info */
    .contact-info {
      font-weight: 400 !important;
      padding: 0.5rem 0.75rem;
      font-size: 0.75rem;
      color: var(--accent-light);
      margin: 0;
      opacity: 0.5;
      white-space: nowrap;
      cursor: pointer;
    }
    .contact-info:hover {
      opacity: 0.9;
      text-decoration: none;
    }
    @media (max-width: 991px) {
      .navbar-brand {
        font-size: 1rem !important;
        flex: 1;
      }
      .contact-info {
        font-size: 0.7rem;
        padding: 0.25rem 0.5rem;
      }
    }
    @media (max-width: 576px) {
      .navbar-brand {
        font-size: 0.9rem !important;
      }
      .contact-info {
        font-size: 0.65rem;
        padding: 0.2rem 0.4rem;
      }
    }

    .list-style-none {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    /* JSON Syntax Highlighting */
    pre code.language-json {
      display: block;
      white-space: pre;
      font-family: 'Cascadia Code', 'Consolas', 'Monaco', 'Courier New', monospace;
    }

    pre code.language-json .json-key {
      color: #0451a5;
      font-weight: 500;
    }

    pre code.language-json .json-string {
      color: #a31515;
    }

    pre code.language-json .json-number {
      color: #098658;
    }

    pre code.language-json .json-boolean {
      color: #0000ff;
      font-weight: 600;
    }

    pre code.language-json .json-null {
      color: #0000ff;
      font-weight: 600;
    }

    pre code.language-json .json-punctuation {
      color: #333;
    }

    /* SQL Syntax Highlighting */
    pre code.language-sql {
      display: block;
      white-space: pre;
      font-family: 'Cascadia Code', 'Consolas', 'Monaco', 'Courier New', monospace;
    }

    pre code.language-sql .sql-keyword {
      color: #0000ff;
      font-weight: 600;
      text-transform: uppercase;
    }

    pre code.language-sql .sql-string {
      color: #a31515;
    }

    pre code.language-sql .sql-number {
      color: #098658;
    }

    pre code.language-sql .sql-comment {
      color: #008000;
      font-style: italic;
    }

    pre code.language-sql .sql-function {
      color: #795e26;
      font-weight: 500;
    }

    pre code.language-sql .sql-operator {
      color: #666;
      font-weight: 500;
    }

    /* Language Label for Code Blocks */
    pre[data-language]::before {
      content: attr(data-language);
      position: absolute;
      top: 8px;
      right: 12px;
      font-size: 0.75em;
      color: #6a737d;
      text-transform: uppercase;
      font-weight: 600;
      letter-spacing: 0.5px;
      background: var(--bg);
      padding: 0.2rem 0.5rem;
      border-radius: 0.25rem;
      border: 1px solid var(--border);
    }

    /* Enhanced pre/code styling for syntax highlighted blocks */
    pre.syntax-highlighted {
      position: relative;
      background: var(--code-bg);
      border: 1px solid var(--border);
      padding: 1.5rem 1rem 1rem 1rem;
      border-radius: 0.5rem;
      overflow-x: auto;
      box-shadow: var(--shadow-sm);
      margin: 1rem 0;
    }

    pre.syntax-highlighted code {
      background: transparent;
      padding: 0;
      border: none;
      color: var(--fg);
      font-size: 0.875rem;
      line-height: 1.6;
    }

    ul
    {
        list-style-type: none;
    }
  /* Document Footer */
    .document-footer {
      text-align: center;
      padding: 20px;
      background-color: #f8f9fa;
      border-radius: 8px;
      margin-top: 20px;
    }
    .document-footer p {
      margin: 0;
      font-size: 14px;
      color: #6c757d;
      line-height: 1.6;
    }
    .document-footer strong {
      color: #495057;
    }  
  </style>
  <!-- Mermaid.js for diagrams -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
  <script>
    // Initialize Mermaid with proper configuration
    document.addEventListener('DOMContentLoaded', function() {

      mermaid.initialize({
        startOnLoad: false,
        theme: 'base',
        securityLevel: 'loose',
        logLevel: 'error',
        flowchart: {
          useMaxWidth: true,
          htmlLabels: true,
          curve: 'basis',
        },
        sequence: {
          useMaxWidth: false,
          htmlLabels: true,
          diagramMarginX: 50,
          diagramMarginY: 10
        }
      });
      
      // Render all diagrams
      renderMermaidDiagrams();
    });
    
    async function renderMermaidDiagrams() {
      const diagrams = document.querySelectorAll('.mermaid');
      
      for (let i = 0; i < diagrams.length; i++) {
        const diagram = diagrams[i];
        const code = diagram.textContent.trim();
        
        // Store original code
        if (!diagram.hasAttribute('data-original-code')) {
          diagram.setAttribute('data-original-code', code);
        }
        
        try {
          const { svg } = await mermaid.render('mermaid-diagram-' + i, code);
          diagram.innerHTML = svg;
          diagram.setAttribute('data-processed', 'true');
          
          // Add zoom controls
          addZoomControls(diagram);
        } catch (error) {
          console.error('Mermaid rendering error for diagram ' + i + ':', error);
          diagram.innerHTML = '<div style="color: red; padding: 1rem; border: 2px solid red; border-radius: 0.5rem;">Error rendering diagram: ' + error.message + '</div>';
        }
      }
    }
    
    // Add zoom controls to mermaid diagrams
    function addZoomControls(diagram) {
      const controls = document.createElement('div');
      controls.className = 'zoom-controls';
      controls.innerHTML = `
        <button class="zoom-btn" data-action="expand" title="Expand View">‚õ∂</button>
      `;
      
      diagram.style.position = 'relative';
      diagram.insertBefore(controls, diagram.firstChild);
      
      // Expand to modal
      controls.addEventListener('click', (e) => {
        const btn = e.target.closest('.zoom-btn');
        if (!btn) return;
        
        openDiagramModal(diagram);
      });
    }

    // Open diagram in modal
    function openDiagramModal(diagram) {
      // Create modal if it doesn't exist
      let modal = document.getElementById('diagram-modal');
      if (!modal) {
        modal = document.createElement('div');
        modal.id = 'diagram-modal';
        modal.className = 'diagram-modal';
        modal.innerHTML = `
          <button class="modal-close" id="modal-close">√ó</button>
          <div class="diagram-modal-content" id="modal-diagram-content"></div>
          <div class="modal-zoom-controls">
            <button class="modal-zoom-btn" data-action="zoom-in" title="Zoom In">+</button>
            <button class="modal-zoom-btn" data-action="zoom-out" title="Zoom Out">‚àí</button>
            <button class="modal-zoom-btn" data-action="reset" title="Reset Zoom">‚ü≤</button>
          </div>
        `;
        document.body.appendChild(modal);
        
        // Close modal handlers
        modal.querySelector('#modal-close').addEventListener('click', closeDiagramModal);
        modal.addEventListener('click', (e) => {
          if (e.target === modal) closeDiagramModal();
        });
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && modal.classList.contains('active')) {
            closeDiagramModal();
          }
        });
        
        // Zoom controls in modal
        let scale = 1;
        let translateX = 0;
        let translateY = 0;
        
        modal.querySelector('.modal-zoom-controls').addEventListener('click', (e) => {
          const btn = e.target.closest('.modal-zoom-btn');
          if (!btn) return;
          
          const action = btn.dataset.action;
          const svg = modal.querySelector('svg');
          if (!svg) return;
          
          if (action === 'zoom-in') {
            scale = Math.min(scale + 0.1, 5);
          } else if (action === 'zoom-out') {
            scale = Math.max(scale - 0.1, 0.5);
          } else if (action === 'reset') {
            scale = 1;
            translateX = 0;
            translateY = 0;
          }
          
          svg.style.transform = `scale(${scale}) translate(${translateX / scale}px, ${translateY / scale}px)`;
        });
      }
      
      // Clone diagram content
      const svg = diagram.querySelector('svg');
      if (svg) {
        const content = modal.querySelector('#modal-diagram-content');
        content.innerHTML = '';
        const clonedSvg = svg.cloneNode(true);
        clonedSvg.style.transform = 'scale(1)';
        clonedSvg.style.maxWidth = '100%';
        clonedSvg.style.height = 'auto';
        content.appendChild(clonedSvg);
      }
      
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeDiagramModal() {
      const modal = document.getElementById('diagram-modal');
      if (modal) {
        modal.classList.remove('active');
        document.body.style.overflow = '';
      }
    }
    
    // Re-render on theme change
    window.rerenderMermaid = async function() {
      const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
      
      mermaid.initialize({
        startOnLoad: false,
        theme: isDark ? 'base' : 'base',
        securityLevel: 'loose',
        flowchart: {
          useMaxWidth: true,
          htmlLabels: true,
          curve: 'basis',
        },
        sequence: {
          useMaxWidth: false,
          htmlLabels: true,
          diagramMarginX: 50,
          diagramMarginY: 10
        }
      });
      
      const diagrams = document.querySelectorAll('.mermaid[data-processed="true"]');
      for (let i = 0; i < diagrams.length; i++) {
        const diagram = diagrams[i];
        const code = diagram.getAttribute('data-original-code');
        
        if (code) {
          try {
            const { svg } = await mermaid.render('mermaid-diagram-rerender-' + i + '-' + Date.now(), code);
            diagram.innerHTML = svg;
          } catch (error) {
            console.error('Mermaid re-rendering error:', error);
          }
        }
      }
    };
  </script>
</head>
<body>
  <nav class="navbar navbar-expand-lg sticky-top" aria-label="Top bar">
    <div class="container-fluid d-flex align-items-center">
      <button class="navbar-toggler me-2" id="toggleSidebar" type="button" aria-label="Toggle sidebar">
        <span class="navbar-toggler-icon"></span>
      </button>
<span class="navbar-brand mb-0 h1 me-auto"><?xml version='1.0' encoding='utf-8'?>
<svg xmlns="http://www.w3.org/2000/svg" width="18.0" height="18.0" viewBox="0 0 18 18"><defs><linearGradient id="bbd02878-309a-4490-8196-946338d0f593" x1="8.995" y1="10.299" x2="8.995" y2="13.199" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#005ba1" /><stop offset="0.258" stop-color="#00589d" /><stop offset="0.525" stop-color="#004f90" /><stop offset="0.796" stop-color="#003f7c" /><stop offset="1" stop-color="#003067" /></linearGradient></defs><g><g id="b532e600-3623-4be6-9fa6-30d05fff56b1"><polygon points="13.387 7.4 13.382 7.396 13.382 7.384 13.363 7.384 8.997 4.405 4.631 7.384 4.612 7.384 4.612 7.396 4.606 7.4 4.612 7.4 4.612 13.201 13.382 13.201 13.382 7.4 13.387 7.4" fill="#50e6ff" /><path d="M4.606,7.4c0-.1.008,5.681.008,5.8L8.995,10.3Z" fill="#32bedd" /><path d="M13.384,7.4,8.995,10.3,13.376,13.2C13.376,13.083,13.384,7.3,13.384,7.4Z" fill="#198ab3" /><polygon points="8.995 10.299 4.614 13.194 4.614 13.199 13.376 13.199 13.376 13.194 8.995 10.299" fill="url(#bbd02878-309a-4490-8196-946338d0f593)" /><g><path d="M1.072,1.43h1.29a0,0,0,0,1,0,0v3.6a.286.286,0,0,1-.286.286H.786A.286.286,0,0,1,.5,5.035V2A.572.572,0,0,1,1.072,1.43Z" fill="#999" /><path d="M1.072,1.43h1.29a0,0,0,0,1,0,0v3.6a.286.286,0,0,1-.286.286H.786A.286.286,0,0,1,.5,5.035V2A.572.572,0,0,1,1.072,1.43Z" fill="#999" opacity="0.5" /></g><g><path d="M15.638,1.43h1.29A.572.572,0,0,1,17.5,2V5.035a.286.286,0,0,1-.286.286h-1.29a.286.286,0,0,1-.286-.286V1.43A0,0,0,0,1,15.638,1.43Z" fill="#999" /><path d="M15.638,1.43h1.29A.572.572,0,0,1,17.5,2V5.035a.286.286,0,0,1-.286.286h-1.29a.286.286,0,0,1-.286-.286V1.43A0,0,0,0,1,15.638,1.43Z" fill="#999" opacity="0.5" /></g><path d="M8.66-6.163H9.907a0,0,0,0,1,0,0v17a0,0,0,0,1,0,0H8.66a.567.567,0,0,1-.567-.567V-5.6A.567.567,0,0,1,8.66-6.163Z" transform="translate(11.337 -6.663) rotate(90)" fill="#949494" /><g><path d="M.786,12.679h1.29a.286.286,0,0,1,.286.286v3.6a0,0,0,0,1,0,0H1.072A.572.572,0,0,1,.5,16V12.965A.286.286,0,0,1,.786,12.679Z" fill="#999" /><path d="M.786,12.679h1.29a.286.286,0,0,1,.286.286v3.6a0,0,0,0,1,0,0H1.072A.572.572,0,0,1,.5,16V12.965A.286.286,0,0,1,.786,12.679Z" fill="#999" opacity="0.5" /></g><g><path d="M15.924,12.679h1.29a.286.286,0,0,1,.286.286V16a.572.572,0,0,1-.572.572h-1.29a0,0,0,0,1,0,0v-3.6A.286.286,0,0,1,15.924,12.679Z" fill="#999" /><path d="M15.924,12.679h1.29a.286.286,0,0,1,.286.286V16a.572.572,0,0,1-.572.572h-1.29a0,0,0,0,1,0,0v-3.6A.286.286,0,0,1,15.924,12.679Z" fill="#999" opacity="0.5" /></g><path d="M8.66,7.163H9.907a0,0,0,0,1,0,0v17a0,0,0,0,1,0,0H8.66a.567.567,0,0,1-.567-.567V7.73A.567.567,0,0,1,8.66,7.163Z" transform="translate(-6.663 24.663) rotate(-90)" fill="#949494" /></g></g></svg>
Azure Service Bus - In a Nutshell</span>
<span class="contact-info mb-0">ü§ù Curated by Murthy Vepa</span>
    </div>      
  </nav>

  <div id="appContainer">
    <div class="row g-0" id="mainRow">
      <nav class="col-lg-3 border-end sidebar" id="sidebar" aria-label="Table of contents">
        <div class="menu-header py-2">Contents</div>
        <ul class="list-group list-group-flush toc" id="toc"></ul>
      </nav>

      <main id="main" class="col-lg-9 d-flex flex-column" tabindex="-1">
        <div class="content" id="content">
        <!-- Overview Section -->
        <section id="overview" role="article">
          <h1>What is Azure Service Bus?</h1>
          <span class="badge">intro</span>
          <span class="badge">overview</span>
          <span class="badge">basics</span>
          
          <p>Azure Service Bus is a <strong>fully managed enterprise message broker</strong> with message queues and publish-subscribe topics. It provides reliable, asynchronous message delivery with enterprise-grade security and transactional support.</p>
          
          <div class="callout">
            <strong>üéØ Core Purpose</strong><br />
            Service Bus enables decoupling of applications and services from each other, providing reliable message delivery, load leveling, and the ability to build resilient, scalable distributed applications.
          </div>

          <h2>Common Scenarios</h2>
          
          <h3>üì¶ Messaging</h3>
          <p>Transfer business data between applications and services such as sales or purchase orders, journals, or inventory movements. Messages are reliably delivered even when one or more systems are temporarily offline.</p>

          <h3>üîÑ Decouple Applications</h3>
          <p>Improve reliability and scalability of applications by breaking dependencies between components. Producers and consumers don't need to be online at the same time, enabling independent scaling and maintenance.</p>

          <h3>‚öñÔ∏è Load Balancing</h3>
          <p>Distribute workload across multiple competing consumers, allowing multiple workers to process messages in parallel. Service Bus ensures each message is processed by only one consumer.</p>

          <h3>üì¢ Topics & Subscriptions</h3>
          <p>Enable publish-subscribe patterns where a single message can be delivered to multiple subscribers. Each subscriber receives its own copy based on filter rules.</p>

          <h3>üîÅ Transactions</h3>
          <p>Group multiple operations into a single transaction scope. All operations succeed or fail together, ensuring data consistency across distributed systems.</p>

          <h3>üìù Message Sessions</h3>
          <p>Implement FIFO (First-In-First-Out) guarantee and request-response patterns. Sessions enable stateful processing of related messages in the correct order.</p>

          <h2>Why Azure Service Bus?</h2>
          <ul>
            <li><strong>Enterprise Reliability</strong> - 99.9% SLA with automatic failover and geo-disaster recovery</li>
            <li><strong>Flexible Messaging</strong> - Support for both queues and publish-subscribe topics</li>
            <li><strong>Advanced Features</strong> - Dead-letter queues, scheduled delivery, message sessions, and transactions</li>
            <li><strong>Security & Compliance</strong> - Managed identities, encryption at rest and in transit, VNet integration</li>
            <li><strong>Seamless Integration</strong> - Native integration with Azure services like Logic Apps, Functions, and Event Grid</li>
            <li><strong>Large Messages</strong> - Support for messages up to 100 MB (Premium tier)</li>
          </ul>

          <h2>Service Bus vs Other Azure Messaging</h2>
          
          <div class="mermaid">
%%{ init: { "theme": "base", "fontFamily": "Segoe UI Semibold", "flowchart": { "useMaxWidth": true, "htmlLabels": true, "curve": "basis" } } }%%
graph TB
    subgraph "Azure Messaging Services"
        SB["<b>Service Bus</b><br/>Enterprise Messaging<br/>Queues & Topics<br/>Transactional"]
        EH["<b>Event Hubs</b><br/>Big Data Streaming<br/>High Throughput<br/>Telemetry"]
        EG["<b>Event Grid</b><br/>Event Routing<br/>Serverless<br/>Reactive Apps"]
    end
    
    subgraph "Use Cases"
        UC1["Order Processing<br/>Financial Transactions"]
        UC2["IoT Telemetry<br/>Log Aggregation"]
        UC3["Resource Events<br/>Custom Events"]
    end
    
    UC1 --> SB
    UC2 --> EH
    UC3 --> EG
    
    style SB fill:#0078d4,stroke:#005a9e,stroke-width:2px,color:#fff
    style EH fill:#00bcf2,stroke:#0098c3,stroke-width:2px,color:#000
    style EG fill:#50e6ff,stroke:#00b7c3,stroke-width:2px,color:#000
          </div>

          <h2>Tiers & Capabilities</h2>
          
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Feature</th>
                <th>Basic</th>
                <th>Standard</th>
                <th>Premium</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Queues</td>
                <td>‚úÖ</td>
                <td>‚úÖ</td>
                <td>‚úÖ</td>
              </tr>
              <tr>
                <td>Topics & Subscriptions</td>
                <td>‚ùå</td>
                <td>‚úÖ</td>
                <td>‚úÖ</td>
              </tr>
              <tr>
                <td>Max Message Size</td>
                <td>256 KB</td>
                <td>256 KB</td>
                <td>100 MB</td>
              </tr>
              <tr>
                <td>Transactions</td>
                <td>‚úÖ</td>
                <td>‚úÖ</td>
                <td>‚úÖ</td>
              </tr>
              <tr>
                <td>Scheduled Delivery</td>
                <td>‚úÖ</td>
                <td>‚úÖ</td>
                <td>‚úÖ</td>
              </tr>
              <tr>
                <td>Message Sessions</td>
                <td>‚úÖ</td>
                <td>‚úÖ</td>
                <td>‚úÖ</td>
              </tr>
              <tr>
                <td>Auto-forwarding</td>
                <td>‚ùå</td>
                <td>‚úÖ</td>
                <td>‚úÖ</td>
              </tr>
              <tr>
                <td>Dead-letter Queue</td>
                <td>‚úÖ</td>
                <td>‚úÖ</td>
                <td>‚úÖ</td>
              </tr>
              <tr>
                <td>Geo-disaster Recovery</td>
                <td>‚ùå</td>
                <td>‚ùå</td>
                <td>‚úÖ</td>
              </tr>
              <tr>
                <td>VNet Integration</td>
                <td>‚ùå</td>
                <td>‚ùå</td>
                <td>‚úÖ</td>
              </tr>
              <tr>
                <td>Private Endpoints</td>
                <td>‚ùå</td>
                <td>‚ùå</td>
                <td>‚úÖ</td>
              </tr>
              <tr>
                <td>Resource Isolation</td>
                <td>Shared</td>
                <td>Shared</td>
                <td>Dedicated</td>
              </tr>
            </tbody>
          </table>
        </section>

        <!-- Key Components Section -->
        <section id="key-components" role="article">
          <h1>Key Components</h1>
          <span class="badge">components</span>
          <span class="badge">namespaces</span>
          <span class="badge">queues</span>
          <span class="badge">topics</span>
          
          <p>Azure Service Bus is built on a hierarchical architecture with several key components that work together to provide reliable messaging capabilities.</p>

          <div class="mermaid">
%%{ init: { "theme": "base", "fontFamily": "Segoe UI Semibold", "flowchart": { "useMaxWidth": true, "htmlLabels": true, "curve": "basis" } } }%%
graph TB
    NS["<b>Namespace</b><br/>Container<br/>contoso.servicebus.windows.net"]
    
    subgraph "Messaging Entities"
        Q1["<b>Queue</b><br/>orders-queue<br/>Point-to-Point"]
        Q2["<b>Queue</b><br/>payments-queue<br/>Point-to-Point"]
        T1["<b>Topic</b><br/>events-topic<br/>Pub/Sub"]
    end
    
    subgraph "Subscriptions"
        S1["<b>Subscription</b><br/>high-priority<br/>Filter: Priority='High'"]
        S2["<b>Subscription</b><br/>low-priority<br/>Filter: Priority='Low'"]
        S3["<b>Subscription</b><br/>all-events<br/>No Filter"]
    end
    
    NS --> Q1
    NS --> Q2
    NS --> T1
    T1 --> S1
    T1 --> S2
    T1 --> S3
    
    style NS fill:#0078d4,stroke:#005a9e,stroke-width:3px,color:#fff
    style Q1 fill:#50e6ff,stroke:#00b7c3,stroke-width:2px,color:#000
    style Q2 fill:#50e6ff,stroke:#00b7c3,stroke-width:2px,color:#000
    style T1 fill:#00bcf2,stroke:#0098c3,stroke-width:2px,color:#000
    style S1 fill:#c3f0ff,stroke:#00b7c3,stroke-width:1px,color:#000
    style S2 fill:#c3f0ff,stroke:#00b7c3,stroke-width:1px,color:#000
    style S3 fill:#c3f0ff,stroke:#00b7c3,stroke-width:1px,color:#000
          </div>

          <h2>1. Namespace</h2>
          <p>A <strong>namespace</strong> is a container for all messaging components. It's the top-level entity that provides a scoping container and a unique FQDN endpoint.</p>
          
          <h3>‚ú® Key Characteristics</h3>
          <ul>
            <li><strong>Unique Endpoint</strong> - <code>namespace-name.servicebus.windows.net</code></li>
            <li><strong>Container for Entities</strong> - Holds multiple queues and topics</li>
            <li><strong>Pricing Tier</strong> - Basic, Standard, or Premium tier selection</li>
            <li><strong>Access Control</strong> - Shared Access Signatures (SAS) or Azure AD authentication</li>
            <li><strong>Capacity Units</strong> - In Premium tier, supports 1, 2, 4, 8, or 16 messaging units</li>
          </ul>

          <h3>üìù Namespace Properties</h3>
          <pre class="syntax-highlighted" data-language="properties"><code>Name:                    contoso-prod-servicebus
Endpoint:                contoso-prod-servicebus.servicebus.windows.net
Tier:                    Premium
Messaging Units:         2
Region:                  East US
Zone Redundancy:         Enabled
Geo-disaster Recovery:   Enabled</code></pre>

          <h2>2. Queues</h2>
          <p><strong>Queues</strong> offer <strong>First In, First Out (FIFO)</strong> message delivery to one or more competing consumers. Messages are stored durably until retrieved.</p>
          
          <div class="mermaid">
sequenceDiagram
    participant P1 as Producer 1
    participant P2 as Producer 2
    participant Q as Queue
    participant C1 as Consumer 1
    participant C2 as Consumer 2
    
    P1->>Q: Send Message A
    P2->>Q: Send Message B
    P1->>Q: Send Message C
    
    Q->>C1: Deliver Message A
    C1->>Q: Complete Message A
    
    Q->>C2: Deliver Message B
    C2->>Q: Complete Message B
    
    Q->>C1: Deliver Message C
    C1->>Q: Complete Message C
    
    Note over Q,C2: Each message delivered to only one consumer
          </div>

          <h3>‚úÖ Queue Features</h3>
          <ul>
            <li><strong>Point-to-Point</strong> - Each message consumed by single receiver</li>
            <li><strong>Load Leveling</strong> - Absorb bursts in traffic and smooth workload</li>
            <li><strong>Competing Consumers</strong> - Multiple consumers process messages in parallel</li>
            <li><strong>Temporal Decoupling</strong> - Producer and consumer don't need to be online simultaneously</li>
            <li><strong>FIFO Guarantee</strong> - With sessions, messages processed in order</li>
          </ul>

          <h3>‚öôÔ∏è Queue Configuration</h3>
          <pre class="syntax-highlighted" data-language="properties"><code>Max Queue Size:           1-5 GB (Standard) or 1-80 GB (Premium)
Message TTL:              Default 14 days, configurable
Lock Duration:            Default 60 seconds
Max Delivery Count:       Default 10 attempts
Duplicate Detection:      Optional, time window up to 7 days
Dead-letter Queue:        Automatically created
Sessions:                 Optional, enables FIFO
Partitioning:             Optional (Standard tier only)</code></pre>

          <h2>3. Topics & Subscriptions</h2>
          <p><strong>Topics</strong> provide a publish-subscribe messaging pattern. A single message can be delivered to multiple subscribers through <strong>subscriptions</strong>.</p>
          
          <div class="mermaid">
sequenceDiagram
    participant P as Publisher
    participant T as Topic
    participant S1 as Subscription 1
    participant S2 as Subscription 2
    participant S3 as Subscription 3
    participant C1 as Consumer 1
    participant C2 as Consumer 2
    participant C3 as Consumer 3
    
    P->>T: Publish Message
    T->>S1: Copy Message (Filter: Priority=High)
    T->>S2: Copy Message (Filter: Region=US)
    T->>S3: Copy Message (No Filter)
    
    S1->>C1: Deliver Message
    S2->>C2: Deliver Message
    S3->>C3: Deliver Message
    
    Note over T,C3: Single message delivered to multiple subscribers
          </div>

          <h3>üéØ Topic Features</h3>
          <ul>
            <li><strong>One-to-Many</strong> - Single message to multiple subscribers</li>
            <li><strong>Filtering</strong> - Subscriptions filter messages based on properties</li>
            <li><strong>Multiple Subscriptions</strong> - Up to 2,000 subscriptions per topic (Standard/Premium)</li>
            <li><strong>Independent Processing</strong> - Each subscription maintains its own queue</li>
            <li><strong>Flexible Routing</strong> - SQL filters, correlation filters, and actions</li>
          </ul>

          <h3>üîç Subscription Filters</h3>
          <p>Subscriptions can use filters to receive only relevant messages:</p>
          
          <h4>SQL Filters</h4>
          <pre class="syntax-highlighted" data-language="sql"><code class="language-sql"><span class="sql-comment">-- Filter by message properties</span>
<span class="sql-keyword">Priority</span> <span class="sql-operator">=</span> <span class="sql-string">'High'</span> <span class="sql-keyword">AND</span> <span class="sql-keyword">Region</span> <span class="sql-operator">=</span> <span class="sql-string">'US'</span>

<span class="sql-comment">-- Filter by custom properties</span>
<span class="sql-keyword">OrderAmount</span> <span class="sql-operator">&gt;</span> <span class="sql-number">1000</span> <span class="sql-keyword">OR</span> <span class="sql-keyword">CustomerType</span> <span class="sql-operator">=</span> <span class="sql-string">'Premium'</span>

<span class="sql-comment">-- Complex filtering</span>
<span class="sql-keyword">EventType</span> <span class="sql-operator">IN</span> (<span class="sql-string">'OrderCreated'</span>, <span class="sql-string">'OrderUpdated'</span>) <span class="sql-keyword">AND</span> <span class="sql-keyword">Status</span> <span class="sql-operator">!=</span> <span class="sql-string">'Cancelled'</span></code></pre>

          <h4>Correlation Filters</h4>
          <pre class="syntax-highlighted" data-language="json"><code class="language-json"><span class="json-punctuation">{</span>
  <span class="json-key">"properties"</span><span class="json-punctuation">:</span> <span class="json-punctuation">{</span>
    <span class="json-key">"CorrelationId"</span><span class="json-punctuation">:</span> <span class="json-string">"order-12345"</span><span class="json-punctuation">,</span>
    <span class="json-key">"Label"</span><span class="json-punctuation">:</span> <span class="json-string">"OrderCreated"</span><span class="json-punctuation">,</span>
    <span class="json-key">"Priority"</span><span class="json-punctuation">:</span> <span class="json-string">"High"</span>
  <span class="json-punctuation">}</span>
<span class="json-punctuation">}</span></code></pre>

          <h2>4. Messages</h2>
          <p>A <strong>message</strong> is the data transferred between applications. It consists of a body (payload) and metadata (properties).</p>

          <h3>üì¶ Message Structure</h3>
          <pre class="syntax-highlighted" data-language="json"><code class="language-json"><span class="json-punctuation">{</span>
  <span class="json-key">"MessageId"</span><span class="json-punctuation">:</span> <span class="json-string">"msg-001"</span><span class="json-punctuation">,</span>
  <span class="json-key">"ContentType"</span><span class="json-punctuation">:</span> <span class="json-string">"application/json"</span><span class="json-punctuation">,</span>
  <span class="json-key">"Label"</span><span class="json-punctuation">:</span> <span class="json-string">"OrderCreated"</span><span class="json-punctuation">,</span>
  <span class="json-key">"CorrelationId"</span><span class="json-punctuation">:</span> <span class="json-string">"correlation-123"</span><span class="json-punctuation">,</span>
  <span class="json-key">"TimeToLive"</span><span class="json-punctuation">:</span> <span class="json-string">"PT1H"</span><span class="json-punctuation">,</span>
  <span class="json-key">"ScheduledEnqueueTimeUtc"</span><span class="json-punctuation">:</span> <span class="json-string">"2025-12-24T10:00:00Z"</span><span class="json-punctuation">,</span>
  <span class="json-key">"Properties"</span><span class="json-punctuation">:</span> <span class="json-punctuation">{</span>
    <span class="json-key">"Priority"</span><span class="json-punctuation">:</span> <span class="json-string">"High"</span><span class="json-punctuation">,</span>
    <span class="json-key">"Region"</span><span class="json-punctuation">:</span> <span class="json-string">"US"</span><span class="json-punctuation">,</span>
    <span class="json-key">"CustomerId"</span><span class="json-punctuation">:</span> <span class="json-number">12345</span>
  <span class="json-punctuation">}</span><span class="json-punctuation">,</span>
  <span class="json-key">"Body"</span><span class="json-punctuation">:</span> <span class="json-punctuation">{</span>
    <span class="json-key">"orderId"</span><span class="json-punctuation">:</span> <span class="json-string">"ORD-2025-001"</span><span class="json-punctuation">,</span>
    <span class="json-key">"amount"</span><span class="json-punctuation">:</span> <span class="json-number">1299.99</span><span class="json-punctuation">,</span>
    <span class="json-key">"items"</span><span class="json-punctuation">:</span> <span class="json-punctuation">[</span><span class="json-string">"item1"</span><span class="json-punctuation">,</span> <span class="json-string">"item2"</span><span class="json-punctuation">]</span>
  <span class="json-punctuation">}</span>
<span class="json-punctuation">}</span></code></pre>

          <h3>üè∑Ô∏è Message Properties</h3>
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Property</th>
                <th>Purpose</th>
                <th>Example</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>MessageId</code></td>
                <td>Unique identifier for deduplication</td>
                <td>msg-12345</td>
              </tr>
              <tr>
                <td><code>ContentType</code></td>
                <td>MIME type of the payload</td>
                <td>application/json</td>
              </tr>
              <tr>
                <td><code>Label</code></td>
                <td>Message type/subject</td>
                <td>OrderCreated</td>
              </tr>
              <tr>
                <td><code>CorrelationId</code></td>
                <td>Link related messages</td>
                <td>order-12345</td>
              </tr>
              <tr>
                <td><code>SessionId</code></td>
                <td>Group related messages</td>
                <td>session-001</td>
              </tr>
              <tr>
                <td><code>TimeToLive</code></td>
                <td>Message expiration duration</td>
                <td>PT1H (1 hour)</td>
              </tr>
              <tr>
                <td><code>ScheduledEnqueueTimeUtc</code></td>
                <td>Delayed message delivery</td>
                <td>2025-12-24T10:00:00Z</td>
              </tr>
              <tr>
                <td><code>ReplyTo</code></td>
                <td>Queue for response messages</td>
                <td>reply-queue</td>
              </tr>
            </tbody>
          </table>

          <h2>5. Dead-Letter Queue</h2>
          <p>A <strong>dead-letter queue (DLQ)</strong> is a sub-queue that holds messages that cannot be processed successfully.</p>

          <h3>üî¥ Messages Move to DLQ When:</h3>
          <ul>
            <li><strong>Max Delivery Count Exceeded</strong> - Message failed processing too many times</li>
            <li><strong>TTL Expired</strong> - Message not processed before expiration</li>
            <li><strong>Filter Evaluation Failed</strong> - Subscription filter rejected the message</li>
            <li><strong>Explicitly Dead-Lettered</strong> - Application code marked message as dead-letter</li>
          </ul>

          <div class="callout">
            <strong>üí° Best Practice</strong><br />
            Monitor and process dead-letter queues regularly. Messages in DLQ don't automatically retry and remain there until explicitly handled or expired.
          </div>

          <h2>Component Hierarchy</h2>
          <pre class="syntax-highlighted" data-language="text"><code>Namespace (contoso.servicebus.windows.net)
‚îú‚îÄ‚îÄ Queue: orders-queue
‚îÇ   ‚îî‚îÄ‚îÄ Dead-Letter Queue: orders-queue/$DeadLetterQueue
‚îú‚îÄ‚îÄ Queue: payments-queue
‚îÇ   ‚îî‚îÄ‚îÄ Dead-Letter Queue: payments-queue/$DeadLetterQueue
‚îî‚îÄ‚îÄ Topic: events-topic
    ‚îú‚îÄ‚îÄ Subscription: high-priority
    ‚îÇ   ‚îî‚îÄ‚îÄ Dead-Letter Queue: events-topic/Subscriptions/high-priority/$DeadLetterQueue
    ‚îú‚îÄ‚îÄ Subscription: low-priority
    ‚îÇ   ‚îî‚îÄ‚îÄ Dead-Letter Queue: events-topic/Subscriptions/low-priority/$DeadLetterQueue
    ‚îî‚îÄ‚îÄ Subscription: all-events
        ‚îî‚îÄ‚îÄ Dead-Letter Queue: events-topic/Subscriptions/all-events/$DeadLetterQueue</code></pre>
        </section>

        <!-- Messaging Patterns Section -->
        <section id="messaging-patterns" role="article">
          <h1>Messaging Patterns</h1>
          <span class="badge">patterns</span>
          <span class="badge">queue</span>
          <span class="badge">pubsub</span>
          <span class="badge">messaging</span>
          
          <p>Azure Service Bus supports multiple messaging patterns that enable different communication scenarios between distributed applications and services.</p>

          <h2>1. Point-to-Point (Queue Pattern)</h2>
          <p>The <strong>point-to-point pattern</strong> uses queues to deliver messages to a single consumer. Multiple producers can send to the queue, and multiple consumers can compete for messages, but each message is processed by exactly one consumer.</p>

          <div class="mermaid">
%%{ init: { "theme": "base", "fontFamily": "Segoe UI Semibold", "sequence": { "useMaxWidth": false, "htmlLabels": true } } }%%
sequenceDiagram
    participant P1 as Producer 1
    participant P2 as Producer 2
    participant Q as Queue
    participant C1 as Consumer 1
    participant C2 as Consumer 2
    
    P1->>Q: Send Message 1
    P2->>Q: Send Message 2
    P1->>Q: Send Message 3
    P2->>Q: Send Message 4
    
    Note over Q: Messages queued in order
    
    Q->>C1: Deliver Message 1 (Locked)
    C1->>C1: Process Message 1
    C1->>Q: Complete Message 1
    
    Q->>C2: Deliver Message 2 (Locked)
    C2->>C2: Process Message 2
    C2->>Q: Complete Message 2
    
    Q->>C1: Deliver Message 3 (Locked)
    Q->>C2: Deliver Message 4 (Locked)
    
    Note over C1,C2: Competing consumers process in parallel
          </div>

          <h3>‚úÖ Use Cases</h3>
          <ul>
            <li><strong>Task Distribution</strong> - Distribute work items across multiple workers</li>
            <li><strong>Order Processing</strong> - Process orders sequentially with load balancing</li>
            <li><strong>Command Queue</strong> - Execute commands from multiple sources</li>
            <li><strong>Background Jobs</strong> - Queue long-running tasks for async processing</li>
          </ul>

          <h3>üìù Code Example: Sending to Queue</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>// C# Example using Azure.Messaging.ServiceBus
var client = new ServiceBusClient(connectionString);
var sender = client.CreateSender("orders-queue");

var message = new ServiceBusMessage(JsonSerializer.Serialize(order))
{
    MessageId = Guid.NewGuid().ToString(),
    ContentType = "application/json",
    Subject = "OrderCreated",
    ApplicationProperties =
    {
        ["Priority"] = "High",
        ["CustomerId"] = order.CustomerId
    }
};

await sender.SendMessageAsync(message);</code></pre>

          <h3>üì• Code Example: Receiving from Queue</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>var processor = client.CreateProcessor("orders-queue", new ServiceBusProcessorOptions
{
    MaxConcurrentCalls = 5,
    AutoCompleteMessages = false
});

processor.ProcessMessageAsync += async args =>
{
    var order = JsonSerializer.Deserialize<Order>(args.Message.Body.ToString());
    
    try
    {
        await ProcessOrderAsync(order);
        await args.CompleteMessageAsync(args.Message);
    }
    catch (Exception ex)
    {
        await args.AbandonMessageAsync(args.Message);
    }
};

processor.ProcessErrorAsync += args =>
{
    Console.WriteLine($"Error: {args.Exception.Message}");
    return Task.CompletedTask;
};

await processor.StartProcessingAsync();</code></pre>

          <h2>2. Publish-Subscribe (Topic Pattern)</h2>
          <p>The <strong>publish-subscribe pattern</strong> uses topics to broadcast messages to multiple subscribers. Each subscriber receives its own copy of the message based on filter rules.</p>

          <div class="mermaid">
%%{ init: { "theme": "base", "fontFamily": "Segoe UI Semibold", "sequence": { "useMaxWidth": false, "htmlLabels": true } } }%%
sequenceDiagram
    participant P as Publisher
    participant T as Topic: events
    participant S1 as Sub: audit<br/>(All messages)
    participant S2 as Sub: alerts<br/>(Priority=High)
    participant S3 as Sub: analytics<br/>(Type=Order)
    participant C1 as Audit Service
    participant C2 as Alert Service
    participant C3 as Analytics Service
    
    P->>T: Publish: OrderCreated<br/>Priority=High, Type=Order
    
    T->>S1: Copy (No filter)
    T->>S2: Copy (Priority=High ‚úì)
    T->>S3: Copy (Type=Order ‚úì)
    
    S1->>C1: Deliver message
    S2->>C2: Deliver message
    S3->>C3: Deliver message
    
    Note over T: Single publish, multiple subscribers
          </div>

          <h3>‚úÖ Use Cases</h3>
          <ul>
            <li><strong>Event Distribution</strong> - Notify multiple systems about business events</li>
            <li><strong>Audit Logging</strong> - Send all events to audit system while routing to specific handlers</li>
            <li><strong>Fan-Out</strong> - Trigger multiple workflows from single event</li>
            <li><strong>Data Replication</strong> - Replicate data changes to multiple data stores</li>
          </ul>

          <h3>üìù Code Example: Publishing to Topic</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>var sender = client.CreateSender("events-topic");

var message = new ServiceBusMessage(JsonSerializer.Serialize(eventData))
{
    Subject = "OrderCreated",
    ApplicationProperties =
    {
        ["EventType"] = "OrderCreated",
        ["Priority"] = "High",
        ["Region"] = "US"
    }
};

await sender.SendMessageAsync(message);</code></pre>

          <h3>üì• Code Example: Subscription with Filter</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>// Create subscription with SQL filter
var client = new ServiceBusAdministrationClient(connectionString);

var options = new CreateSubscriptionOptions("events-topic", "high-priority-sub")
{
    DefaultMessageTimeToLive = TimeSpan.FromDays(1)
};

var filter = new SqlRuleFilter("Priority = 'High' AND Region = 'US'");
var rule = new CreateRuleOptions("HighPriorityRule", filter);

await client.CreateSubscriptionAsync(options, rule);</code></pre>

          <h2>3. Request-Response Pattern</h2>
          <p>The <strong>request-response pattern</strong> enables synchronous-style communication over asynchronous messaging using the <code>ReplyTo</code> and <code>CorrelationId</code> properties.</p>

          <div class="mermaid">
sequenceDiagram
    participant C as Client
    participant RQ as Request Queue
    participant S as Service
    participant RPQ as Reply Queue
    
    C->>C: Create reply queue<br/>temp-queue-123
    C->>RQ: Send Request<br/>ReplyTo: temp-queue-123<br/>CorrelationId: req-001
    
    RQ->>S: Receive Request
    S->>S: Process Request
    
    S->>RPQ: Send Response to<br/>temp-queue-123<br/>CorrelationId: req-001
    
    RPQ->>C: Receive Response<br/>(Match CorrelationId)
    
    Note over C,RPQ: Async request-response pattern
          </div>

          <h3>‚úÖ Use Cases</h3>
          <ul>
            <li><strong>RPC-style Communication</strong> - Remote procedure calls with async benefits</li>
            <li><strong>Query Services</strong> - Send query, receive result</li>
            <li><strong>Status Checks</strong> - Request status updates from long-running processes</li>
          </ul>

          <h3>üìù Code Example: Request</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>var replyQueueName = $"reply-{Guid.NewGuid()}";
await client.CreateQueueAsync(replyQueueName);

var sender = client.CreateSender("request-queue");
var receiver = client.CreateReceiver(replyQueueName);

var request = new ServiceBusMessage(JsonSerializer.Serialize(query))
{
    MessageId = Guid.NewGuid().ToString(),
    ReplyTo = replyQueueName,
    CorrelationId = "query-001"
};

await sender.SendMessageAsync(request);

// Wait for response
var response = await receiver.ReceiveMessageAsync(timeout: TimeSpan.FromSeconds(30));
if (response?.CorrelationId == request.CorrelationId)
{
    var result = JsonSerializer.Deserialize<QueryResult>(response.Body.ToString());
}</code></pre>

          <h2>4. Competing Consumers Pattern</h2>
          <p>Multiple consumers process messages from the same queue in parallel, improving throughput and providing fault tolerance.</p>

          <div class="callout">
            <strong>üéØ Key Benefits</strong><br />
            ‚Ä¢ <strong>Load Balancing:</strong> Work distributed across available consumers<br />
            ‚Ä¢ <strong>Scalability:</strong> Add more consumers to increase throughput<br />
            ‚Ä¢ <strong>Fault Tolerance:</strong> If one consumer fails, others continue processing<br />
            ‚Ä¢ <strong>Message Locking:</strong> Each message locked to one consumer during processing
          </div>

          <h2>5. Priority Queue Pattern</h2>
          <p>Process high-priority messages before low-priority ones using separate queues or message sessions.</p>

          <div class="mermaid">
%%{ init: { "theme": "base", "fontFamily": "Segoe UI Semibold", "flowchart": { "useMaxWidth": true, "htmlLabels": true } } }%%
graph LR
    P[Producer] --> R{Router}
    R -->|Priority=High| Q1[High Priority Queue]
    R -->|Priority=Normal| Q2[Normal Priority Queue]
    R -->|Priority=Low| Q3[Low Priority Queue]
    
    Q1 --> C1[Fast Consumer Pool]
    Q2 --> C2[Standard Consumer Pool]
    Q3 --> C3[Background Consumer Pool]
    
    style Q1 fill:#ff6b6b,stroke:#c92a2a,stroke-width:2px,color:#fff
    style Q2 fill:#ffd43b,stroke:#f59f00,stroke-width:2px,color:#000
    style Q3 fill:#51cf66,stroke:#2f9e44,stroke-width:2px,color:#000
          </div>

          <h2>6. Scheduled Messages Pattern</h2>
          <p>Delay message delivery until a specified time using <code>ScheduledEnqueueTimeUtc</code>.</p>

          <h3>üìù Code Example</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>var message = new ServiceBusMessage("Reminder: Meeting in 1 hour")
{
    ScheduledEnqueueTimeUtc = DateTimeOffset.UtcNow.AddHours(1)
};

await sender.SendMessageAsync(message);
// Message will not be available until scheduled time</code></pre>

          <h3>‚úÖ Use Cases</h3>
          <ul>
            <li>Scheduled notifications and reminders</li>
            <li>Delayed job execution</li>
            <li>Retry with exponential backoff</li>
            <li>Time-based workflow triggers</li>
          </ul>

          <h2>Pattern Comparison</h2>
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Pattern</th>
                <th>Use Queue/Topic</th>
                <th>Consumers</th>
                <th>Message Delivery</th>
                <th>Best For</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Point-to-Point</td>
                <td>Queue</td>
                <td>One per message</td>
                <td>Exactly once</td>
                <td>Task distribution</td>
              </tr>
              <tr>
                <td>Publish-Subscribe</td>
                <td>Topic</td>
                <td>Multiple</td>
                <td>Copy per subscriber</td>
                <td>Event broadcasting</td>
              </tr>
              <tr>
                <td>Request-Response</td>
                <td>Queue</td>
                <td>One sender, one receiver</td>
                <td>Bi-directional</td>
                <td>RPC-style communication</td>
              </tr>
              <tr>
                <td>Competing Consumers</td>
                <td>Queue</td>
                <td>Multiple parallel</td>
                <td>Load balanced</td>
                <td>High throughput processing</td>
              </tr>
              <tr>
                <td>Priority Queue</td>
                <td>Multiple Queues</td>
                <td>Prioritized pools</td>
                <td>Priority-based</td>
                <td>SLA-based processing</td>
              </tr>
              <tr>
                <td>Scheduled Messages</td>
                <td>Queue/Topic</td>
                <td>Any</td>
                <td>Delayed delivery</td>
                <td>Time-based workflows</td>
              </tr>
            </tbody>
          </table>
        </section>

        <!-- Advanced Features Section -->
        <section id="advanced-features" role="article">
          <h1>Advanced Features</h1>
          <span class="badge">advanced</span>
          <span class="badge">sessions</span>
          <span class="badge">transactions</span>
          <span class="badge">deadletter</span>
          
          <p>Azure Service Bus provides advanced features that enable complex messaging scenarios, ensuring reliability, ordering, and transactional consistency.</p>

          <h2>1. Message Sessions</h2>
          <p><strong>Message sessions</strong> enable ordered, guaranteed FIFO handling of related messages. Sessions group messages that belong together and ensure they're processed in order.</p>

          <div class="mermaid">
sequenceDiagram
    participant P as Producer
    participant Q as Queue<br/>(Sessions Enabled)
    participant C1 as Consumer 1
    participant C2 as Consumer 2
    
    Note over P: Messages for Session A
    P->>Q: Msg 1 (SessionId=A)
    P->>Q: Msg 2 (SessionId=A)
    P->>Q: Msg 3 (SessionId=A)
    
    Note over P: Messages for Session B
    P->>Q: Msg 1 (SessionId=B)
    P->>Q: Msg 2 (SessionId=B)
    
    Note over Q: Lock Session A
    Q->>C1: Session A: Msg 1
    C1->>Q: Complete Msg 1
    Q->>C1: Session A: Msg 2
    C1->>Q: Complete Msg 2
    
    Note over Q: Lock Session B
    Q->>C2: Session B: Msg 1
    C2->>Q: Complete Msg 1
    
    Q->>C1: Session A: Msg 3
    Q->>C2: Session B: Msg 2
    
    Note over Q,C2: Sessions processed in parallel<br/>Messages within session FIFO
          </div>

          <h3>‚úÖ When to Use Sessions</h3>
          <ul>
            <li><strong>Order Guarantee</strong> - Process messages in exact order sent</li>
            <li><strong>Related Messages</strong> - Group messages belonging to same transaction/workflow</li>
            <li><strong>Stateful Processing</strong> - Maintain state across message processing</li>
            <li><strong>Request-Response</strong> - Correlate requests and responses</li>
          </ul>

          <h3>üìù Code Example: Sending with Sessions</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>// All messages with same SessionId processed in order
var orderId = "ORDER-12345";

var messages = new[]
{
    new ServiceBusMessage("Order Created") { SessionId = orderId },
    new ServiceBusMessage("Payment Received") { SessionId = orderId },
    new ServiceBusMessage("Order Shipped") { SessionId = orderId }
};

foreach (var message in messages)
{
    await sender.SendMessageAsync(message);
}</code></pre>

          <h3>üì• Code Example: Receiving Sessions</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>var sessionProcessor = client.CreateSessionProcessor("orders-queue", new ServiceBusSessionProcessorOptions
{
    MaxConcurrentSessions = 5,
    MaxConcurrentCallsPerSession = 1 // FIFO within session
});

sessionProcessor.ProcessMessageAsync += async args =>
{
    Console.WriteLine($"Session {args.SessionId}: {args.Message.Body}");
    
    // Access session state
    var state = await args.GetSessionStateAsync();
    
    // Update session state
    await args.SetSessionStateAsync(updatedState);
    
    await args.CompleteMessageAsync(args.Message);
};

await sessionProcessor.StartProcessingAsync();</code></pre>

          <h3>üíæ Session State</h3>
          <p>Each session can store up to 256 KB of state data, useful for maintaining context across messages.</p>

          <div class="callout">
            <strong>‚ö†Ô∏è Important</strong><br />
            Sessions must be enabled when creating the queue or topic. This setting cannot be changed after creation. Messages without SessionId will be rejected if sessions are required.
          </div>

          <h2>2. Transactions</h2>
          <p><strong>Transactions</strong> allow grouping multiple operations into an atomic unit. All operations succeed or fail together, ensuring consistency.</p>

          <h3>üîÑ Transaction Scope</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>using var scope = new TransactionScope(TransactionScopeAsyncFlowOption.Enabled);

// All operations within scope are transactional
var sender1 = client.CreateSender("queue1");
var sender2 = client.CreateSender("queue2");
var receiver = client.CreateReceiver("input-queue");

// Receive message
var message = await receiver.ReceiveMessageAsync();
await receiver.CompleteMessageAsync(message);

// Process and send to multiple queues
var result1 = ProcessMessage(message);
var result2 = TransformMessage(message);

await sender1.SendMessageAsync(new ServiceBusMessage(result1));
await sender2.SendMessageAsync(new ServiceBusMessage(result2));

// Commit all operations atomically
scope.Complete();
// If exception occurs before Complete(), all operations roll back</code></pre>

          <h3>‚úÖ Transaction Capabilities</h3>
          <ul>
            <li>Send messages to multiple queues/topics atomically</li>
            <li>Receive and complete messages with other sends</li>
            <li>Transfer messages between queues atomically</li>
            <li>Combine with database transactions (distributed transactions)</li>
          </ul>

          <h3>‚ö†Ô∏è Transaction Limitations</h3>
          <ul>
            <li>All entities must be in the same namespace</li>
            <li>Operations must complete within timeout (default 60 seconds)</li>
            <li>Not supported with partitioned entities</li>
            <li>Session operations not supported in transactions</li>
          </ul>

          <h2>3. Auto-Forwarding</h2>
          <p><strong>Auto-forwarding</strong> automatically moves messages from one queue/subscription to another queue/topic within the same namespace.</p>

          <div class="mermaid">
%%{ init: { "theme": "base", "fontFamily": "Segoe UI Semibold", "flowchart": { "useMaxWidth": true, "htmlLabels": true } } }%%
graph LR
    P[Producer] --> Q1[Input Queue]
    Q1 -.Auto-Forward.-> Q2[Processing Queue]
    Q2 --> C[Consumer]
    
    T[Topic] --> S1[Subscription 1<br/>Filter: Region=US]
    T --> S2[Subscription 2<br/>Filter: Priority=High]
    
    S1 -.Auto-Forward.-> Q3[US Processing Queue]
    S2 -.Auto-Forward.-> Q4[Priority Queue]
    
    style Q1 fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    style Q2 fill:#c5e1a5,stroke:#689f38,stroke-width:2px
    style S1 fill:#fff9c4,stroke:#f9a825,stroke-width:2px
    style S2 fill:#ffccbc,stroke:#e64a19,stroke-width:2px
          </div>

          <h3>‚úÖ Use Cases</h3>
          <ul>
            <li><strong>Message Routing</strong> - Route filtered messages to specific queues</li>
            <li><strong>Chain Processing</strong> - Create processing pipelines</li>
            <li><strong>Topic to Queue</strong> - Forward filtered topic messages to dedicated queues</li>
            <li><strong>Load Distribution</strong> - Distribute load across multiple queues</li>
          </ul>

          <h3>üìù Configuration Example</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>var adminClient = new ServiceBusAdministrationClient(connectionString);

var queueOptions = new CreateQueueOptions("input-queue")
{
    ForwardTo = "processing-queue" // Auto-forward destination
};

await adminClient.CreateQueueAsync(queueOptions);</code></pre>

          <h2>4. Duplicate Detection</h2>
          <p><strong>Duplicate detection</strong> automatically discards duplicate messages based on <code>MessageId</code> within a configurable time window.</p>

          <h3>‚öôÔ∏è Configuration</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>var queueOptions = new CreateQueueOptions("orders-queue")
{
    RequiresDuplicateDetection = true,
    DuplicateDetectionHistoryTimeWindow = TimeSpan.FromMinutes(10)
};

await adminClient.CreateQueueAsync(queueOptions);</code></pre>

          <h3>üìù Sending with Duplicate Detection</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>var message = new ServiceBusMessage(orderData)
{
    MessageId = $"order-{order.Id}" // Use deterministic ID
};

// If message with same MessageId sent within time window, it's discarded
await sender.SendMessageAsync(message);</code></pre>

          <h2>5. Message Deferral</h2>
          <p><strong>Message deferral</strong> allows postponing message processing. Deferred messages are set aside and retrieved later by sequence number.</p>

          <h3>üìù Code Example</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>var message = await receiver.ReceiveMessageAsync();

if (!CanProcessNow(message))
{
    // Defer message for later processing
    var sequenceNumber = message.SequenceNumber;
    await receiver.DeferMessageAsync(message);
    
    // Store sequence number for later retrieval
    await StoreSequenceNumber(sequenceNumber);
}

// Later, retrieve deferred message
var deferredMessage = await receiver.ReceiveDeferredMessageAsync(sequenceNumber);
await ProcessMessage(deferredMessage);
await receiver.CompleteMessageAsync(deferredMessage);</code></pre>

          <h3>‚úÖ Use Cases</h3>
          <ul>
            <li>Wait for dependent resources or data</li>
            <li>Process messages out of order temporarily</li>
            <li>Implement custom retry logic</li>
            <li>Coordinate message processing across systems</li>
          </ul>

          <h2>6. Message Browsing (Peek)</h2>
          <p><strong>Peek</strong> allows examining messages without removing them from the queue, useful for monitoring and debugging.</p>

          <h3>üìù Code Example</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>var receiver = client.CreateReceiver("orders-queue");

// Peek next message without locking
var message = await receiver.PeekMessageAsync();

// Peek multiple messages
var messages = await receiver.PeekMessagesAsync(maxMessages: 10);

// Peek from specific sequence number
var message = await receiver.PeekMessageAsync(fromSequenceNumber: 12345);</code></pre>

          <h2>7. Batch Operations</h2>
          <p>Send or receive multiple messages in a single operation for improved performance.</p>

          <h3>üì§ Batch Send</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>// Create batch with automatic size management
using var messageBatch = await sender.CreateMessageBatchAsync();

foreach (var order in orders)
{
    var message = new ServiceBusMessage(JsonSerializer.Serialize(order));
    
    if (!messageBatch.TryAddMessage(message))
    {
        // Batch full, send and create new batch
        await sender.SendMessagesAsync(messageBatch);
        messageBatch = await sender.CreateMessageBatchAsync();
        messageBatch.TryAddMessage(message);
    }
}

if (messageBatch.Count > 0)
{
    await sender.SendMessagesAsync(messageBatch);
}</code></pre>

          <h3>üì• Batch Receive</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>// Receive up to 100 messages at once
var messages = await receiver.ReceiveMessagesAsync(
    maxMessages: 100,
    maxWaitTime: TimeSpan.FromSeconds(5)
);

foreach (var message in messages)
{
    await ProcessMessageAsync(message);
    await receiver.CompleteMessageAsync(message);
}</code></pre>

          <h2>Feature Comparison Matrix</h2>
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Feature</th>
                <th>Basic</th>
                <th>Standard</th>
                <th>Premium</th>
                <th>Configuration</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Sessions</td>
                <td>‚úÖ</td>
                <td>‚úÖ</td>
                <td>‚úÖ</td>
                <td>Queue/Topic creation</td>
              </tr>
              <tr>
                <td>Transactions</td>
                <td>‚úÖ</td>
                <td>‚úÖ</td>
                <td>‚úÖ</td>
                <td>Client-side TransactionScope</td>
              </tr>
              <tr>
                <td>Auto-Forwarding</td>
                <td>‚ùå</td>
                <td>‚úÖ</td>
                <td>‚úÖ</td>
                <td>ForwardTo property</td>
              </tr>
              <tr>
                <td>Duplicate Detection</td>
                <td>‚úÖ</td>
                <td>‚úÖ</td>
                <td>‚úÖ</td>
                <td>Queue/Topic creation</td>
              </tr>
              <tr>
                <td>Scheduled Messages</td>
                <td>‚úÖ</td>
                <td>‚úÖ</td>
                <td>‚úÖ</td>
                <td>Per message</td>
              </tr>
              <tr>
                <td>Message Deferral</td>
                <td>‚úÖ</td>
                <td>‚úÖ</td>
                <td>‚úÖ</td>
                <td>Client API</td>
              </tr>
              <tr>
                <td>Batch Operations</td>
                <td>‚úÖ</td>
                <td>‚úÖ</td>
                <td>‚úÖ</td>
                <td>Client API</td>
              </tr>
              <tr>
                <td>Message Browsing</td>
                <td>‚úÖ</td>
                <td>‚úÖ</td>
                <td>‚úÖ</td>
                <td>Client API</td>
              </tr>
            </tbody>
          </table>

          <div class="callout">
            <strong>üí° Best Practice</strong><br />
            Choose advanced features based on your specific requirements. Sessions and transactions add overhead, so only enable them when needed. Use batch operations for high-throughput scenarios to reduce network round trips.
          </div>
        </section>

        <!-- Key Concepts Section -->
        <section id="key-concepts" role="article">
          <h1>Key Concepts</h1>
          <span class="badge">concepts</span>
          <span class="badge">messages</span>
          <span class="badge">routing</span>
          <span class="badge">filters</span>
          
          <p>Understanding core concepts is essential for effectively using Azure Service Bus in your applications.</p>

          <h2>Message Lifecycle</h2>
          <p>A message passes through several states from creation to completion or dead-lettering.</p>

          <div class="mermaid">
%%{ init: { "theme": "base", "fontFamily": "Segoe UI Semibold", "flowchart": { "useMaxWidth": true, "htmlLabels": true } } }%%
stateDiagram-v2
    [*] --> Sent: Producer sends message
    Sent --> Active: Message arrives in queue/topic
    
    Active --> Locked: Consumer receives message
    Locked --> Completed: Consumer completes message
    Locked --> Abandoned: Consumer abandons message
    Locked --> DeadLettered: Consumer dead-letters message
    Locked --> Deferred: Consumer defers message
    
    Abandoned --> Active: Message unlocked<br/>Delivery count incremented
    
    Active --> Expired: TTL exceeded
    Active --> DeadLettered: Max delivery count exceeded
    
    Deferred --> Retrieved: Retrieve by sequence number
    Retrieved --> Completed: Process and complete
    
    Expired --> DeadLettered: Move to DLQ
    Completed --> [*]
    DeadLettered --> [*]
    
    note right of Locked: Lock duration:<br/>Default 60 seconds
    note right of Active: Message available<br/>for consumption
    note right of DeadLettered: Requires manual<br/>intervention
          </div>

          <h2>Message States</h2>
          
          <h3>üü¢ Active</h3>
          <p>Message is in the queue/subscription and available for consumption. This is the normal state for new messages.</p>

          <h3>üîí Locked</h3>
          <p>Message is received by a consumer and locked for exclusive processing. Other consumers cannot access locked messages.</p>
          <pre class="syntax-highlighted" data-language="properties"><code>Lock Duration:         Default 60 seconds, configurable up to 5 minutes
Auto-Renewal:          Can be renewed automatically by SDK
Lock Token:            Unique identifier for completing/abandoning message</code></pre>

          <h3>‚úÖ Completed</h3>
          <p>Message successfully processed and removed from the queue. This is the terminal success state.</p>
          <pre class="syntax-highlighted" data-language="csharp"><code>await receiver.CompleteMessageAsync(message);
// Message permanently removed from queue</code></pre>

          <h3>üîÑ Abandoned</h3>
          <p>Message processing failed, returned to queue for another consumer. Delivery count incremented.</p>
          <pre class="syntax-highlighted" data-language="csharp"><code>await receiver.AbandonMessageAsync(message);
// Message becomes active again
// DeliveryCount incremented</code></pre>

          <h3>‚è∏Ô∏è Deferred</h3>
          <p>Message set aside for later retrieval. Must be retrieved explicitly using sequence number.</p>
          <pre class="syntax-highlighted" data-language="csharp"><code>var sequenceNumber = message.SequenceNumber;
await receiver.DeferMessageAsync(message);

// Later...
var deferredMsg = await receiver.ReceiveDeferredMessageAsync(sequenceNumber);</code></pre>

          <h3>üíÄ Dead-Lettered</h3>
          <p>Message moved to dead-letter sub-queue due to processing failures or expiration.</p>
          <pre class="syntax-highlighted" data-language="csharp"><code>await receiver.DeadLetterMessageAsync(message, 
    deadLetterReason: "ValidationFailed",
    deadLetterErrorDescription: "Invalid order format");</code></pre>

          <h2>Message Locking</h2>
          <p>Service Bus uses <strong>peek-lock</strong> delivery mode by default, ensuring messages aren't lost if processing fails.</p>

          <div class="mermaid">
sequenceDiagram
    participant Q as Queue
    participant C as Consumer
    participant B as Backend
    
    C->>Q: Receive Message (Peek-Lock)
    Q->>C: Message + Lock Token<br/>(Locked for 60 sec)
    
    Note over Q: Message locked,<br/>not visible to others
    
    C->>B: Process Message
    
    alt Success
        B-->>C: Success
        C->>Q: Complete (Lock Token)
        Q->>Q: Remove message
    else Failure
        B-->>C: Error
        C->>Q: Abandon (Lock Token)
        Q->>Q: Unlock, increment<br/>delivery count
    else Lock Expires
        Note over Q: Auto-unlock after<br/>60 seconds
        Q->>Q: Message becomes active
    end
          </div>

          <h3>‚öôÔ∏è Lock Renewal</h3>
          <p>For long-running operations, automatically renew the message lock:</p>
          <pre class="syntax-highlighted" data-language="csharp"><code>var processor = client.CreateProcessor("queue", new ServiceBusProcessorOptions
{
    MaxAutoLockRenewalDuration = TimeSpan.FromMinutes(5) // Auto-renew up to 5 minutes
});

processor.ProcessMessageAsync += async args =>
{
    // Long-running operation
    // SDK automatically renews lock
    await ProcessForLongTimeAsync(args.Message);
    
    await args.CompleteMessageAsync(args.Message);
};</code></pre>

          <h2>Delivery Count & Max Delivery</h2>
          <p>Service Bus tracks how many times a message has been delivered. After exceeding max delivery count, the message moves to dead-letter queue.</p>

          <div class="callout">
            <strong>üìä Delivery Count Tracking</strong><br />
            ‚Ä¢ <strong>DeliveryCount:</strong> Current number of delivery attempts<br />
            ‚Ä¢ <strong>MaxDeliveryCount:</strong> Configured limit (default: 10)<br />
            ‚Ä¢ <strong>Behavior:</strong> When DeliveryCount > MaxDeliveryCount, message dead-lettered
          </div>

          <pre class="syntax-highlighted" data-language="csharp"><code>processor.ProcessMessageAsync += async args =>
{
    Console.WriteLine($"Delivery attempt: {args.Message.DeliveryCount}");
    
    if (args.Message.DeliveryCount >= 3)
    {
        // Custom handling for repeated failures
        await LogRepeatedFailure(args.Message);
    }
    
    try
    {
        await ProcessMessage(args.Message);
        await args.CompleteMessageAsync(args.Message);
    }
    catch (TransientException)
    {
        // Let it retry automatically
        await args.AbandonMessageAsync(args.Message);
    }
    catch (PermanentException)
    {
        // No point retrying
        await args.DeadLetterMessageAsync(args.Message);
    }
};</code></pre>

          <h2>Time-to-Live (TTL)</h2>
          <p>Messages automatically expire after their TTL, preventing stale messages from accumulating.</p>

          <h3>üïê TTL Hierarchy</h3>
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Level</th>
                <th>Default</th>
                <th>Scope</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Queue/Topic</td>
                <td>14 days</td>
                <td>All messages in entity</td>
              </tr>
              <tr>
                <td>Message</td>
                <td>Inherits from entity</td>
                <td>Individual message</td>
              </tr>
            </tbody>
          </table>

          <h3>üìù Setting TTL</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>// Queue-level TTL
var queueOptions = new CreateQueueOptions("orders-queue")
{
    DefaultMessageTimeToLive = TimeSpan.FromHours(1)
};

// Message-level TTL (overrides queue default)
var message = new ServiceBusMessage("data")
{
    TimeToLive = TimeSpan.FromMinutes(30)
};

await sender.SendMessageAsync(message);</code></pre>

          <h2>Message Routing & Filters</h2>
          <p>Topic subscriptions use filters to control which messages are delivered to each subscription.</p>

          <h3>Filter Types</h3>
          
          <h4>1. SQL Filters</h4>
          <p>Powerful expression-based filtering using SQL-like syntax:</p>
          <pre class="syntax-highlighted" data-language="sql"><code class="language-sql"><span class="sql-comment">-- Simple property match</span>
<span class="sql-keyword">Priority</span> <span class="sql-operator">=</span> <span class="sql-string">'High'</span>

<span class="sql-comment">-- Multiple conditions</span>
<span class="sql-keyword">Priority</span> <span class="sql-operator">=</span> <span class="sql-string">'High'</span> <span class="sql-keyword">AND</span> <span class="sql-keyword">Region</span> <span class="sql-keyword">IN</span> (<span class="sql-string">'US'</span>, <span class="sql-string">'EU'</span>)

<span class="sql-comment">-- Numeric comparisons</span>
<span class="sql-keyword">OrderAmount</span> <span class="sql-operator">&gt;</span> <span class="sql-number">1000</span> <span class="sql-keyword">OR</span> <span class="sql-keyword">CustomerTier</span> <span class="sql-operator">=</span> <span class="sql-string">'Gold'</span>

<span class="sql-comment">-- System properties</span>
sys.<span class="sql-keyword">Label</span> <span class="sql-operator">=</span> <span class="sql-string">'OrderCreated'</span> <span class="sql-keyword">AND</span> sys.<span class="sql-keyword">ContentType</span> <span class="sql-operator">=</span> <span class="sql-string">'application/json'</span>

<span class="sql-comment">-- Pattern matching</span>
<span class="sql-keyword">Region</span> <span class="sql-keyword">LIKE</span> <span class="sql-string">'US-%'</span>

<span class="sql-comment">-- NULL checks</span>
<span class="sql-keyword">CancellationReason</span> <span class="sql-keyword">IS NULL</span></code></pre>

          <h4>2. Correlation Filters</h4>
          <p>Optimized for matching specific property values (faster than SQL filters):</p>
          <pre class="syntax-highlighted" data-language="csharp"><code>var filter = new CorrelationRuleFilter
{
    CorrelationId = "order-12345",
    Subject = "OrderCreated",
    Properties =
    {
        ["Priority"] = "High",
        ["Region"] = "US"
    }
};</code></pre>

          <h4>3. Boolean Filters</h4>
          <pre class="syntax-highlighted" data-language="csharp"><code>// True filter - receives all messages
var trueFilter = new TrueRuleFilter();

// False filter - receives no messages (subscription disabled)
var falseFilter = new FalseRuleFilter();</code></pre>

          <h3>üìã Filter Actions</h3>
          <p>Modify message properties before delivery to subscription:</p>
          <pre class="syntax-highlighted" data-language="csharp"><code>var ruleOptions = new CreateRuleOptions("HighPriorityRule")
{
    Filter = new SqlRuleFilter("Priority = 'High'"),
    Action = new SqlRuleAction(
        "SET ProcessedBy = 'PriorityQueue'; " +
        "SET ProcessedAt = @{datetime.utcnow};"
    )
};</code></pre>

          <h2>Message Routing Strategies</h2>

          <div class="mermaid">
%%{ init: { "theme": "base", "fontFamily": "Segoe UI Semibold", "flowchart": { "useMaxWidth": true, "htmlLabels": true } } }%%
graph TB
    P[Publisher] --> T[Topic: Orders]
    
    T --> S1["Subscription: All Orders<br/>Filter: None"]
    T --> S2["Subscription: High Priority<br/>Filter: Priority='High'"]
    T --> S3["Subscription: US Orders<br/>Filter: Region='US'"]
    T --> S4["Subscription: Large Orders<br/>Filter: Amount>1000"]
    
    S1 --> C1[Audit Service<br/>Logs everything]
    S2 --> C2[Priority Processing<br/>Fast lane]
    S3 --> C3[Regional Processing<br/>US datacenter]
    S4 --> C4[Review Service<br/>Manual approval]
    
    style S1 fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    style S2 fill:#ffcdd2,stroke:#c62828,stroke-width:2px
    style S3 fill:#fff9c4,stroke:#f9a825,stroke-width:2px
    style S4 fill:#c5e1a5,stroke:#689f38,stroke-width:2px
          </div>

          <h2>Partitioning (Standard Tier)</h2>
          <p>Partitioning enables higher throughput by distributing messages across multiple message brokers.</p>

          <div class="callout">
            <strong>‚ö†Ô∏è Important Notes</strong><br />
            ‚Ä¢ Available only in Basic and Standard tiers<br />
            ‚Ä¢ Premium tier uses dedicated resources, no partitioning needed<br />
            ‚Ä¢ Messages routed based on partition key or round-robin<br />
            ‚Ä¢ Cannot be changed after entity creation<br />
            ‚Ä¢ Ordering not guaranteed across partitions
          </div>

          <h3>üîë Partition Key</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>// Messages with same partition key go to same partition (ordered)
var message = new ServiceBusMessage("data")
{
    PartitionKey = customerId.ToString() // Messages per customer ordered
};

// Without partition key, round-robin distribution (no ordering)
var message = new ServiceBusMessage("data");</code></pre>

          <h2>Message Batching</h2>
          <p>Service Bus can batch multiple messages into a single transmission for improved efficiency.</p>

          <h3>Client-Side Batching</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>// Create optimized batch
using var batch = await sender.CreateMessageBatchAsync();

foreach (var item in items)
{
    var message = new ServiceBusMessage(JsonSerializer.Serialize(item));
    
    if (!batch.TryAddMessage(message))
    {
        // Send current batch and start new one
        await sender.SendMessagesAsync(batch);
        
        batch = await sender.CreateMessageBatchAsync();
        batch.TryAddMessage(message);
    }
}

// Send remaining messages
if (batch.Count > 0)
{
    await sender.SendMessagesAsync(batch);
}</code></pre>

          <h3>Server-Side Batching</h3>
          <p>Queue/topic can batch operations to storage:</p>
          <pre class="syntax-highlighted" data-language="csharp"><code>var queueOptions = new CreateQueueOptions("orders-queue")
{
    EnableBatchedOperations = true // Batch writes to storage
};</code></pre>

          <h2>Prefetching</h2>
          <p>Improve throughput by receiving multiple messages in the background before they're needed.</p>

          <pre class="syntax-highlighted" data-language="csharp"><code>var processor = client.CreateProcessor("orders-queue", new ServiceBusProcessorOptions
{
    PrefetchCount = 20, // Fetch 20 messages ahead
    MaxConcurrentCalls = 5
});

// SDK maintains local cache of prefetched messages
// Reduces network latency per message</code></pre>

          <div class="callout">
            <strong>üí° Prefetch Guidelines</strong><br />
            ‚Ä¢ Set PrefetchCount to MaxConcurrentCalls √ó Expected processing time (seconds)<br />
            ‚Ä¢ Higher prefetch = better throughput but more memory<br />
            ‚Ä¢ Not suitable for long message locks or sessions<br />
            ‚Ä¢ Default is 0 (disabled)
          </div>
        </section>

        <!-- Security & Authentication Section -->
        <section id="security" role="article">
          <h1>Security & Authentication</h1>
          <span class="badge">security</span>
          <span class="badge">authentication</span>
          <span class="badge">authorization</span>
          <span class="badge">sas</span>
          
          <p>Azure Service Bus provides multiple authentication and authorization mechanisms to secure your messaging infrastructure.</p>

          <h2>Authentication Methods</h2>

          <div class="mermaid">
%%{ init: { "theme": "base", "fontFamily": "Segoe UI Semibold", "flowchart": { "useMaxWidth": true, "htmlLabels": true } } }%%
graph TB
    subgraph "Authentication Options"
        AAD["Azure Active Directory<br/>(Managed Identity)"]
        SAS["Shared Access Signature<br/>(SAS Keys)"]
        CONN["Connection String<br/>(SAS-based)"]
    end
    
    subgraph "Use Cases"
        PROD["Production Applications<br/>‚úÖ Most Secure"]
        DEV["Development/Testing<br/>‚ö†Ô∏è Convenient"]
        LEGACY["Legacy Applications<br/>‚ö†Ô∏è Simple"]
    end
    
    AAD --> PROD
    SAS --> DEV
    CONN --> LEGACY
    
    style AAD fill:#0078d4,stroke:#005a9e,stroke-width:3px,color:#fff
    style SAS fill:#ffd43b,stroke:#f59f00,stroke-width:2px,color:#000
    style CONN fill:#ff8787,stroke:#c92a2a,stroke-width:2px,color:#fff
    style PROD fill:#51cf66,stroke:#2f9e44,stroke-width:2px,color:#000
          </div>

          <h2>1. Azure Active Directory (Recommended)</h2>
          <p>Use <strong>Azure AD</strong> with <strong>Managed Identities</strong> for passwordless authentication. This is the most secure option.</p>

          <h3>‚úÖ Benefits</h3>
          <ul>
            <li>No secrets in code or configuration</li>
            <li>Automatic credential rotation</li>
            <li>Fine-grained RBAC permissions</li>
            <li>Audit logs for all operations</li>
            <li>Works with Managed Identity, Service Principal, or user accounts</li>
          </ul>

          <h3>üîê RBAC Roles</h3>
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Role</th>
                <th>Permissions</th>
                <th>Use Case</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Azure Service Bus Data Owner</td>
                <td>Full access (send, receive, manage)</td>
                <td>Admin access</td>
              </tr>
              <tr>
                <td>Azure Service Bus Data Sender</td>
                <td>Send messages only</td>
                <td>Producer applications</td>
              </tr>
              <tr>
                <td>Azure Service Bus Data Receiver</td>
                <td>Receive messages only</td>
                <td>Consumer applications</td>
              </tr>
            </tbody>
          </table>

          <h3>üìù Code Example: Managed Identity</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>// Automatically uses Managed Identity (no credentials needed)
var client = new ServiceBusClient(
    fullyQualifiedNamespace: "myservicebus.servicebus.windows.net",
    credential: new DefaultAzureCredential()
);

var sender = client.CreateSender("orders-queue");
await sender.SendMessageAsync(new ServiceBusMessage("Order data"));</code></pre>

          <h3>üìù Code Example: Service Principal</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>var credential = new ClientSecretCredential(
    tenantId: "tenant-id",
    clientId: "client-id",
    clientSecret: "client-secret"
);

var client = new ServiceBusClient(
    fullyQualifiedNamespace: "myservicebus.servicebus.windows.net",
    credential: credential
);</code></pre>

          <h3>‚öôÔ∏è Setup Steps</h3>
          <pre class="syntax-highlighted" data-language="bash"><code># 1. Enable system-assigned managed identity on Azure resource (App Service, Function, VM)
az webapp identity assign --name myapp --resource-group mygroup

# 2. Grant RBAC role to managed identity
az role assignment create \
  --role "Azure Service Bus Data Sender" \
  --assignee <managed-identity-principal-id> \
  --scope /subscriptions/{sub-id}/resourceGroups/{rg}/providers/Microsoft.ServiceBus/namespaces/{namespace}

# 3. Use DefaultAzureCredential in code (automatically finds managed identity)</code></pre>

          <h2>2. Shared Access Signatures (SAS)</h2>
          <p><strong>SAS</strong> provides delegated access using shared keys. Each namespace and entity can have multiple SAS policies.</p>

          <h3>üîë SAS Policy Levels</h3>
          <ul>
            <li><strong>Namespace Level:</strong> Access to all entities in namespace</li>
            <li><strong>Entity Level:</strong> Access to specific queue or topic</li>
          </ul>

          <h3>üìã SAS Permissions</h3>
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Permission</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>Send</strong></td>
                <td>Send messages to entity</td>
              </tr>
              <tr>
                <td><strong>Listen</strong></td>
                <td>Receive messages from entity</td>
              </tr>
              <tr>
                <td><strong>Manage</strong></td>
                <td>Manage entity (create, delete, update)</td>
              </tr>
            </tbody>
          </table>

          <h3>üìù Code Example: SAS Token</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>var credential = new AzureNamedKeyCredential(
    name: "RootManageSharedAccessKey",
    key: "your-sas-key"
);

var client = new ServiceBusClient(
    fullyQualifiedNamespace: "myservicebus.servicebus.windows.net",
    credential: credential
);</code></pre>

          <h3>‚öôÔ∏è Creating SAS Policy via Azure CLI</h3>
          <pre class="syntax-highlighted" data-language="bash"><code># Create namespace-level SAS policy
az servicebus namespace authorization-rule create \
  --namespace-name myservicebus \
  --resource-group mygroup \
  --name SendOnlyPolicy \
  --rights Send

# Create queue-level SAS policy
az servicebus queue authorization-rule create \
  --namespace-name myservicebus \
  --queue-name orders-queue \
  --resource-group mygroup \
  --name ReceiveOnlyPolicy \
  --rights Listen</code></pre>

          <h2>3. Connection Strings</h2>
          <p>Connection strings contain embedded SAS credentials. Convenient but less secure than other methods.</p>

          <h3>üìù Code Example</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>var connectionString = "Endpoint=sb://myservicebus.servicebus.windows.net/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=key";

var client = new ServiceBusClient(connectionString);
var sender = client.CreateSender("orders-queue");</code></pre>

          <div class="callout">
            <strong>‚ö†Ô∏è Security Warning</strong><br />
            Never commit connection strings to source control. Store them in Azure Key Vault or use Managed Identity instead.
          </div>

          <h2>Network Security</h2>

          <h3>1. IP Firewall Rules</h3>
          <p>Restrict access to specific IP addresses or ranges (available in Standard and Premium).</p>

          <pre class="syntax-highlighted" data-language="bash"><code># Add IP firewall rule
az servicebus namespace network-rule add \
  --namespace-name myservicebus \
  --resource-group mygroup \
  --ip-address 203.0.113.42

# Add IP range
az servicebus namespace network-rule add \
  --namespace-name myservicebus \
  --resource-group mygroup \
  --ip-address 203.0.113.0/24</code></pre>

          <h3>2. Virtual Network (VNet) Service Endpoints</h3>
          <p>Allow access from specific Azure VNets (Premium tier only).</p>

          <pre class="syntax-highlighted" data-language="bash"><code># Enable VNet service endpoint
az servicebus namespace network-rule add \
  --namespace-name myservicebus \
  --resource-group mygroup \
  --subnet /subscriptions/{sub-id}/resourceGroups/{rg}/providers/Microsoft.Network/virtualNetworks/{vnet}/subnets/{subnet}</code></pre>

          <h3>3. Private Endpoints</h3>
          <p>Private connectivity using Azure Private Link (Premium tier only).</p>

          <div class="mermaid">
%%{ init: { "theme": "base", "fontFamily": "Segoe UI Semibold", "flowchart": { "useMaxWidth\": true, \"htmlLabels\": true } } }%%
graph TB
    subgraph "Azure VNet"
        VM[Virtual Machine]
        APP[App Service<br/>VNet Integration]
        PE[Private Endpoint<br/>10.0.1.4]
    end
    
    subgraph "Service Bus Premium"
        NS[Namespace<br/>Private IP Only]
    end
    
    VM --> PE
    APP --> PE
    PE -.Private Link.-> NS
    
    Internet[Internet] -.X Blocked.-> NS
    
    style PE fill:#0078d4,stroke:#005a9e,stroke-width:2px,color:#fff
    style NS fill:#00bcf2,stroke:#0098c3,stroke-width:2px,color:#000
          </div>

          <h3>‚öôÔ∏è Create Private Endpoint</h3>
          <pre class="syntax-highlighted" data-language="bash"><code># Create private endpoint
az network private-endpoint create \
  --name sb-private-endpoint \
  --resource-group mygroup \
  --vnet-name myvnet \
  --subnet mysubnet \
  --private-connection-resource-id /subscriptions/{sub-id}/resourceGroups/{rg}/providers/Microsoft.ServiceBus/namespaces/myservicebus \
  --group-id namespace \
  --connection-name sb-connection</code></pre>

          <h2>Encryption</h2>

          <h3>üîí Encryption at Rest</h3>
          <p>All data automatically encrypted at rest using Microsoft-managed keys. Premium tier supports customer-managed keys (CMK).</p>

          <h4>Customer-Managed Keys (Premium)</h4>
          <pre class="syntax-highlighted" data-language="bash"><code># Enable customer-managed key
az servicebus namespace encryption create \
  --namespace-name myservicebus \
  --resource-group mygroup \
  --encryption-config key-name=mykey \
    key-vault-uri=https://myvault.vault.azure.net \
    user-assigned-identity=/subscriptions/{sub}/resourceGroups/{rg}/providers/Microsoft.ManagedIdentity/userAssignedIdentities/{identity}</code></pre>

          <h3>üîê Encryption in Transit</h3>
          <p>All communication encrypted using TLS 1.2+. Cannot be disabled.</p>

          <ul>
            <li>All client connections use TLS 1.2 or higher</li>
            <li>AMQP over TLS</li>
            <li>HTTPS for management operations</li>
          </ul>

          <h2>Security Best Practices</h2>

          <div class="callout">
            <strong>‚úÖ Recommended Practices</strong><br />
            1. <strong>Use Managed Identity</strong> - Eliminate credential management<br />
            2. <strong>Least Privilege</strong> - Grant minimum required permissions (Sender/Receiver, not Owner)<br />
            3. <strong>Separate Credentials</strong> - Different credentials for producers and consumers<br />
            4. <strong>Network Isolation</strong> - Use Private Endpoints in production (Premium)<br />
            5. <strong>Monitor Access</strong> - Enable diagnostic logs and alerts<br />
            6. <strong>Rotate Keys</strong> - Regularly rotate SAS keys if used<br />
            7. <strong>Secure Secrets</strong> - Store connection strings in Key Vault<br />
            8. <strong>Use Premium</strong> - For VNet integration and enhanced security
          </div>

          <h2>Compliance & Certifications</h2>
          <ul>
            <li>ISO/IEC 27001, 27018, 27701</li>
            <li>SOC 1, 2, 3</li>
            <li>HIPAA/HITECH</li>
            <li>PCI DSS Level 1</li>
            <li>FedRAMP High</li>
            <li>GDPR compliant</li>
          </ul>

          <h2>Audit & Compliance</h2>
          
          <h3>üìä Diagnostic Logs</h3>
          <pre class="syntax-highlighted" data-language="bash"><code># Enable diagnostic settings
az monitor diagnostic-settings create \
  --name sb-diagnostics \
  --resource /subscriptions/{sub}/resourceGroups/{rg}/providers/Microsoft.ServiceBus/namespaces/myservicebus \
  --logs '[{"category":"OperationalLogs","enabled":true}]' \
  --metrics '[{"category":"AllMetrics","enabled":true}]' \
  --workspace /subscriptions/{sub}/resourceGroups/{rg}/providers/Microsoft.OperationalInsights/workspaces/myworkspace</code></pre>

          <h3>üîç Log Categories</h3>
          <ul>
            <li><strong>OperationalLogs</strong> - All management operations</li>
            <li><strong>RuntimeAuditLogs</strong> - Runtime operation logs (Premium only)</li>
            <li><strong>ApplicationMetricsLogs</strong> - Application-level metrics</li>
          </ul>
        </section>

        <!-- Integration Section -->
        <section id="integration" role="article">
          <h1>Integration with Azure Services</h1>
          <span class="badge">integration</span>
          <span class="badge">azure</span>
          <span class="badge">eventgrid</span>
          <span class="badge">logicapps</span>
          
          <p>Azure Service Bus integrates seamlessly with many Azure services, enabling powerful event-driven architectures and workflows.</p>

          <h2>Integration Architecture</h2>

          <div class="mermaid">
%%{ init: { "theme": "base", "fontFamily": "Segoe UI Semibold", "flowchart": { "useMaxWidth": true, "htmlLabels": true } } }%%
graph TB
    subgraph "Message Producers"
        API[API Apps]
        WEB[Web Apps]
        MOBILE[Mobile Apps]
    end
    
    subgraph "Azure Service Bus"
        Q[Queues]
        T[Topics]
    end
    
    subgraph "Azure Integration Services"
        LA[Logic Apps]
        FUNC[Azure Functions]
        EG[Event Grid]
        SA[Stream Analytics]
    end
    
    subgraph "Data Services"
        COSMOS[Cosmos DB]
        SQL[SQL Database]
        STORAGE[Blob Storage]
    end
    
    subgraph "Monitoring & Analytics"
        MON[Azure Monitor]
        AI[Application Insights]
        LA2[Log Analytics]
    end
    
    API --> Q
    WEB --> T
    MOBILE --> Q
    
    Q --> FUNC
    Q --> LA
    T --> EG
    T --> SA
    
    FUNC --> COSMOS
    LA --> SQL
    EG --> STORAGE
    
    Q -.Metrics.-> MON
    T -.Logs.-> AI
    Q -.Diagnostics.-> LA2
    
    style Q fill:#0078d4,stroke:#005a9e,stroke-width:2px,color:#fff
    style T fill:#00bcf2,stroke:#0098c3,stroke-width:2px,color:#000
          </div>

          <h2>1. Azure Functions</h2>
          <p>Process Service Bus messages using serverless compute with automatic scaling.</p>

          <h3>üéØ Key Benefits</h3>
          <ul>
            <li>Automatic trigger on new messages</li>
            <li>Built-in retry and error handling</li>
            <li>Scales automatically based on queue length</li>
            <li>Supports both queue and topic triggers</li>
            <li>Works with sessions</li>
          </ul>

          <h3>üìù Queue Trigger Example</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>[FunctionName("ProcessOrder")]
public static async Task Run(
    [ServiceBusTrigger("orders-queue", Connection = "ServiceBusConnection")]
    string messageBody,
    Int32 deliveryCount,
    string messageId,
    ILogger log)
{
    log.LogInformation($"Processing order: {messageId}");
    log.LogInformation($"Delivery count: {deliveryCount}");
    
    var order = JsonSerializer.Deserialize<Order>(messageBody);
    await ProcessOrderAsync(order);
}</code></pre>

          <h3>üìù Topic Trigger with Session Example</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>[FunctionName("ProcessOrderSession")]
public static async Task Run(
    [ServiceBusTrigger("orders-topic", "high-priority-sub", 
                       Connection = "ServiceBusConnection",
                       IsSessionsEnabled = true)]
    string messageBody,
    string sessionId,
    ILogger log)
{
    log.LogInformation($"Session {sessionId}: Processing message");
    await ProcessInOrderAsync(messageBody, sessionId);
}</code></pre>

          <h3>‚öôÔ∏è Function Configuration (host.json)</h3>
          <pre class="syntax-highlighted" data-language="json"><code class="language-json"><span class="json-punctuation">{</span>
  <span class="json-key">"version"</span><span class="json-punctuation">:</span> <span class="json-string">"2.0"</span><span class="json-punctuation">,</span>
  <span class="json-key">"extensions"</span><span class="json-punctuation">:</span> <span class="json-punctuation">{</span>
    <span class="json-key">"serviceBus"</span><span class="json-punctuation">:</span> <span class="json-punctuation">{</span>
      <span class="json-key">"prefetchCount"</span><span class="json-punctuation">:</span> <span class="json-number">100</span><span class="json-punctuation">,</span>
      <span class="json-key">"messageHandlerOptions"</span><span class="json-punctuation">:</span> <span class="json-punctuation">{</span>
        <span class="json-key">"autoComplete"</span><span class="json-punctuation">:</span> <span class="json-boolean">true</span><span class="json-punctuation">,</span>
        <span class="json-key">"maxConcurrentCalls"</span><span class="json-punctuation">:</span> <span class="json-number">16</span><span class="json-punctuation">,</span>
        <span class="json-key">"maxAutoRenewDuration"</span><span class="json-punctuation">:</span> <span class="json-string">"00:05:00"</span>
      <span class="json-punctuation">}</span>
    <span class="json-punctuation">}</span>
  <span class="json-punctuation">}</span>
<span class="json-punctuation">}</span></code></pre>

          <h2>2. Logic Apps</h2>
          <p>Build automated workflows that trigger on Service Bus messages without writing code.</p>

          <h3>üîÑ Common Patterns</h3>
          <ul>
            <li>Process messages and update databases</li>
            <li>Send notifications (email, SMS, Teams)</li>
            <li>Call external APIs</li>
            <li>File processing workflows</li>
            <li>Data transformation and routing</li>
          </ul>

          <h3>üìã Sample Logic App Workflow</h3>
          <div class="mermaid">
%%{ init: { "theme": "base", "fontFamily": "Segoe UI Semibold", "flowchart": { "useMaxWidth": true, "htmlLabels": true } } }%%
graph LR
    SB[Service Bus Trigger<br/>New Order Message] --> PARSE[Parse JSON<br/>Extract Order Data]
    PARSE --> VALIDATE{Validate<br/>Order Amount}
    
    VALIDATE -->|> $1000| APPROVE[Send Approval<br/>Request Email]
    VALIDATE -->|<= $1000| PROCESS[Auto-Process<br/>Order]
    
    APPROVE --> WAIT[Wait for<br/>Approval Response]
    WAIT --> PROCESS
    
    PROCESS --> DB[Update SQL<br/>Database]
    DB --> NOTIFY[Send Teams<br/>Notification]
    NOTIFY --> COMPLETE[Complete<br/>Message]
    
    style SB fill:#0078d4,stroke:#005a9e,stroke-width:2px,color:#fff
    style VALIDATE fill:#ffd43b,stroke:#f59f00,stroke-width:2px,color:#000
          </div>

          <h3>‚öôÔ∏è Service Bus Connector Actions</h3>
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Action</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>When a message is received</td>
                <td>Trigger workflow on new message</td>
              </tr>
              <tr>
                <td>When messages are available (session)</td>
                <td>Trigger with session support</td>
              </tr>
              <tr>
                <td>Send message</td>
                <td>Send message to queue or topic</td>
              </tr>
              <tr>
                <td>Complete message</td>
                <td>Mark message as successfully processed</td>
              </tr>
              <tr>
                <td>Abandon message</td>
                <td>Return message to queue</td>
              </tr>
              <tr>
                <td>Dead-letter message</td>
                <td>Move message to dead-letter queue</td>
              </tr>
            </tbody>
          </table>

          <h2>3. Azure Event Grid</h2>
          <p>React to Service Bus events using Event Grid's event-driven architecture.</p>

          <h3>üì¢ Available Events</h3>
          <ul>
            <li><strong>ActiveMessagesAvailableWithNoListeners</strong> - Messages waiting but no active receivers</li>
            <li><strong>DeadletterMessagesAvailableWithNoListeners</strong> - Messages in DLQ with no listeners</li>
          </ul>

          <h3>üîî Event Schema Example</h3>
          <pre class="syntax-highlighted" data-language="json"><code class="language-json"><span class="json-punctuation">{</span>
  <span class="json-key">"topic"</span><span class="json-punctuation">:</span> <span class="json-string">"/subscriptions/{sub-id}/resourceGroups/{rg}/providers/Microsoft.ServiceBus/namespaces/myservicebus"</span><span class="json-punctuation">,</span>
  <span class="json-key">"subject"</span><span class="json-punctuation">:</span> <span class="json-string">"topics/orders-topic/subscriptions/high-priority"</span><span class="json-punctuation">,</span>
  <span class="json-key">"eventType"</span><span class="json-punctuation">:</span> <span class="json-string">"Microsoft.ServiceBus.ActiveMessagesAvailableWithNoListeners"</span><span class="json-punctuation">,</span>
  <span class="json-key">"eventTime"</span><span class="json-punctuation">:</span> <span class="json-string">"2025-12-24T10:00:00Z"</span><span class="json-punctuation">,</span>
  <span class="json-key">"id"</span><span class="json-punctuation">:</span> <span class="json-string">"event-id-12345"</span><span class="json-punctuation">,</span>
  <span class="json-key">"data"</span><span class="json-punctuation">:</span> <span class="json-punctuation">{</span>
    <span class="json-key">"namespaceName"</span><span class="json-punctuation">:</span> <span class="json-string">"myservicebus"</span><span class="json-punctuation">,</span>
    <span class="json-key">"requestUri"</span><span class="json-punctuation">:</span> <span class="json-string">"https://myservicebus.servicebus.windows.net/orders-topic/subscriptions/high-priority/messages/head"</span><span class="json-punctuation">,</span>
    <span class="json-key">"entityType"</span><span class="json-punctuation">:</span> <span class="json-string">"subscriber"</span><span class="json-punctuation">,</span>
    <span class="json-key">"queueName"</span><span class="json-punctuation">:</span> <span class="json-null">null</span><span class="json-punctuation">,</span>
    <span class="json-key">"topicName"</span><span class="json-punctuation">:</span> <span class="json-string">"orders-topic"</span><span class="json-punctuation">,</span>
    <span class="json-key">"subscriptionName"</span><span class="json-punctuation">:</span> <span class="json-string">"high-priority"</span>
  <span class="json-punctuation">}</span>
<span class="json-punctuation">}</span></code></pre>

          <h3>‚öôÔ∏è Create Event Grid Subscription</h3>
          <pre class="syntax-highlighted" data-language="bash"><code># Create Event Grid subscription for Service Bus events
az eventgrid event-subscription create \
  --name sb-alert-subscription \
  --source-resource-id /subscriptions/{sub-id}/resourceGroups/{rg}/providers/Microsoft.ServiceBus/namespaces/myservicebus \
  --endpoint https://myfunction.azurewebsites.net/api/AlertFunction \
  --endpoint-type webhook \
  --included-event-types Microsoft.ServiceBus.ActiveMessagesAvailableWithNoListeners</code></pre>

          <h2>4. Azure Stream Analytics</h2>
          <p>Perform real-time analytics on streaming data from Service Bus.</p>

          <h3>üìä Use Cases</h3>
          <ul>
            <li>Real-time aggregations and analytics</li>
            <li>Anomaly detection in message streams</li>
            <li>Windowed computations (tumbling, sliding, hopping)</li>
            <li>Message filtering and transformation</li>
            <li>Output to multiple sinks (Cosmos DB, Power BI, SQL)</li>
          </ul>

          <h3>üìù Sample Query</h3>
          <pre class="syntax-highlighted" data-language="sql"><code class="language-sql"><span class="sql-comment">-- Calculate average order amount per region in 5-minute windows</span>
<span class="sql-keyword">SELECT</span>
    Region,
    System.Timestamp <span class="sql-keyword">AS</span> WindowEnd,
    <span class="sql-function">AVG</span>(OrderAmount) <span class="sql-keyword">AS</span> AvgAmount,
    <span class="sql-function">COUNT</span>(*) <span class="sql-keyword">AS</span> OrderCount
<span class="sql-keyword">FROM</span>
    ServiceBusInput TIMESTAMP <span class="sql-keyword">BY</span> EventTime
<span class="sql-keyword">GROUP BY</span>
    Region,
    TumblingWindow(minute, <span class="sql-number">5</span>)
<span class="sql-keyword">HAVING</span>
    <span class="sql-function">AVG</span>(OrderAmount) <span class="sql-operator">&gt;</span> <span class="sql-number">1000</span></code></pre>

          <h2>5. API Management</h2>
          <p>Expose Service Bus operations through managed APIs with policies and rate limiting.</p>

          <div class="mermaid">
sequenceDiagram
    participant C as Client
    participant APIM as API Management
    participant SB as Service Bus
    participant FUNC as Azure Function
    
    C->>APIM: POST /api/orders
    APIM->>APIM: Apply policies<br/>Rate limit, Transform
    APIM->>SB: Send message to queue
    SB-->>APIM: Accepted
    APIM-->>C: 202 Accepted
    
    Note over SB,FUNC: Asynchronous processing
    
    SB->>FUNC: Trigger function
    FUNC->>FUNC: Process order
    FUNC-->>SB: Complete message
          </div>

          <h3>üìã APIM Policy Example</h3>
          <pre class="syntax-highlighted" data-language="xml"><code>&lt;policies&gt;
  &lt;inbound&gt;
    &lt;rate-limit calls="100" renewal-period="60" /&gt;
    &lt;set-header name="MessageId" exists-action="override"&gt;
      &lt;value&gt;@(Guid.NewGuid().ToString())&lt;/value&gt;
    &lt;/set-header&gt;
    &lt;send-one-way-request mode="new"&gt;
      &lt;set-url&gt;@{
        return "https://myservicebus.servicebus.windows.net/orders-queue/messages";
      }&lt;/set-url&gt;
      &lt;set-method&gt;POST&lt;/set-method&gt;
      &lt;set-header name="Authorization" exists-action="override"&gt;
        &lt;value&gt;@(context.Request.Headers.GetValueOrDefault("ServiceBusToken"))&lt;/value&gt;
      &lt;/set-header&gt;
      &lt;set-body&gt;@(context.Request.Body.As&lt;string&gt;())&lt;/set-body&gt;
    &lt;/send-one-way-request&gt;
    &lt;return-response&gt;
      &lt;set-status code="202" reason="Accepted" /&gt;
    &lt;/return-response&gt;
  &lt;/inbound&gt;
&lt;/policies&gt;</code></pre>

          <h2>6. Azure Data Factory</h2>
          <p>Orchestrate data movement and transformation with Service Bus integration.</p>

          <h3>üì¶ Capabilities</h3>
          <ul>
            <li>Send messages after data pipeline completion</li>
            <li>Trigger pipelines based on Service Bus messages</li>
            <li>Coordinate complex ETL workflows</li>
            <li>Error notification via Service Bus</li>
          </ul>

          <h2>7. Azure Cosmos DB Change Feed</h2>
          <p>Publish Cosmos DB changes to Service Bus for downstream processing.</p>

          <div class="mermaid">
%%{ init: { "theme": "base", "fontFamily": "Segoe UI Semibold", "flowchart": { "useMaxWidth": true, "htmlLabels": true } } }%%
graph LR
    COSMOS[Cosmos DB<br/>Container] --> CF[Change Feed]
    CF --> FUNC[Azure Function<br/>Change Feed Trigger]
    FUNC --> SB[Service Bus Topic]
    
    SB --> S1[Subscription<br/>Audit Service]
    SB --> S2[Subscription<br/>Cache Invalidation]
    SB --> S3[Subscription<br/>Notification Service]
    
    style COSMOS fill:#0078d4,stroke:#005a9e,stroke-width:2px,color:#fff
    style SB fill:#00bcf2,stroke:#0098c3,stroke-width:2px,color:#000
          </div>

          <h3>üìù Code Example</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>[FunctionName("CosmosToServiceBus")]
public static async Task Run(
    [CosmosDBTrigger(
        databaseName: "Orders",
        containerName: "OrderItems",
        Connection = "CosmosConnection",
        LeaseContainerName = "leases")]
    IReadOnlyList&lt;Document&gt; documents,
    [ServiceBus("order-changes-topic", Connection = "ServiceBusConnection")]
    IAsyncCollector&lt;ServiceBusMessage&gt; messages,
    ILogger log)
{
    foreach (var doc in documents)
    {
        var message = new ServiceBusMessage(JsonSerializer.Serialize(doc))
        {
            Subject = "OrderChanged",
            ApplicationProperties = { ["EntityId"] = doc.Id }
        };
        
        await messages.AddAsync(message);
    }
}</code></pre>

          <h2>8. Azure Key Vault</h2>
          <p>Store Service Bus connection strings and SAS keys securely.</p>

          <h3>üìù Access from Application</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>// Use Key Vault reference in App Settings
var connectionString = Environment.GetEnvironmentVariable("ServiceBusConnection");
// App Setting value: @Microsoft.KeyVault(SecretUri=https://myvault.vault.azure.net/secrets/ServiceBusConnection/)

var client = new ServiceBusClient(connectionString);</code></pre>

          <h2>Integration Patterns Summary</h2>
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Service</th>
                <th>Pattern</th>
                <th>Best For</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Azure Functions</td>
                <td>Event-driven compute</td>
                <td>Message processing, serverless workflows</td>
              </tr>
              <tr>
                <td>Logic Apps</td>
                <td>Workflow automation</td>
                <td>No-code integrations, business processes</td>
              </tr>
              <tr>
                <td>Event Grid</td>
                <td>Event routing</td>
                <td>React to Service Bus events, alerting</td>
              </tr>
              <tr>
                <td>Stream Analytics</td>
                <td>Real-time analytics</td>
                <td>Streaming data processing, aggregations</td>
              </tr>
              <tr>
                <td>API Management</td>
                <td>API gateway</td>
                <td>Expose messaging via REST APIs</td>
              </tr>
              <tr>
                <td>Data Factory</td>
                <td>Data orchestration</td>
                <td>ETL pipelines, data movement</td>
              </tr>
              <tr>
                <td>Cosmos DB</td>
                <td>Change feed publisher</td>
                <td>Database change notifications</td>
              </tr>
              <tr>
                <td>Key Vault</td>
                <td>Secret management</td>
                <td>Secure credential storage</td>
              </tr>
            </tbody>
          </table>
        </section>

        <!-- Monitoring & Diagnostics Section -->
        <section id="monitoring" role="article">
          <h1>Monitoring & Diagnostics</h1>
          <span class="badge">monitoring</span>
          <span class="badge">diagnostics</span>
          <span class="badge">metrics</span>
          <span class="badge">alerts</span>
          
          <p>Comprehensive monitoring and diagnostics are essential for maintaining healthy Service Bus operations and quickly identifying issues.</p>

          <h2>Azure Monitor Integration</h2>
          <p>Service Bus natively integrates with Azure Monitor for metrics, logs, and alerts.</p>

          <div class="mermaid">
%%{ init: { "theme": "base", "fontFamily": "Segoe UI Semibold", "flowchart": { "useMaxWidth": true, "htmlLabels": true } } }%%
graph TB
    subgraph "Service Bus Namespace"
        Q[Queues]
        T[Topics]
        S[Subscriptions]
    end
    
    subgraph "Azure Monitor"
        M[Metrics]
        L[Logs]
        A[Alerts]
    end
    
    subgraph "Destinations"
        LA[Log Analytics]
        ST[Storage Account]
        EH[Event Hub]
        AI[Application Insights]
    end
    
    Q --> M
    T --> M
    S --> M
    
    Q --> L
    T --> L
    S --> L
    
    M --> A
    L --> A
    
    L --> LA
    L --> ST
    L --> EH
    M --> AI
    
    style M fill:#0078d4,stroke:#005a9e,stroke-width:2px,color:#fff
    style L fill:#00bcf2,stroke:#0098c3,stroke-width:2px,color:#000
    style A fill:#ff6b6b,stroke:#c92a2a,stroke-width:2px,color:#fff
          </div>

          <h2>Key Metrics</h2>
          
          <h3>üìä Message Metrics</h3>
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Metric</th>
                <th>Description</th>
                <th>Alert Threshold</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>Active Messages</strong></td>
                <td>Number of messages available for processing</td>
                <td>High watermark (e.g., > 1000)</td>
              </tr>
              <tr>
                <td><strong>Dead-letter Messages</strong></td>
                <td>Messages in dead-letter queue</td>
                <td>> 0 (investigate immediately)</td>
              </tr>
              <tr>
                <td><strong>Scheduled Messages</strong></td>
                <td>Messages scheduled for future delivery</td>
                <td>Monitor for growth</td>
              </tr>
              <tr>
                <td><strong>Incoming Messages</strong></td>
                <td>Messages sent to queue/topic</td>
                <td>Monitor rate changes</td>
              </tr>
              <tr>
                <td><strong>Outgoing Messages</strong></td>
                <td>Messages delivered to consumers</td>
                <td>Compare with incoming</td>
              </tr>
              <tr>
                <td><strong>Abandoned Messages</strong></td>
                <td>Messages abandoned by consumers</td>
                <td>High rate indicates issues</td>
              </tr>
            </tbody>
          </table>

          <h3>‚ö° Performance Metrics</h3>
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Metric</th>
                <th>Description</th>
                <th>Healthy Range</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>Server Send Latency</strong></td>
                <td>Time to send message</td>
                <td>< 100ms (p95)</td>
              </tr>
              <tr>
                <td><strong>Server Receive Latency</strong></td>
                <td>Time to receive message</td>
                <td>< 100ms (p95)</td>
              </tr>
              <tr>
                <td><strong>Throttled Requests</strong></td>
                <td>Requests rejected due to limits</td>
                <td>0 (scale up if > 0)</td>
              </tr>
              <tr>
                <td><strong>Server Errors</strong></td>
                <td>5xx errors from Service Bus</td>
                <td>< 0.1% error rate</td>
              </tr>
              <tr>
                <td><strong>User Errors</strong></td>
                <td>4xx errors (client issues)</td>
                <td>Monitor trends</td>
              </tr>
            </tbody>
          </table>

          <h3>üíæ Resource Metrics (Premium)</h3>
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Metric</th>
                <th>Description</th>
                <th>Alert Threshold</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>CPU Usage</strong></td>
                <td>Namespace CPU percentage</td>
                <td>> 70% sustained</td>
              </tr>
              <tr>
                <td><strong>Memory Usage</strong></td>
                <td>Namespace memory percentage</td>
                <td>> 80% sustained</td>
              </tr>
              <tr>
                <td><strong>Namespace Size</strong></td>
                <td>Storage used by namespace</td>
                <td>> 80% of quota</td>
              </tr>
            </tbody>
          </table>

          <h2>Diagnostic Logs</h2>

          <h3>üìã Log Categories</h3>
          
          <h4>1. Operational Logs</h4>
          <p>Track all management plane operations (create, update, delete entities).</p>
          <pre class="syntax-highlighted" data-language="json"><code class="language-json"><span class="json-punctuation">{</span>
  <span class="json-key">"time"</span><span class="json-punctuation">:</span> <span class="json-string">"2025-12-24T10:30:00Z"</span><span class="json-punctuation">,</span>
  <span class="json-key">"category"</span><span class="json-punctuation">:</span> <span class="json-string">"OperationalLogs"</span><span class="json-punctuation">,</span>
  <span class="json-key">"operationName"</span><span class="json-punctuation">:</span> <span class="json-string">"Microsoft.ServiceBus/namespaces/queues/write"</span><span class="json-punctuation">,</span>
  <span class="json-key">"resultType"</span><span class="json-punctuation">:</span> <span class="json-string">"Success"</span><span class="json-punctuation">,</span>
  <span class="json-key">"properties"</span><span class="json-punctuation">:</span> <span class="json-punctuation">{</span>
    <span class="json-key">"entityName"</span><span class="json-punctuation">:</span> <span class="json-string">"orders-queue"</span><span class="json-punctuation">,</span>
    <span class="json-key">"entityType"</span><span class="json-punctuation">:</span> <span class="json-string">"Queue"</span><span class="json-punctuation">,</span>
    <span class="json-key">"caller"</span><span class="json-punctuation">:</span> <span class="json-string">"user@contoso.com"</span>
  <span class="json-punctuation">}</span>
<span class="json-punctuation">}</span></code></pre>

          <h4>2. Runtime Audit Logs (Premium Only)</h4>
          <p>Detailed data plane operations (send, receive, complete messages).</p>
          <pre class="syntax-highlighted" data-language="json"><code class="language-json"><span class="json-punctuation">{</span>
  <span class="json-key">"time"</span><span class="json-punctuation">:</span> <span class="json-string">"2025-12-24T10:31:00Z"</span><span class="json-punctuation">,</span>
  <span class="json-key">"category"</span><span class="json-punctuation">:</span> <span class="json-string">"RuntimeAuditLogs"</span><span class="json-punctuation">,</span>
  <span class="json-key">"operationName"</span><span class="json-punctuation">:</span> <span class="json-string">"SendMessage"</span><span class="json-punctuation">,</span>
  <span class="json-key">"properties"</span><span class="json-punctuation">:</span> <span class="json-punctuation">{</span>
    <span class="json-key">"entityName"</span><span class="json-punctuation">:</span> <span class="json-string">"orders-queue"</span><span class="json-punctuation">,</span>
    <span class="json-key">"messageId"</span><span class="json-punctuation">:</span> <span class="json-string">"msg-12345"</span><span class="json-punctuation">,</span>
    <span class="json-key">"clientIp"</span><span class="json-punctuation">:</span> <span class="json-string">"203.0.113.42"</span><span class="json-punctuation">,</span>
    <span class="json-key">"protocol"</span><span class="json-punctuation">:</span> <span class="json-string">"AMQP"</span>
  <span class="json-punctuation">}</span>
<span class="json-punctuation">}</span></code></pre>

          <h3>‚öôÔ∏è Enable Diagnostic Settings</h3>
          <pre class="syntax-highlighted" data-language="bash"><code># Via Azure CLI
az monitor diagnostic-settings create \
  --name service-bus-diagnostics \
  --resource /subscriptions/{sub-id}/resourceGroups/{rg}/providers/Microsoft.ServiceBus/namespaces/myservicebus \
  --logs '[
    {"category":"OperationalLogs","enabled":true},
    {"category":"RuntimeAuditLogs","enabled":true}
  ]' \
  --metrics '[{"category":"AllMetrics","enabled":true}]' \
  --workspace /subscriptions/{sub-id}/resourceGroups/{rg}/providers/Microsoft.OperationalInsights/workspaces/myworkspace</code></pre>

          <h2>Alerting Strategies</h2>

          <h3>üö® Critical Alerts</h3>
          
          <h4>1. Dead-Letter Queue Alert</h4>
          <pre class="syntax-highlighted" data-language="bash"><code>az monitor metrics alert create \
  --name "High Dead-Letter Count" \
  --resource /subscriptions/{sub}/resourceGroups/{rg}/providers/Microsoft.ServiceBus/namespaces/myservicebus \
  --condition "avg DeadletteredMessages > 0" \
  --window-size 5m \
  --evaluation-frequency 1m \
  --action-group /subscriptions/{sub}/resourceGroups/{rg}/providers/Microsoft.Insights/actionGroups/critical-alerts</code></pre>

          <h4>2. High Message Backlog</h4>
          <pre class="syntax-highlighted" data-language="bash"><code>az monitor metrics alert create \
  --name "Queue Backlog High" \
  --resource /subscriptions/{sub}/resourceGroups/{rg}/providers/Microsoft.ServiceBus/namespaces/myservicebus \
  --condition "avg ActiveMessages > 1000" \
  --window-size 15m \
  --evaluation-frequency 5m</code></pre>

          <h4>3. Throttling Detected</h4>
          <pre class="syntax-highlighted" data-language="bash"><code>az monitor metrics alert create \
  --name "Throttling Detected" \
  --resource /subscriptions/{sub}/resourceGroups/{rg}/providers/Microsoft.ServiceBus/namespaces/myservicebus \
  --condition "total ThrottledRequests > 10" \
  --window-size 5m \
  --evaluation-frequency 1m</code></pre>

          <h4>4. Server Errors</h4>
          <pre class="syntax-highlighted" data-language="bash"><code>az monitor metrics alert create \
  --name "Server Errors High" \
  --resource /subscriptions/{sub}/resourceGroups/{rg}/providers/Microsoft.ServiceBus/namespaces/myservicebus \
  --condition "total ServerErrors > 5" \
  --window-size 5m \
  --evaluation-frequency 1m</code></pre>

          <h2>Log Analytics Queries</h2>

          <h3>üìù Useful KQL Queries</h3>

          <h4>Messages by Queue/Topic</h4>
          <pre class="syntax-highlighted" data-language="sql"><code class="language-sql">AzureDiagnostics
| where ResourceProvider == <span class="sql-string">"MICROSOFT.SERVICEBUS"</span>
| where Category == <span class="sql-string">"OperationalLogs"</span>
| summarize MessageCount = <span class="sql-function">count</span>() by EntityName, bin(TimeGenerated, <span class="sql-number">5</span>m)
| render timechart</code></pre>

          <h4>Failed Operations</h4>
          <pre class="syntax-highlighted" data-language="sql"><code class="language-sql">AzureDiagnostics
| where ResourceProvider == <span class="sql-string">"MICROSOFT.SERVICEBUS"</span>
| where ResultType != <span class="sql-string">"Success"</span>
| project TimeGenerated, OperationName, ResultType, ResultDescription, EntityName
| order by TimeGenerated desc</code></pre>

          <h4>Top Message Senders</h4>
          <pre class="syntax-highlighted" data-language="sql"><code class="language-sql">AzureDiagnostics
| where Category == <span class="sql-string">"RuntimeAuditLogs"</span>
| where OperationName == <span class="sql-string">"SendMessage"</span>
| summarize MessageCount = <span class="sql-function">count</span>() by ClientIp
| top <span class="sql-number">10</span> by MessageCount desc</code></pre>

          <h4>Average Message Processing Time</h4>
          <pre class="syntax-highlighted" data-language="sql"><code class="language-sql">AzureMetrics
| where ResourceProvider == <span class="sql-string">"MICROSOFT.SERVICEBUS"</span>
| where MetricName in (<span class="sql-string">"ServerSendLatency"</span>, <span class="sql-string">"ServerReceiveLatency"</span>)
| summarize AvgLatency = <span class="sql-function">avg</span>(Average) by MetricName, bin(TimeGenerated, <span class="sql-number">5</span>m)
| render timechart</code></pre>

          <h4>Dead-Letter Trend</h4>
          <pre class="syntax-highlighted" data-language="sql"><code class="language-sql">AzureMetrics
| where ResourceProvider == <span class="sql-string">"MICROSOFT.SERVICEBUS"</span>
| where MetricName == <span class="sql-string">"DeadletteredMessages"</span>
| summarize TotalDeadLetters = <span class="sql-function">sum</span>(Total) by EntityName, bin(TimeGenerated, <span class="sql-number">1</span>h)
| render columnchart</code></pre>

          <h2>Application Insights Integration</h2>
          
          <h3>üìä Distributed Tracing</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>// Enable distributed tracing in .NET
services.AddApplicationInsightsTelemetry();

// Correlation IDs automatically propagated through Service Bus messages
var client = new ServiceBusClient(connectionString);
var sender = client.CreateSender("orders-queue");

// Send with automatic instrumentation
await sender.SendMessageAsync(new ServiceBusMessage("Order data"));</code></pre>

          <h3>üìà Custom Metrics</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>var telemetryClient = new TelemetryClient();

processor.ProcessMessageAsync += async args =>
{
    var stopwatch = Stopwatch.StartNew();
    
    await ProcessMessage(args.Message);
    
    stopwatch.Stop();
    
    // Track custom metric
    telemetryClient.TrackMetric("OrderProcessingTime", stopwatch.ElapsedMilliseconds);
    telemetryClient.TrackEvent("OrderProcessed", new Dictionary&lt;string, string&gt;
    {
        ["OrderId"] = args.Message.MessageId,
        ["Queue"] = "orders-queue"
    });
};</code></pre>

          <h2>Health Checks</h2>

          <h3>üè• Implement Health Endpoint</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>// Add Service Bus health check
services.AddHealthChecks()
    .AddAzureServiceBusQueue(
        connectionString: configuration["ServiceBusConnection"],
        queueName: "orders-queue",
        name: "servicebus-orders-queue");

// Health check endpoint: /health
app.MapHealthChecks("/health");</code></pre>

          <h2>Monitoring Dashboard</h2>
          
          <div class="callout">
            <strong>üìä Recommended Dashboard Tiles</strong><br />
            1. <strong>Active Messages</strong> - Line chart per queue/topic<br />
            2. <strong>Dead-Letter Count</strong> - Alert if > 0<br />
            3. <strong>Incoming vs Outgoing</strong> - Compare rates<br />
            4. <strong>Latency P95</strong> - Send and receive latency<br />
            5. <strong>Throttling Count</strong> - Resource pressure indicator<br />
            6. <strong>Error Rate</strong> - Server and user errors<br />
            7. <strong>CPU/Memory</strong> - Resource utilization (Premium)<br />
            8. <strong>Recent Failures</strong> - Log query results
          </div>

          <h2>Troubleshooting Common Issues</h2>

          <h3>üîç Issue: Messages Not Being Processed</h3>
          <ul>
            <li>Check if receivers are running and connected</li>
            <li>Verify lock duration hasn't expired</li>
            <li>Review dead-letter queue for failed messages</li>
            <li>Check for exceptions in consumer logs</li>
          </ul>

          <h3>üîç Issue: High Latency</h3>
          <ul>
            <li>Monitor throttling metrics - may need to scale up</li>
            <li>Check network connectivity between clients and Service Bus</li>
            <li>Verify prefetch settings are optimized</li>
            <li>Review batch sizes</li>
          </ul>

          <h3>üîç Issue: Messages in Dead-Letter Queue</h3>
          <ul>
            <li>Check DeadLetterReason and DeadLetterErrorDescription properties</li>
            <li>Review delivery count - exceeded max attempts?</li>
            <li>Verify TTL hasn't expired</li>
            <li>Check for filter evaluation failures in subscriptions</li>
          </ul>

          <h3>üîç Issue: Duplicate Messages</h3>
          <ul>
            <li>Enable duplicate detection on queue/topic</li>
            <li>Ensure idempotent message processing</li>
            <li>Use deterministic MessageId</li>
            <li>Implement deduplication in consumer logic</li>
          </ul>

          <h2>Best Practices</h2>
          <ul>
            <li>Enable diagnostic logs for all namespaces</li>
            <li>Set up alerts for critical metrics</li>
            <li>Monitor dead-letter queues continuously</li>
            <li>Use Log Analytics for trend analysis</li>
            <li>Implement distributed tracing</li>
            <li>Create operational dashboards</li>
            <li>Regular review of slow queries and high latency</li>
            <li>Test alerting rules periodically</li>
          </ul>
        </section>

        <!-- Tutorials Section -->
        <section id="tutorials" role="article">
          <h1>Getting Started & Tutorials</h1>
          <span class="badge">tutorials</span>
          <span class="badge">quickstart</span>
          <span class="badge">getting-started</span>
          
          <p>This section provides step-by-step tutorials to help you get started with Azure Service Bus quickly.</p>

          <h2>Prerequisites</h2>
          <ul>
            <li>Azure subscription (<a href="https://azure.microsoft.com/free/" target="_blank">create free account</a>)</li>
            <li>Azure CLI or Azure PowerShell installed</li>
            <li>Your preferred SDK (.NET, Java, Python, JavaScript, or Go)</li>
            <li>Code editor (VS Code, Visual Studio, or IntelliJ)</li>
          </ul>

          <h2>Tutorial 1: Create Your First Service Bus Namespace</h2>

          <h3>üìã Step 1: Create Namespace via Azure Portal</h3>
          <ol>
            <li>Sign in to Azure Portal</li>
            <li>Click <strong>Create a resource</strong></li>
            <li>Search for <strong>Service Bus</strong></li>
            <li>Click <strong>Create</strong></li>
            <li>Fill in details:
              <ul>
                <li>Name: <code>myservicebus-demo</code></li>
                <li>Pricing tier: <strong>Standard</strong> (for topics)</li>
                <li>Resource group: Create new or select existing</li>
                <li>Location: Choose nearest region</li>
              </ul>
            </li>
            <li>Click <strong>Review + Create</strong></li>
            <li>Click <strong>Create</strong> (takes ~1 minute)</li>
          </ol>

          <h3>üñ•Ô∏è Step 2: Create Namespace via Azure CLI</h3>
          <pre class="syntax-highlighted" data-language="bash"><code># Create resource group
az group create --name myResourceGroup --location eastus

# Create Service Bus namespace
az servicebus namespace create \
  --name myservicebus-demo \
  --resource-group myResourceGroup \
  --location eastus \
  --sku Standard

# Get connection string
az servicebus namespace authorization-rule keys list \
  --namespace-name myservicebus-demo \
  --resource-group myResourceGroup \
  --name RootManageSharedAccessKey \
  --query primaryConnectionString -o tsv</code></pre>

          <h2>Tutorial 2: Send and Receive Messages (Queue)</h2>

          <h3>üì¶ Step 1: Create a Queue</h3>
          <pre class="syntax-highlighted" data-language="bash"><code>az servicebus queue create \
  --namespace-name myservicebus-demo \
  --resource-group myResourceGroup \
  --name orders-queue \
  --max-size 1024</code></pre>

          <h3>üìù Step 2: Send Messages (.NET)</h3>
          <pre class="syntax-highlighted" data-language="bash"><code># Create new console app
dotnet new console -n ServiceBusSender
cd ServiceBusSender

# Add Service Bus package
dotnet add package Azure.Messaging.ServiceBus</code></pre>

          <pre class="syntax-highlighted" data-language="csharp"><code>using Azure.Messaging.ServiceBus;
using System;
using System.Threading.Tasks;

class Program
{
    // Connection string from Step 2 above
    private const string ConnectionString = "Endpoint=sb://myservicebus-demo...";
    private const string QueueName = "orders-queue";

    static async Task Main(string[] args)
    {
        // Create client and sender
        await using var client = new ServiceBusClient(ConnectionString);
        await using var sender = client.CreateSender(QueueName);

        // Send 10 messages
        for (int i = 1; i <= 10; i++)
        {
            var message = new ServiceBusMessage($"Order #{i}: Product-{i}")
            {
                MessageId = Guid.NewGuid().ToString(),
                ContentType = "text/plain",
                ApplicationProperties =
                {
                    ["OrderId"] = i,
                    ["Priority"] = i > 5 ? "High" : "Normal"
                }
            };

            await sender.SendMessageAsync(message);
            Console.WriteLine($"Sent message: {message.Body}");
        }

        Console.WriteLine($"\nSent 10 messages to {QueueName}");
    }
}</code></pre>

          <h3>üì• Step 3: Receive Messages (.NET)</h3>
          <pre class="syntax-highlighted" data-language="bash"><code># Create receiver app
dotnet new console -n ServiceBusReceiver
cd ServiceBusReceiver
dotnet add package Azure.Messaging.ServiceBus</code></pre>

          <pre class="syntax-highlighted" data-language="csharp"><code>using Azure.Messaging.ServiceBus;
using System;
using System.Threading.Tasks;

class Program
{
    private const string ConnectionString = "Endpoint=sb://myservicebus-demo...";
    private const string QueueName = "orders-queue";

    static async Task Main(string[] args)
    {
        await using var client = new ServiceBusClient(ConnectionString);

        // Create processor
        var processor = client.CreateProcessor(QueueName, new ServiceBusProcessorOptions
        {
            MaxConcurrentCalls = 2,
            AutoCompleteMessages = false // Manual completion
        });

        // Handle received messages
        processor.ProcessMessageAsync += MessageHandler;
        processor.ProcessErrorAsync += ErrorHandler;

        // Start processing
        await processor.StartProcessingAsync();
        Console.WriteLine("Receiving messages. Press any key to stop...");
        Console.ReadKey();

        // Stop processing
        await processor.StopProcessingAsync();
    }

    static async Task MessageHandler(ProcessMessageEventArgs args)
    {
        string body = args.Message.Body.ToString();
        Console.WriteLine($"\nReceived: {body}");
        Console.WriteLine($"  MessageId: {args.Message.MessageId}");
        Console.WriteLine($"  Priority: {args.Message.ApplicationProperties["Priority"]}");

        // Complete the message
        await args.CompleteMessageAsync(args.Message);
    }

    static Task ErrorHandler(ProcessErrorEventArgs args)
    {
        Console.WriteLine($"Error: {args.Exception.Message}");
        return Task.CompletedTask;
    }
}</code></pre>

          <h3>‚ñ∂Ô∏è Step 4: Run the Applications</h3>
          <pre class="syntax-highlighted" data-language="bash"><code># Terminal 1 - Start receiver
cd ServiceBusReceiver
dotnet run

# Terminal 2 - Send messages
cd ServiceBusSender
dotnet run</code></pre>

          <h2>Tutorial 3: Publish-Subscribe with Topics</h2>

          <h3>üì¢ Step 1: Create Topic and Subscriptions</h3>
          <pre class="syntax-highlighted" data-language="bash"><code># Create topic
az servicebus topic create \
  --namespace-name myservicebus-demo \
  --resource-group myResourceGroup \
  --name events-topic

# Create subscriptions with filters
# Subscription 1: All events
az servicebus topic subscription create \
  --namespace-name myservicebus-demo \
  --resource-group myResourceGroup \
  --topic-name events-topic \
  --name all-events

# Subscription 2: High priority only
az servicebus topic subscription create \
  --namespace-name myservicebus-demo \
  --resource-group myResourceGroup \
  --topic-name events-topic \
  --name high-priority

# Add SQL filter to high-priority subscription
az servicebus topic subscription rule create \
  --namespace-name myservicebus-demo \
  --resource-group myResourceGroup \
  --topic-name events-topic \
  --subscription-name high-priority \
  --name HighPriorityFilter \
  --filter-sql-expression "Priority = 'High'"

# Remove default rule
az servicebus topic subscription rule delete \
  --namespace-name myservicebus-demo \
  --resource-group myResourceGroup \
  --topic-name events-topic \
  --subscription-name high-priority \
  --name \$Default</code></pre>

          <h3>üì§ Step 2: Publish to Topic</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>await using var client = new ServiceBusClient(ConnectionString);
await using var sender = client.CreateSender("events-topic");

for (int i = 1; i <= 5; i++)
{
    var message = new ServiceBusMessage($"Event #{i}")
    {
        Subject = "OrderCreated",
        ApplicationProperties =
        {
            ["Priority"] = i % 2 == 0 ? "High" : "Normal",
            ["EventType"] = "OrderCreated"
        }
    };

    await sender.SendMessageAsync(message);
    Console.WriteLine($"Published: Event #{i} - Priority: {message.ApplicationProperties["Priority"]}");
}</code></pre>

          <h3>üì• Step 3: Subscribe and Process</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>// Subscribe to "high-priority" subscription
await using var client = new ServiceBusClient(ConnectionString);

var processor = client.CreateProcessor(
    topicName: "events-topic",
    subscriptionName: "high-priority");

processor.ProcessMessageAsync += async args =>
{
    Console.WriteLine($"High Priority Event: {args.Message.Body}");
    await args.CompleteMessageAsync(args.Message);
};

processor.ProcessErrorAsync += args =>
{
    Console.WriteLine($"Error: {args.Exception.Message}");
    return Task.CompletedTask;
};

await processor.StartProcessingAsync();
Console.WriteLine("Listening for high-priority events...");
Console.ReadKey();
await processor.StopProcessingAsync();</code></pre>

          <h2>Tutorial 4: Message Sessions (FIFO)</h2>

          <h3>üîÑ Step 1: Create Session-Enabled Queue</h3>
          <pre class="syntax-highlighted" data-language="bash"><code>az servicebus queue create \
  --namespace-name myservicebus-demo \
  --resource-group myResourceGroup \
  --name orders-session-queue \
  --enable-session true</code></pre>

          <h3>üì§ Step 2: Send Messages with Session ID</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>await using var client = new ServiceBusClient(ConnectionString);
await using var sender = client.CreateSender("orders-session-queue");

// Send messages for Order-123
for (int i = 1; i <= 3; i++)
{
    var message = new ServiceBusMessage($"Order-123 Step {i}")
    {
        SessionId = "Order-123" // Same session for related messages
    };
    await sender.SendMessageAsync(message);
}

// Send messages for Order-456
for (int i = 1; i <= 3; i++)
{
    var message = new ServiceBusMessage($"Order-456 Step {i}")
    {
        SessionId = "Order-456"
    };
    await sender.SendMessageAsync(message);
}

Console.WriteLine("Sent messages with sessions");</code></pre>

          <h3>üì• Step 3: Process Sessions</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>await using var client = new ServiceBusClient(ConnectionString);

var processor = client.CreateSessionProcessor(
    "orders-session-queue",
    new ServiceBusSessionProcessorOptions
    {
        MaxConcurrentSessions = 2,
        MaxConcurrentCallsPerSession = 1 // FIFO within session
    });

processor.ProcessMessageAsync += async args =>
{
    Console.WriteLine($"Session {args.SessionId}: {args.Message.Body}");
    
    // Messages in same session processed in order
    await args.CompleteMessageAsync(args.Message);
};

processor.ProcessErrorAsync += args =>
{
    Console.WriteLine($"Error: {args.Exception.Message}");
    return Task.CompletedTask;
};

await processor.StartProcessingAsync();
Console.WriteLine("Processing sessions...");
Console.ReadKey();
await processor.StopProcessingAsync();</code></pre>

          <h2>Tutorial 5: Azure Functions Integration</h2>

          <h3>‚ö° Step 1: Create Function App</h3>
          <pre class="syntax-highlighted" data-language="bash"><code># Create storage account (required for Functions)
az storage account create \
  --name mystorageacct$RANDOM \
  --resource-group myResourceGroup \
  --location eastus \
  --sku Standard_LRS

# Create Function App
az functionapp create \
  --name my-servicebus-function \
  --resource-group myResourceGroup \
  --consumption-plan-location eastus \
  --runtime dotnet \
  --functions-version 4 \
  --storage-account mystorageacct12345</code></pre>

          <h3>üìù Step 2: Create Service Bus Triggered Function</h3>
          <pre class="syntax-highlighted" data-language="bash"><code># Create local function project
func init ServiceBusFunctionApp --dotnet
cd ServiceBusFunctionApp

# Create Service Bus queue trigger
func new --template "ServiceBusQueueTrigger" --name OrderProcessor</code></pre>

          <pre class="syntax-highlighted" data-language="csharp"><code>using Microsoft.Azure.Functions.Worker;
using Microsoft.Extensions.Logging;

public class OrderProcessor
{
    private readonly ILogger<OrderProcessor> _logger;

    public OrderProcessor(ILogger<OrderProcessor> logger)
    {
        _logger = logger;
    }

    [Function(nameof(OrderProcessor))]
    public async Task Run(
        [ServiceBusTrigger("orders-queue", Connection = "ServiceBusConnection")]
        string messageBody,
        FunctionContext context)
    {
        _logger.LogInformation($"Processing order: {messageBody}");
        
        // Your processing logic here
        await ProcessOrderAsync(messageBody);
        
        _logger.LogInformation("Order processed successfully");
    }

    private Task ProcessOrderAsync(string order)
    {
        // Add your business logic
        return Task.CompletedTask;
    }
}</code></pre>

          <h3>‚öôÔ∏è Step 3: Configure and Deploy</h3>
          <pre class="syntax-highlighted" data-language="json"><code class="language-json"><span class="json-comment">// local.settings.json</span>
<span class="json-punctuation">{</span>
  <span class="json-key">"IsEncrypted"</span><span class="json-punctuation">:</span> <span class="json-boolean">false</span><span class="json-punctuation">,</span>
  <span class="json-key">"Values"</span><span class="json-punctuation">:</span> <span class="json-punctuation">{</span>
    <span class="json-key">"AzureWebJobsStorage"</span><span class="json-punctuation">:</span> <span class="json-string">"UseDevelopmentStorage=true"</span><span class="json-punctuation">,</span>
    <span class="json-key">"FUNCTIONS_WORKER_RUNTIME"</span><span class="json-punctuation">:</span> <span class="json-string">"dotnet"</span><span class="json-punctuation">,</span>
    <span class="json-key">"ServiceBusConnection"</span><span class="json-punctuation">:</span> <span class="json-string">"Endpoint=sb://myservicebus-demo..."</span>
  <span class="json-punctuation">}</span>
<span class="json-punctuation">}</span></code></pre>

          <pre class="syntax-highlighted" data-language="bash"><code># Deploy to Azure
func azure functionapp publish my-servicebus-function

# Set connection string in Azure
az functionapp config appsettings set \
  --name my-servicebus-function \
  --resource-group myResourceGroup \
  --settings ServiceBusConnection="Endpoint=sb://myservicebus-demo..."</code></pre>

          <h2>Tutorial 6: Managed Identity Authentication</h2>

          <h3>üîê Step 1: Enable Managed Identity</h3>
          <pre class="syntax-highlighted" data-language="bash"><code># For Function App
az functionapp identity assign \
  --name my-servicebus-function \
  --resource-group myResourceGroup

# Capture the principalId from output
PRINCIPAL_ID=$(az functionapp identity show \
  --name my-servicebus-function \
  --resource-group myResourceGroup \
  --query principalId -o tsv)</code></pre>

          <h3>‚úÖ Step 2: Grant RBAC Permissions</h3>
          <pre class="syntax-highlighted" data-language="bash"><code># Get namespace resource ID
NAMESPACE_ID=$(az servicebus namespace show \
  --name myservicebus-demo \
  --resource-group myResourceGroup \
  --query id -o tsv)

# Grant "Azure Service Bus Data Receiver" role
az role assignment create \
  --role "Azure Service Bus Data Receiver" \
  --assignee $PRINCIPAL_ID \
  --scope $NAMESPACE_ID</code></pre>

          <h3>üìù Step 3: Update Code to Use Managed Identity</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>using Azure.Identity;
using Azure.Messaging.ServiceBus;

// No connection string needed!
var fullyQualifiedNamespace = "myservicebus-demo.servicebus.windows.net";

var client = new ServiceBusClient(
    fullyQualifiedNamespace,
    new DefaultAzureCredential()
);

var sender = client.CreateSender("orders-queue");
await sender.SendMessageAsync(new ServiceBusMessage("Test"));

Console.WriteLine("Message sent using Managed Identity!");</code></pre>

          <h2>Tutorial 7: Monitor with Application Insights</h2>

          <h3>üìä Step 1: Create Application Insights</h3>
          <pre class="syntax-highlighted" data-language="bash"><code>az monitor app-insights component create \
  --app servicebus-insights \
  --resource-group myResourceGroup \
  --location eastus

# Get instrumentation key
INSTRUMENTATION_KEY=$(az monitor app-insights component show \
  --app servicebus-insights \
  --resource-group myResourceGroup \
  --query instrumentationKey -o tsv)</code></pre>

          <h3>üìù Step 2: Add Telemetry to Application</h3>
          <pre class="syntax-highlighted" data-language="bash"><code>dotnet add package Microsoft.ApplicationInsights
dotnet add package Microsoft.ApplicationInsights.DependencyCollector</code></pre>

          <pre class="syntax-highlighted" data-language="csharp"><code>using Microsoft.ApplicationInsights;
using Microsoft.ApplicationInsights.DependencyCollector;
using Microsoft.ApplicationInsights.Extensibility;

var config = TelemetryConfiguration.CreateDefault();
config.InstrumentationKey = "your-instrumentation-key";
config.TelemetryInitializers.Add(new HttpDependenciesParsingTelemetryInitializer());

var telemetryClient = new TelemetryClient(config);

processor.ProcessMessageAsync += async args =>
{
    var stopwatch = System.Diagnostics.Stopwatch.StartNew();
    
    try
    {
        await ProcessMessage(args.Message);
        await args.CompleteMessageAsync(args.Message);
        
        stopwatch.Stop();
        telemetryClient.TrackMetric(
            "MessageProcessingTime",
            stopwatch.ElapsedMilliseconds);
    }
    catch (Exception ex)
    {
        telemetryClient.TrackException(ex);
        throw;
    }
};</code></pre>

          <h2>Quick Reference: Common Operations</h2>

          <h3>üîç Check Queue Message Count</h3>
          <pre class="syntax-highlighted" data-language="bash"><code>az servicebus queue show \
  --namespace-name myservicebus-demo \
  --resource-group myResourceGroup \
  --name orders-queue \
  --query "countDetails"</code></pre>

          <h3>üóëÔ∏è Purge Dead-Letter Queue</h3>
          <pre class="syntax-highlighted" data-language="csharp"><code>var receiver = client.CreateReceiver("orders-queue", 
    new ServiceBusReceiverOptions 
    { 
        SubQueue = SubQueue.DeadLetter 
    });

var messages = await receiver.ReceiveMessagesAsync(maxMessages: 100);
foreach (var message in messages)
{
    await receiver.CompleteMessageAsync(message);
}

Console.WriteLine($"Purged {messages.Count} messages from DLQ");</code></pre>

          <h3>üìã List All Queues</h3>
          <pre class="syntax-highlighted" data-language="bash"><code>az servicebus queue list \
  --namespace-name myservicebus-demo \
  --resource-group myResourceGroup \
  --query "[].name" -o table</code></pre>

          <h3>üîÑ Update Queue Properties</h3>
          <pre class="syntax-highlighted" data-language="bash"><code>az servicebus queue update \
  --namespace-name myservicebus-demo \
  --resource-group myResourceGroup \
  --name orders-queue \
  --max-delivery-count 5 \
  --lock-duration PT2M</code></pre>

          <h2>Next Steps</h2>
          <ul>
            <li>üìñ Explore <a href="#best-practices">Best Practices</a> for production deployments</li>
            <li>üîí Implement <a href="#security">Security & Authentication</a> properly</li>
            <li>üìä Set up <a href="#monitoring">Monitoring & Alerts</a></li>
            <li>üîó Learn about <a href="#integration">Azure Service Integrations</a></li>
            <li>‚ö° Explore <a href="#advanced-features">Advanced Features</a> like sessions and transactions</li>
          </ul>

          <div class="callout">
            <strong>üí° Pro Tips</strong><br />
            ‚Ä¢ Start with Standard tier for learning (supports topics and subscriptions)<br />
            ‚Ä¢ Use Managed Identity in production instead of connection strings<br />
            ‚Ä¢ Enable diagnostic logging from day one<br />
            ‚Ä¢ Test with Azure Functions for quick serverless processing<br />
            ‚Ä¢ Monitor dead-letter queues regularly
          </div>
        </section>

        <!-- Best Practices Section -->
        <section id="best-practices" role="article">
          <h1>Best Practices</h1>
          <span class="badge">best-practices</span>
          <span class="badge">recommendations</span>
          <span class="badge">performance</span>
          <span class="badge">reliability</span>
          
          <p>Follow these best practices to build reliable, scalable, and maintainable solutions with Azure Service Bus.</p>

          <h2>Design & Architecture</h2>

          <h3>‚úÖ Message Design</h3>
          
          <h4>Keep Messages Small</h4>
          <ul>
            <li>Target message size: < 64 KB</li>
            <li>Store large payloads in Blob Storage, send references in messages</li>
            <li>Reduces latency and improves throughput</li>
            <li>Premium tier supports up to 100 MB but avoid unless necessary</li>
          </ul>

          <pre class="syntax-highlighted" data-language="csharp"><code>// ‚ùå Bad: Large payload in message
var largeData = GetLargeDocument(); // 5 MB
var message = new ServiceBusMessage(largeData);

// ‚úÖ Good: Store in Blob, send reference
var blobUrl = await UploadToBlobAsync(largeData);
var message = new ServiceBusMessage(JsonSerializer.Serialize(new 
{ 
    BlobUrl = blobUrl,
    Size = largeData.Length 
}));</code></pre>

          <h4>Use Structured Data</h4>
          <ul>
            <li>Prefer JSON over plain text or XML</li>
            <li>Include schema version for evolution</li>
            <li>Use proper ContentType header</li>
          </ul>

          <pre class="syntax-highlighted" data-language="csharp"><code>var orderDto = new OrderDto 
{ 
    Version = "1.0",
    OrderId = "ORD-123", 
    Items = items 
};

var message = new ServiceBusMessage(JsonSerializer.Serialize(orderDto))
{
    ContentType = "application/json",
    Subject = "OrderCreated",
    MessageId = orderDto.OrderId
};</code></pre>

          <h4>Design for Idempotency</h4>
          <ul>
            <li>Messages can be delivered more than once</li>
            <li>Use deterministic MessageId for deduplication</li>
            <li>Implement idempotent message handlers</li>
          </ul>

          <pre class="syntax-highlighted" data-language="csharp"><code>processor.ProcessMessageAsync += async args =>
{
    var messageId = args.Message.MessageId;
    
    // Check if already processed (using cache/database)
    if (await _cache.ContainsKeyAsync(messageId))
    {
        Console.WriteLine($"Already processed: {messageId}");
        await args.CompleteMessageAsync(args.Message);
        return;
    }
    
    // Process message
    await ProcessOrderAsync(args.Message);
    
    // Mark as processed
    await _cache.SetAsync(messageId, true, TimeSpan.FromHours(24));
    await args.CompleteMessageAsync(args.Message);
};</code></pre>

          <h3>‚úÖ Entity Design</h3>

          <h4>Queue vs Topic Decision</h4>
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Use Queue When</th>
                <th>Use Topic When</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Single consumer for each message</td>
                <td>Multiple consumers need same message</td>
              </tr>
              <tr>
                <td>Competing consumers for load balancing</td>
                <td>Different consumers process differently</td>
              </tr>
              <tr>
                <td>Simple point-to-point messaging</td>
                <td>Fan-out or pub-sub pattern needed</td>
              </tr>
              <tr>
                <td>Cost-sensitive (Basic tier)</td>
                <td>Filtering and routing required</td>
              </tr>
            </tbody>
          </table>

          <h4>Naming Conventions</h4>
          <ul>
            <li>Use descriptive, lowercase names with hyphens</li>
            <li>Include purpose: <code>orders-queue</code>, <code>events-topic</code></li>
            <li>Avoid special characters except hyphen</li>
            <li>Max 260 characters</li>
          </ul>

          <h4>Entity Lifecycle</h4>
          <ul>
            <li>Create entities via Infrastructure as Code (ARM, Bicep, Terraform)</li>
            <li>Don't create entities dynamically in application code</li>
            <li>Use separate entities for dev/test/prod</li>
          </ul>

          <h2>Performance</h2>

          <h3>üöÄ Throughput Optimization</h3>

          <h4>Use Batch Operations</h4>
          <pre class="syntax-highlighted" data-language="csharp"><code>// ‚ùå Bad: Individual sends (slow)
foreach (var order in orders)
{
    await sender.SendMessageAsync(new ServiceBusMessage(order));
}

// ‚úÖ Good: Batch send (fast)
using var batch = await sender.CreateMessageBatchAsync();
foreach (var order in orders)
{
    var message = new ServiceBusMessage(JsonSerializer.Serialize(order));
    if (!batch.TryAddMessage(message))
    {
        await sender.SendMessagesAsync(batch);
        batch = await sender.CreateMessageBatchAsync();
        batch.TryAddMessage(message);
    }
}
if (batch.Count > 0)
{
    await sender.SendMessagesAsync(batch);
}</code></pre>

          <h4>Enable Prefetching</h4>
          <pre class="syntax-highlighted" data-language="csharp"><code>var processor = client.CreateProcessor(queueName, new ServiceBusProcessorOptions
{
    PrefetchCount = 20, // Fetch messages in advance
    MaxConcurrentCalls = 5
});</code></pre>

          <h4>Optimize Concurrent Processing</h4>
          <pre class="syntax-highlighted" data-language="csharp"><code>var options = new ServiceBusProcessorOptions
{
    MaxConcurrentCalls = Environment.ProcessorCount * 2,
    PrefetchCount = 50,
    MaxAutoLockRenewalDuration = TimeSpan.FromMinutes(5)
};</code></pre>

          <h4>Connection Pooling</h4>
          <pre class="syntax-highlighted" data-language="csharp"><code>// ‚ùå Bad: Create new client per operation
public async Task SendMessage(string message)
{
    var client = new ServiceBusClient(connectionString);
    var sender = client.CreateSender(queueName);
    await sender.SendMessageAsync(new ServiceBusMessage(message));
}

// ‚úÖ Good: Reuse client (singleton)
private static ServiceBusClient _client = new ServiceBusClient(connectionString);

public async Task SendMessage(string message)
{
    var sender = _client.CreateSender(queueName);
    await sender.SendMessageAsync(new ServiceBusMessage(message));
}</code></pre>

          <h3>‚ö° Latency Reduction</h3>

          <h4>Choose Nearest Region</h4>
          <ul>
            <li>Deploy Service Bus in same region as applications</li>
            <li>Use Availability Zones for redundancy (Premium)</li>
            <li>Consider Geo-Replication for disaster recovery (Premium)</li>
          </ul>

          <h4>Use AMQP Protocol</h4>
          <pre class="syntax-highlighted" data-language="csharp"><code>// AMQP is default and preferred (better performance than HTTP)
var client = new ServiceBusClient(connectionString); // Uses AMQP 1.0</code></pre>

          <h2>Reliability</h2>

          <h3>üõ°Ô∏è Error Handling</h3>

          <h4>Implement Retry Logic</h4>
          <pre class="syntax-highlighted" data-language="csharp"><code>var clientOptions = new ServiceBusClientOptions
{
    RetryOptions = new ServiceBusRetryOptions
    {
        Mode = ServiceBusRetryMode.Exponential,
        MaxRetries = 3,
        Delay = TimeSpan.FromSeconds(1),
        MaxDelay = TimeSpan.FromSeconds(30)
    }
};

var client = new ServiceBusClient(connectionString, clientOptions);</code></pre>

          <h4>Handle Transient vs Permanent Errors</h4>
          <pre class="syntax-highlighted" data-language="csharp"><code>processor.ProcessMessageAsync += async args =>
{
    try
    {
        await ProcessMessage(args.Message);
        await args.CompleteMessageAsync(args.Message);
    }
    catch (ServiceBusException ex) when (ex.Reason == ServiceBusFailureReason.ServiceBusy)
    {
        // Transient error - abandon and retry
        await args.AbandonMessageAsync(args.Message);
    }
    catch (ValidationException ex)
    {
        // Permanent error - dead-letter
        await args.DeadLetterMessageAsync(args.Message, 
            deadLetterReason: "ValidationFailed",
            deadLetterErrorDescription: ex.Message);
    }
};</code></pre>

          <h4>Monitor Dead-Letter Queues</h4>
          <pre class="syntax-highlighted" data-language="csharp"><code>// Set up periodic DLQ processing
var dlqReceiver = client.CreateReceiver(queueName, 
    new ServiceBusReceiverOptions 
    { 
        SubQueue = SubQueue.DeadLetter 
    });

var dlqMessages = await dlqReceiver.ReceiveMessagesAsync(100);
foreach (var msg in dlqMessages)
{
    _logger.LogError(
        "DLQ Message: {MessageId}, Reason: {Reason}, Description: {Description}",
        msg.MessageId,
        msg.DeadLetterReason,
        msg.DeadLetterErrorDescription);
    
    // Alert operations team
    await SendAlertAsync(msg);
}</code></pre>

          <h3>üîê Security</h3>

          <h4>Use Managed Identity (Not Connection Strings)</h4>
          <pre class="syntax-highlighted" data-language="csharp"><code>// ‚úÖ Best: Managed Identity (no secrets)
var client = new ServiceBusClient(
    "myservicebus.servicebus.windows.net",
    new DefaultAzureCredential());</code></pre>

          <h4>Least Privilege Principle</h4>
          <ul>
            <li>Senders: Azure Service Bus Data Sender role only</li>
            <li>Receivers: Azure Service Bus Data Receiver role only</li>
            <li>Never use "Owner" role for applications</li>
          </ul>

          <h4>Network Security</h4>
          <ul>
            <li>Use Private Endpoints in production (Premium)</li>
            <li>Enable IP firewall rules</li>
            <li>Disable public network access if using VNet</li>
          </ul>

          <h2>Operational Excellence</h2>

          <h3>üìä Monitoring</h3>

          <h4>Essential Metrics to Monitor</h4>
          <ul>
            <li><strong>ActiveMessages</strong> - Alert if growing unbounded</li>
            <li><strong>DeadLetterMessages</strong> - Alert if > 0</li>
            <li><strong>ThrottledRequests</strong> - Scale up if occurring</li>
            <li><strong>ServerErrors</strong> - Investigate if > 0.1%</li>
            <li><strong>Incoming vs Outgoing</strong> - Should be balanced</li>
          </ul>

          <h4>Set Up Alerts</h4>
          <pre class="syntax-highlighted" data-language="bash"><code># Alert on dead-letter messages
az monitor metrics alert create \
  --name "DeadLetter Alert" \
  --resource $NAMESPACE_ID \
  --condition "total DeadletteredMessages > 0" \
  --window-size 5m</code></pre>

          <h4>Enable Diagnostic Logs</h4>
          <ul>
            <li>Send to Log Analytics workspace</li>
            <li>Enable OperationalLogs (all tiers)</li>
            <li>Enable RuntimeAuditLogs (Premium only)</li>
            <li>Archive to Storage for compliance</li>
          </ul>

          <h3>üß™ Testing</h3>

          <h4>Use Test Entities</h4>
          <ul>
            <li>Create separate queues/topics for testing</li>
            <li>Use naming convention: <code>test-orders-queue</code></li>
            <li>Don't test against production entities</li>
          </ul>

          <h4>Integration Testing</h4>
          <pre class="syntax-highlighted" data-language="csharp"><code>[Fact]
public async Task Should_Process_Order_Message()
{
    // Arrange
    var testClient = new ServiceBusClient(testConnectionString);
    var sender = testClient.CreateSender("test-orders-queue");
    var receiver = testClient.CreateReceiver("test-orders-queue");
    
    var order = new Order { OrderId = "TEST-001" };
    var message = new ServiceBusMessage(JsonSerializer.Serialize(order));
    
    // Act
    await sender.SendMessageAsync(message);
    var receivedMsg = await receiver.ReceiveMessageAsync(TimeSpan.FromSeconds(5));
    
    // Assert
    Assert.NotNull(receivedMsg);
    var receivedOrder = JsonSerializer.Deserialize<Order>(receivedMsg.Body.ToString());
    Assert.Equal(order.OrderId, receivedOrder.OrderId);
    
    // Cleanup
    await receiver.CompleteMessageAsync(receivedMsg);
}</code></pre>

          <h3>üí∞ Cost Optimization</h3>

          <h4>Right-Size Your Tier</h4>
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Tier</th>
                <th>Best For</th>
                <th>Monthly Cost</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Basic</td>
                <td>Dev/test, simple queues</td>
                <td>~$0.05 per million operations</td>
              </tr>
              <tr>
                <td>Standard</td>
                <td>Production with topics</td>
                <td>~$10 base + $0.05 per million</td>
              </tr>
              <tr>
                <td>Premium</td>
                <td>Dedicated resources, VNet, large messages</td>
                <td>~$677+ per messaging unit</td>
              </tr>
            </tbody>
          </table>

          <h4>Optimize Premium Messaging Units</h4>
          <ul>
            <li>Start with 1 MU, scale based on CPU/memory metrics</li>
            <li>Monitor resource utilization (target < 70%)</li>
            <li>Use autoscale (1-16 MUs)</li>
          </ul>

          <h4>Message Retention</h4>
          <ul>
            <li>Set appropriate TTL (don't use default 14 days unnecessarily)</li>
            <li>Process and delete messages promptly</li>
            <li>Clean up unused queues and topics</li>
          </ul>

          <h2>Disaster Recovery</h2>

          <h3>üîÑ Geo-Disaster Recovery (Premium)</h3>
          <pre class="syntax-highlighted" data-language="bash"><code># Create secondary namespace
az servicebus namespace create \
  --name myservicebus-dr \
  --resource-group myResourceGroup \
  --location westus \
  --sku Premium

# Set up geo-pairing
az servicebus georecovery-alias create \
  --resource-group myResourceGroup \
  --namespace-name myservicebus-demo \
  --alias myservicebus-alias \
  --partner-namespace /subscriptions/{sub}/resourceGroups/{rg}/providers/Microsoft.ServiceBus/namespaces/myservicebus-dr</code></pre>

          <h3>üíæ Backup Strategy</h3>
          <ul>
            <li>Export entity definitions (ARM templates)</li>
            <li>Document configuration and policies</li>
            <li>Test failover procedures regularly</li>
            <li>Have runbooks for disaster scenarios</li>
          </ul>

          <h2>Capacity Planning</h2>

          <h3>üìè Estimate Requirements</h3>
          <ul>
            <li><strong>Message Rate:</strong> How many messages per second?</li>
            <li><strong>Message Size:</strong> Average and max message size</li>
            <li><strong>Peak Load:</strong> Expected peak traffic</li>
            <li><strong>Retention:</strong> How long messages stay in queue</li>
          </ul>

          <h3>üìä Sizing Formula (Premium)</h3>
          <pre class="syntax-highlighted" data-language="text"><code>Required MUs = (Peak Messages/sec √ó Avg Message Size KB) / 1000

Example:
- Peak: 500 msg/sec
- Avg Size: 10 KB
- Calculation: (500 √ó 10) / 1000 = 5 MUs

Add 30% buffer ‚Üí Recommended: 7 MUs</code></pre>

          <h2>Common Antipatterns to Avoid</h2>

          <div class="callout">
            <strong>‚ùå Don't Do These</strong><br />
            1. <strong>Creating entities in code</strong> - Use IaC instead<br />
            2. <strong>Not handling duplicate messages</strong> - Implement idempotency<br />
            3. <strong>Storing large data in messages</strong> - Use Blob Storage<br />
            4. <strong>Not monitoring DLQ</strong> - Set up alerts<br />
            5. <strong>Using connection strings in code</strong> - Use Managed Identity<br />
            6. <strong>Infinite message locks</strong> - Set appropriate lock duration<br />
            7. <strong>Synchronous processing</strong> - Embrace asynchronous patterns<br />
            8. <strong>Not using sessions for ordering</strong> - Use sessions when order matters<br />
            9. <strong>Ignoring throttling</strong> - Handle backpressure gracefully<br />
            10. <strong>No retry strategy</strong> - Implement exponential backoff
          </div>

          <h2>Production Checklist</h2>

          <h3>‚úÖ Before Going Live</h3>
          <ul>
            <li>‚òëÔ∏è Managed Identity configured for all applications</li>
            <li>‚òëÔ∏è Private Endpoints enabled (Premium)</li>
            <li>‚òëÔ∏è Diagnostic logs sent to Log Analytics</li>
            <li>‚òëÔ∏è Alerts configured for critical metrics</li>
            <li>‚òëÔ∏è Dead-letter queue monitoring in place</li>
            <li>‚òëÔ∏è Backup and disaster recovery tested</li>
            <li>‚òëÔ∏è Load testing completed</li>
            <li>‚òëÔ∏è Retry policies implemented</li>
            <li>‚òëÔ∏è Idempotent message processing verified</li>
            <li>‚òëÔ∏è Documentation updated</li>
            <li>‚òëÔ∏è Team trained on operations</li>
            <li>‚òëÔ∏è Incident response procedures defined</li>
          </ul>
        </section>

        <!-- Service Comparison Section -->
        <section id="comparison" role="article">
          <h1>Service Comparison</h1>
          <span class="badge">comparison</span>
          <span class="badge">vs</span>
          <span class="badge">eventgrid</span>
          <span class="badge">eventhub</span>
          
          <p>Azure offers multiple messaging and eventing services. Understanding their differences helps you choose the right service for your scenario.</p>

          <h2>Azure Messaging & Eventing Services</h2>

          <h3>üî∑ Service Bus vs Event Grid vs Event Hubs</h3>

          <table class="table table-striped">
            <thead>
              <tr>
                <th>Feature</th>
                <th>Service Bus</th>
                <th>Event Grid</th>
                <th>Event Hubs</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>Type</strong></td>
                <td>Enterprise messaging broker</td>
                <td>Event distribution service</td>
                <td>Big data streaming platform</td>
              </tr>
              <tr>
                <td><strong>Use Case</strong></td>
                <td>Reliable message delivery, transactional operations</td>
                <td>Reactive programming, event-driven architecture</td>
                <td>Telemetry, log streaming, time-series data</td>
              </tr>
              <tr>
                <td><strong>Message Size</strong></td>
                <td>256 KB (Standard), 100 MB (Premium)</td>
                <td>1 MB per event</td>
                <td>1 MB per message</td>
              </tr>
              <tr>
                <td><strong>Throughput</strong></td>
                <td>Moderate (thousands/sec)</td>
                <td>High (millions/sec)</td>
                <td>Very High (millions/sec)</td>
              </tr>
              <tr>
                <td><strong>Ordering</strong></td>
                <td>‚úÖ FIFO with sessions</td>
                <td>‚ùå No ordering guarantee</td>
                <td>‚úÖ Per partition</td>
              </tr>
              <tr>
                <td><strong>Message Retention</strong></td>
                <td>Up to 14 days (Standard), 90 days (Premium)</td>
                <td>24 hours</td>
                <td>1-90 days</td>
              </tr>
              <tr>
                <td><strong>Dead-Letter Queue</strong></td>
                <td>‚úÖ Built-in</td>
                <td>‚úÖ With retry policies</td>
                <td>‚ùå Not built-in</td>
              </tr>
              <tr>
                <td><strong>Transactions</strong></td>
                <td>‚úÖ Multi-entity transactions</td>
                <td>‚ùå No transactions</td>
                <td>‚ùå No transactions</td>
              </tr>
              <tr>
                <td><strong>Duplicate Detection</strong></td>
                <td>‚úÖ Time-based window</td>
                <td>‚úÖ Event ID-based</td>
                <td>‚ùå Not built-in</td>
              </tr>
              <tr>
                <td><strong>Protocol</strong></td>
                <td>AMQP 1.0, HTTPS</td>
                <td>HTTPS, WebHooks</td>
                <td>AMQP 1.0, HTTPS, Kafka</td>
              </tr>
              <tr>
                <td><strong>Pull vs Push</strong></td>
                <td>Pull (receiver reads)</td>
                <td>Push (reactive delivery)</td>
                <td>Pull (consumer reads)</td>
              </tr>
              <tr>
                <td><strong>Filtering</strong></td>
                <td>‚úÖ SQL filters, correlation filters</td>
                <td>‚úÖ Event type, subject filtering</td>
                <td>‚ùå Limited</td>
              </tr>
              <tr>
                <td><strong>Pricing Model</strong></td>
                <td>Per operation + base</td>
                <td>Per operation</td>
                <td>Throughput units or capacity units</td>
              </tr>
              <tr>
                <td><strong>Best For</strong></td>
                <td>Order processing, workflows, command messaging</td>
                <td>Reactive apps, Azure service events, webhooks</td>
                <td>Analytics, telemetry, IoT, log aggregation</td>
              </tr>
            </tbody>
          </table>

          <h2>Decision Matrix</h2>

          <h3>ü§î When to Use Service Bus</h3>
          <ul>
            <li>‚úÖ Need guaranteed message delivery (at-least-once)</li>
            <li>‚úÖ Require FIFO ordering within sessions</li>
            <li>‚úÖ Need transactional operations across multiple entities</li>
            <li>‚úÖ Implement competing consumers pattern</li>
            <li>‚úÖ Dead-letter queue for failed messages</li>
            <li>‚úÖ Message deferral and scheduled delivery</li>
            <li>‚úÖ Enterprise integration patterns (EAI)</li>
          </ul>

          <div class="callout">
            <strong>üíº Service Bus Examples</strong><br />
            ‚Ä¢ Order processing systems<br />
            ‚Ä¢ Financial transactions<br />
            ‚Ä¢ Workflow orchestration<br />
            ‚Ä¢ Task distribution across workers<br />
            ‚Ä¢ Microservice communication (commands)
          </div>

          <h3>‚ö° When to Use Event Grid</h3>
          <ul>
            <li>‚úÖ React to Azure service events (Blob created, VM started)</li>
            <li>‚úÖ Event-driven serverless architectures</li>
            <li>‚úÖ Need push-based delivery (webhooks)</li>
            <li>‚úÖ Simple pub-sub with filtering</li>
            <li>‚úÖ High-volume, low-latency event distribution</li>
            <li>‚úÖ Custom application events</li>
          </ul>

          <div class="callout">
            <strong>‚ö° Event Grid Examples</strong><br />
            ‚Ä¢ Image processing on blob upload<br />
            ‚Ä¢ Infrastructure automation (VM lifecycle)<br />
            ‚Ä¢ Application event broadcasting<br />
            ‚Ä¢ Serverless workflows<br />
            ‚Ä¢ IoT device notifications
          </div>

          <h3>üìä When to Use Event Hubs</h3>
          <ul>
            <li>‚úÖ Ingest millions of events per second</li>
            <li>‚úÖ Telemetry and log streaming</li>
            <li>‚úÖ Time-series data processing</li>
            <li>‚úÖ Real-time analytics pipelines</li>
            <li>‚úÖ Apache Kafka compatibility needed</li>
            <li>‚úÖ Long-term event replay (up to 90 days)</li>
          </ul>

          <div class="callout">
            <strong>üìä Event Hubs Examples</strong><br />
            ‚Ä¢ IoT telemetry ingestion<br />
            ‚Ä¢ Application performance monitoring<br />
            ‚Ä¢ Clickstream analytics<br />
            ‚Ä¢ Real-time dashboards<br />
            ‚Ä¢ Log aggregation from multiple sources
          </div>

          <h2>Architecture Patterns</h2>

          <h3>Pattern 1: Service Bus + Event Grid</h3>
          <pre class="mermaid">
graph LR
    A[User Action] -->|Command| B[Service Bus Queue]
    B --> C[Order Service]
    C -->|Event| D[Event Grid]
    D -->|Notify| E[Email Service]
    D -->|Notify| F[Analytics Service]
    
    style B fill:#1E90FF
    style D fill:#32CD32
</pre>

          <p><strong>Use Case:</strong> Order processing (commands via Service Bus) + event notifications (via Event Grid)</p>

          <h3>Pattern 2: Event Hubs + Service Bus</h3>
          <pre class="mermaid">
graph LR
    A[IoT Devices] -->|Telemetry| B[Event Hubs]
    B --> C[Stream Analytics]
    C -->|Alerts| D[Service Bus Topic]
    D --> E[Notification Service]
    D --> F[Incident Management]
    
    style B fill:#FF6347
    style D fill:#1E90FF
</pre>

          <p><strong>Use Case:</strong> High-volume telemetry ingestion (Event Hubs) + reliable alert delivery (Service Bus)</p>

          <h3>Pattern 3: All Three Services</h3>
          <pre class="mermaid">
graph TB
    A[Web App] -->|Commands| B[Service Bus]
    B --> C[Order Processor]
    C -->|Events| D[Event Grid]
    D --> E[Functions]
    E -->|Logs| F[Event Hubs]
    F --> G[Analytics]
    
    style B fill:#1E90FF
    style D fill:#32CD32
    style F fill:#FF6347
</pre>

          <p><strong>Use Case:</strong> Commands (Service Bus), events (Event Grid), telemetry (Event Hubs)</p>

          <h2>Service Bus vs Storage Queues</h2>

          <table class="table table-striped">
            <thead>
              <tr>
                <th>Feature</th>
                <th>Service Bus</th>
                <th>Storage Queues</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>Message Size</strong></td>
                <td>256 KB - 100 MB</td>
                <td>64 KB</td>
              </tr>
              <tr>
                <td><strong>Queue Size</strong></td>
                <td>80 GB (Standard), unlimited (Premium)</td>
                <td>500 TB+ (storage account limit)</td>
              </tr>
              <tr>
                <td><strong>Ordering</strong></td>
                <td>‚úÖ FIFO with sessions</td>
                <td>‚ùå Best-effort</td>
              </tr>
              <tr>
                <td><strong>Duplicate Detection</strong></td>
                <td>‚úÖ Yes</td>
                <td>‚ùå No</td>
              </tr>
              <tr>
                <td><strong>Transactions</strong></td>
                <td>‚úÖ Yes</td>
                <td>‚ùå No</td>
              </tr>
              <tr>
                <td><strong>Dead-Letter Queue</strong></td>
                <td>‚úÖ Built-in</td>
                <td>‚ùå Manual implementation</td>
              </tr>
              <tr>
                <td><strong>TTL</strong></td>
                <td>Configurable (up to infinite)</td>
                <td>7 days max</td>
              </tr>
              <tr>
                <td><strong>Batching</strong></td>
                <td>‚úÖ Client-side</td>
                <td>‚úÖ Up to 32 messages</td>
              </tr>
              <tr>
                <td><strong>Cost</strong></td>
                <td>Higher (more features)</td>
                <td>Lower (basic features)</td>
              </tr>
              <tr>
                <td><strong>Use When</strong></td>
                <td>Enterprise messaging, reliability critical</td>
                <td>Simple queuing, cost-sensitive</td>
              </tr>
            </tbody>
          </table>

          <h2>Migration Scenarios</h2>

          <h3>üîÑ RabbitMQ to Service Bus</h3>
          <table class="table table-striped">
            <thead>
              <tr>
                <th>RabbitMQ Concept</th>
                <th>Service Bus Equivalent</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Exchange (Direct)</td>
                <td>Queue</td>
              </tr>
              <tr>
                <td>Exchange (Topic)</td>
                <td>Topic with Subscriptions</td>
              </tr>
              <tr>
                <td>Routing Key</td>
                <td>Subject property + filters</td>
              </tr>
              <tr>
                <td>Binding</td>
                <td>Subscription filter</td>
              </tr>
              <tr>
                <td>Dead Letter Exchange</td>
                <td>Dead-letter queue (built-in)</td>
              </tr>
              <tr>
                <td>Priority Queue</td>
                <td>Sessions or custom properties</td>
              </tr>
            </tbody>
          </table>

          <h3>üîÑ Apache Kafka to Service Bus</h3>
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Kafka Concept</th>
                <th>Service Bus Equivalent</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Topic</td>
                <td>Queue or Topic</td>
              </tr>
              <tr>
                <td>Partition</td>
                <td>Session (for ordering)</td>
              </tr>
              <tr>
                <td>Consumer Group</td>
                <td>Subscription (for topics)</td>
              </tr>
              <tr>
                <td>Offset</td>
                <td>Message sequence number</td>
              </tr>
              <tr>
                <td>Compaction</td>
                <td>Not supported (use Event Hubs)</td>
              </tr>
            </tbody>
          </table>

          <div class="callout">
            <strong>üí° Migration Note</strong><br />
            For Kafka workloads with high throughput requirements (>10K msg/sec), consider <strong>Azure Event Hubs</strong> with Kafka protocol support instead of Service Bus.
          </div>

          <h2>Quick Decision Guide</h2>

          <pre class="mermaid">
graph TD
    A[Need messaging/eventing?] --> B{Message or Event?}
    B -->|Message<br/>Command/Task| C{Need ordering?}
    B -->|Event<br/>Notification| D{Need replay?}
    
    C -->|Yes| E[Service Bus<br/>with Sessions]
    C -->|No| F{Need transactions?}
    F -->|Yes| E
    F -->|No| G{Simple queue?}
    G -->|Yes| H[Storage Queue]
    G -->|No| E
    
    D -->|Yes, long retention| I[Event Hubs]
    D -->|No| J{High volume?}
    J -->|>1M events/sec| I
    J -->|<1M events/sec| K{Azure events?}
    K -->|Yes| L[Event Grid]
    K -->|No| M{Push delivery?}
    M -->|Yes| L
    M -->|No| E
    
    style E fill:#1E90FF
    style L fill:#32CD32
    style I fill:#FF6347
    style H fill:#FFA500
</pre>

          <h2>Cost Comparison (Approximate)</h2>

          <table class="table table-striped">
            <thead>
              <tr>
                <th>Service</th>
                <th>Pricing Model</th>
                <th>Example Cost</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>Service Bus Basic</strong></td>
                <td>$0.05 per million operations</td>
                <td>10M operations = $0.50</td>
              </tr>
              <tr>
                <td><strong>Service Bus Standard</strong></td>
                <td>$10/month base + $0.05/M ops</td>
                <td>10M operations = $10.50</td>
              </tr>
              <tr>
                <td><strong>Service Bus Premium</strong></td>
                <td>$677.71/month per MU</td>
                <td>1 MU = $677.71 (unlimited ops)</td>
              </tr>
              <tr>
                <td><strong>Event Grid</strong></td>
                <td>$0.60 per million operations</td>
                <td>10M operations = $6.00</td>
              </tr>
              <tr>
                <td><strong>Event Hubs Basic</strong></td>
                <td>$0.028 per million events + $11.59 TU</td>
                <td>10M events = $11.87</td>
              </tr>
              <tr>
                <td><strong>Event Hubs Standard</strong></td>
                <td>$0.028 per million events + TU</td>
                <td>Variable based on TU</td>
              </tr>
              <tr>
                <td><strong>Storage Queues</strong></td>
                <td>$0.0036 per 10K transactions</td>
                <td>10M operations = $3.60</td>
              </tr>
            </tbody>
          </table>

          <p class="text-muted small">* Prices are approximate and vary by region. Check Azure Pricing Calculator for accurate estimates.</p>

          <h2>Summary</h2>

          <div class="callout">
            <strong>üéØ Quick Summary</strong><br />
            <strong>Service Bus:</strong> Enterprise messaging with reliability guarantees, ordering, and transactions<br />
            <strong>Event Grid:</strong> Reactive event distribution with push delivery and filtering<br />
            <strong>Event Hubs:</strong> Big data streaming for telemetry and high-volume ingestion<br />
            <strong>Storage Queues:</strong> Simple, cost-effective queuing for basic scenarios
          </div>

          <p><strong>Pro Tip:</strong> These services complement each other. Use multiple services in your architecture based on specific needs of each component.</p>
        </section>

        <!-- Resources Section -->
        <section id="resources" role="article">
          <h1>Resources</h1>
          <span class="badge">docs</span>
          <span class="badge">community</span>
          <span class="badge">links</span>
          
          <p>Comprehensive collection of official documentation, SDKs, tools, and learning resources for Azure Service Bus.</p>

          <h2>üìö Official Documentation</h2>

          <h3>Core Documentation</h3>
          <ul>
            <li><a href="https://learn.microsoft.com/azure/service-bus-messaging/" target="_blank">Azure Service Bus Documentation</a> - Official Microsoft documentation</li>
            <li><a href="https://learn.microsoft.com/azure/service-bus-messaging/service-bus-messaging-overview" target="_blank">Service Bus Overview</a> - What is Azure Service Bus</li>
            <li><a href="https://learn.microsoft.com/azure/service-bus-messaging/service-bus-quickstart-portal" target="_blank">Quickstart Guide</a> - Get started in 5 minutes</li>
            <li><a href="https://learn.microsoft.com/azure/service-bus-messaging/service-bus-messaging-sql-filter" target="_blank">Message Filtering</a> - SQL and correlation filters</li>
            <li><a href="https://learn.microsoft.com/azure/service-bus-messaging/message-sessions" target="_blank">Message Sessions</a> - FIFO and session-aware processing</li>
            <li><a href="https://learn.microsoft.com/azure/service-bus-messaging/service-bus-dead-letter-queues" target="_blank">Dead-Letter Queues</a> - Handle failed messages</li>
          </ul>

          <h3>Architecture & Best Practices</h3>
          <ul>
            <li><a href="https://learn.microsoft.com/azure/architecture/reference-architectures/enterprise-integration/queues-events" target="_blank">Messaging Patterns</a> - Enterprise integration patterns</li>
            <li><a href="https://learn.microsoft.com/azure/well-architected/service-guides/service-bus" target="_blank">Well-Architected Framework</a> - Service Bus guidance</li>
            <li><a href="https://learn.microsoft.com/azure/service-bus-messaging/service-bus-performance-improvements" target="_blank">Performance Best Practices</a> - Optimize throughput</li>
            <li><a href="https://learn.microsoft.com/azure/service-bus-messaging/service-bus-async-messaging" target="_blank">Asynchronous Messaging Patterns</a> - Async best practices</li>
          </ul>

          <h3>Security & Compliance</h3>
          <ul>
            <li><a href="https://learn.microsoft.com/azure/service-bus-messaging/service-bus-authentication-and-authorization" target="_blank">Authentication & Authorization</a> - AAD and SAS</li>
            <li><a href="https://learn.microsoft.com/azure/service-bus-messaging/network-security" target="_blank">Network Security</a> - Private endpoints, firewalls</li>
            <li><a href="https://learn.microsoft.com/azure/service-bus-messaging/service-bus-managed-service-identity" target="_blank">Managed Identities</a> - Passwordless authentication</li>
            <li><a href="https://learn.microsoft.com/azure/service-bus-messaging/message-encryption" target="_blank">Encryption</a> - Data encryption at rest and in transit</li>
          </ul>

          <h2>üõ†Ô∏è SDKs & Client Libraries</h2>

          <h3>.NET / C#</h3>
          <ul>
            <li><a href="https://www.nuget.org/packages/Azure.Messaging.ServiceBus" target="_blank">Azure.Messaging.ServiceBus</a> - Official .NET SDK (NuGet)</li>
            <li><a href="https://github.com/Azure/azure-sdk-for-net/tree/main/sdk/servicebus/Azure.Messaging.ServiceBus" target="_blank">GitHub Repository</a> - Source code and samples</li>
            <li><a href="https://learn.microsoft.com/dotnet/api/azure.messaging.servicebus" target="_blank">API Reference</a> - .NET API documentation</li>
            <li><a href="https://github.com/Azure/azure-sdk-for-net/tree/main/sdk/servicebus/Azure.Messaging.ServiceBus/samples" target="_blank">Code Samples</a> - .NET examples</li>
          </ul>

          <h3>Python</h3>
          <ul>
            <li><a href="https://pypi.org/project/azure-servicebus/" target="_blank">azure-servicebus</a> - Official Python SDK (PyPI)</li>
            <li><a href="https://github.com/Azure/azure-sdk-for-python/tree/main/sdk/servicebus/azure-servicebus" target="_blank">GitHub Repository</a> - Source code and samples</li>
            <li><a href="https://learn.microsoft.com/python/api/azure-servicebus/" target="_blank">API Reference</a> - Python API documentation</li>
            <li><a href="https://github.com/Azure/azure-sdk-for-python/tree/main/sdk/servicebus/azure-servicebus/samples" target="_blank">Code Samples</a> - Python examples</li>
          </ul>

          <h3>Java</h3>
          <ul>
            <li><a href="https://mvnrepository.com/artifact/com.azure/azure-messaging-servicebus" target="_blank">azure-messaging-servicebus</a> - Official Java SDK (Maven)</li>
            <li><a href="https://github.com/Azure/azure-sdk-for-java/tree/main/sdk/servicebus/azure-messaging-servicebus" target="_blank">GitHub Repository</a> - Source code and samples</li>
            <li><a href="https://learn.microsoft.com/java/api/overview/azure/messaging-servicebus-readme" target="_blank">API Reference</a> - Java API documentation</li>
            <li><a href="https://github.com/Azure/azure-sdk-for-java/tree/main/sdk/servicebus/azure-messaging-servicebus/src/samples" target="_blank">Code Samples</a> - Java examples</li>
          </ul>

          <h3>JavaScript / TypeScript</h3>
          <ul>
            <li><a href="https://www.npmjs.com/package/@azure/service-bus" target="_blank">@azure/service-bus</a> - Official JS/TS SDK (npm)</li>
            <li><a href="https://github.com/Azure/azure-sdk-for-js/tree/main/sdk/servicebus/service-bus" target="_blank">GitHub Repository</a> - Source code and samples</li>
            <li><a href="https://learn.microsoft.com/javascript/api/@azure/service-bus/" target="_blank">API Reference</a> - JavaScript API documentation</li>
            <li><a href="https://github.com/Azure/azure-sdk-for-js/tree/main/sdk/servicebus/service-bus/samples" target="_blank">Code Samples</a> - JavaScript/TypeScript examples</li>
          </ul>

          <h3>Go</h3>
          <ul>
            <li><a href="https://pkg.go.dev/github.com/Azure/azure-sdk-for-go/sdk/messaging/azservicebus" target="_blank">azservicebus</a> - Official Go SDK</li>
            <li><a href="https://github.com/Azure/azure-sdk-for-go/tree/main/sdk/messaging/azservicebus" target="_blank">GitHub Repository</a> - Source code and samples</li>
          </ul>

          <h2>üß∞ Tools & Extensions</h2>

          <h3>Visual Studio Code Extensions</h3>
          <ul>
            <li><a href="https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-azurestorage" target="_blank">Azure Storage</a> - Includes Service Bus explorer</li>
            <li><a href="https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-azurefunctions" target="_blank">Azure Functions</a> - Service Bus triggers</li>
          </ul>

          <h3>Management Tools</h3>
          <ul>
            <li><a href="https://portal.azure.com/" target="_blank">Azure Portal</a> - Web-based management</li>
            <li><a href="https://learn.microsoft.com/cli/azure/servicebus" target="_blank">Azure CLI</a> - Command-line interface</li>
            <li><a href="https://learn.microsoft.com/powershell/module/az.servicebus/" target="_blank">Azure PowerShell</a> - PowerShell cmdlets</li>
            <li><a href="https://github.com/paolosalvatori/ServiceBusExplorer" target="_blank">Service Bus Explorer</a> - Desktop GUI tool</li>
          </ul>

          <h3>Infrastructure as Code</h3>
          <ul>
            <li><a href="https://learn.microsoft.com/azure/templates/microsoft.servicebus/allversions" target="_blank">ARM Templates</a> - Azure Resource Manager</li>
            <li><a href="https://learn.microsoft.com/azure/azure-resource-manager/bicep/overview" target="_blank">Bicep</a> - Domain-specific language for Azure</li>
            <li><a href="https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/servicebus_namespace" target="_blank">Terraform</a> - HashiCorp Terraform provider</li>
            <li><a href="https://www.pulumi.com/registry/packages/azure-native/api-docs/servicebus/" target="_blank">Pulumi</a> - Modern IaC platform</li>
          </ul>

          <h2>üìñ Learning Resources</h2>

          <h3>Microsoft Learn Modules</h3>
          <ul>
            <li><a href="https://learn.microsoft.com/training/modules/choose-a-messaging-model-in-azure/" target="_blank">Choose a messaging model</a> - Decision guide</li>
            <li><a href="https://learn.microsoft.com/training/modules/implement-message-workflows-with-service-bus/" target="_blank">Implement message workflows</a> - Hands-on lab</li>
            <li><a href="https://learn.microsoft.com/training/modules/integrate-azure-service-bus/" target="_blank">Integrate with Service Bus</a> - Integration patterns</li>
          </ul>

          <h3>Video Tutorials</h3>
          <ul>
            <li><a href="https://www.youtube.com/c/MicrosoftAzure" target="_blank">Azure YouTube Channel</a> - Official videos</li>
            <li><a href="https://channel9.msdn.com/" target="_blank">Microsoft Channel 9</a> - Developer videos</li>
          </ul>

          <h3>Books & eBooks</h3>
          <ul>
            <li><a href="https://azure.microsoft.com/resources/" target="_blank">Azure Free eBooks</a> - Microsoft Press books</li>
            <li>"Enterprise Integration Patterns" by Hohpe & Woolf - Classic reference</li>
          </ul>

          <h2>üë• Community & Support</h2>

          <h3>Forums & Discussion</h3>
          <ul>
            <li><a href="https://learn.microsoft.com/answers/tags/72/azure-service-bus" target="_blank">Microsoft Q&A</a> - Official Q&A forum</li>
            <li><a href="https://stackoverflow.com/questions/tagged/azure-service-bus" target="_blank">Stack Overflow</a> - azure-service-bus tag</li>
            <li><a href="https://techcommunity.microsoft.com/" target="_blank">Microsoft Tech Community</a> - Community blogs</li>
            <li><a href="https://reddit.com/r/AZURE" target="_blank">r/AZURE</a> - Azure subreddit</li>
          </ul>

          <h3>Support Options</h3>
          <ul>
            <li><a href="https://azure.microsoft.com/support/plans/" target="_blank">Azure Support Plans</a> - Professional support</li>
            <li><a href="https://github.com/Azure/azure-sdk-for-net/issues" target="_blank">GitHub Issues</a> - SDK bug reports</li>
            <li><a href="https://feedback.azure.com/" target="_blank">Azure Feedback</a> - Feature requests</li>
          </ul>

          <h2>üìä Monitoring & Operations</h2>

          <h3>Monitoring Tools</h3>
          <ul>
            <li><a href="https://learn.microsoft.com/azure/azure-monitor/overview" target="_blank">Azure Monitor</a> - Metrics and logs</li>
            <li><a href="https://learn.microsoft.com/azure/azure-monitor/app/app-insights-overview" target="_blank">Application Insights</a> - APM and telemetry</li>
            <li><a href="https://learn.microsoft.com/azure/service-health/overview" target="_blank">Azure Service Health</a> - Platform status</li>
          </ul>

          <h3>Kusto Query Language (KQL)</h3>
          <ul>
            <li><a href="https://learn.microsoft.com/azure/data-explorer/kusto/query/" target="_blank">KQL Reference</a> - Query language documentation</li>
            <li><a href="https://learn.microsoft.com/azure/service-bus-messaging/monitor-service-bus-reference" target="_blank">Service Bus Monitoring Data</a> - Metrics and logs reference</li>
          </ul>

          <h2>üîß Integration Guides</h2>

          <h3>Azure Services Integration</h3>
          <ul>
            <li><a href="https://learn.microsoft.com/azure/azure-functions/functions-bindings-service-bus" target="_blank">Azure Functions</a> - Serverless triggers</li>
            <li><a href="https://learn.microsoft.com/azure/logic-apps/connectors/built-in/reference/servicebus" target="_blank">Logic Apps</a> - Workflow automation</li>
            <li><a href="https://learn.microsoft.com/azure/event-grid/handler-service-bus" target="_blank">Event Grid</a> - Event routing</li>
            <li><a href="https://learn.microsoft.com/azure/stream-analytics/stream-analytics-define-outputs#service-bus-queues" target="_blank">Stream Analytics</a> - Real-time processing</li>
          </ul>

          <h3>Third-Party Integrations</h3>
          <ul>
            <li><a href="https://learn.microsoft.com/azure/service-bus-messaging/service-bus-amqp-overview" target="_blank">AMQP 1.0 Protocol</a> - Standard protocol support</li>
            <li><a href="https://www.enterpriseintegrationpatterns.com/" target="_blank">Enterprise Integration Patterns</a> - Pattern catalog</li>
          </ul>

          <h2>üìù Code Samples & Examples</h2>

          <h3>Sample Repositories</h3>
          <ul>
            <li><a href="https://github.com/Azure/azure-service-bus/tree/master/samples" target="_blank">Official Samples Repository</a> - Multi-language samples</li>
            <li><a href="https://github.com/Azure-Samples/azure-servicebus-messaging-samples" target="_blank">Messaging Samples</a> - Common scenarios</li>
            <li><a href="https://github.com/Azure-Samples?q=servicebus" target="_blank">Azure Samples</a> - Filtered by Service Bus</li>
          </ul>

          <h3>Scenario-Based Examples</h3>
          <ul>
            <li><a href="https://learn.microsoft.com/azure/service-bus-messaging/service-bus-tutorial-topics-subscriptions-portal" target="_blank">Publish-Subscribe Tutorial</a> - Topics and subscriptions</li>
            <li><a href="https://learn.microsoft.com/azure/architecture/patterns/claim-check" target="_blank">Claim Check Pattern</a> - Large message handling</li>
            <li><a href="https://learn.microsoft.com/azure/architecture/patterns/competing-consumers" target="_blank">Competing Consumers</a> - Load distribution</li>
          </ul>

          <h2>üîç Troubleshooting</h2>

          <h3>Common Issues & Solutions</h3>
          <ul>
            <li><a href="https://learn.microsoft.com/azure/service-bus-messaging/service-bus-messaging-exceptions" target="_blank">Exception Handling</a> - Common exceptions</li>
            <li><a href="https://learn.microsoft.com/azure/service-bus-messaging/service-bus-troubleshooting-guide" target="_blank">Troubleshooting Guide</a> - Problem resolution</li>
            <li><a href="https://learn.microsoft.com/azure/service-bus-messaging/service-bus-diagnostic-logs" target="_blank">Diagnostic Logs</a> - Enable logging</li>
          </ul>

          <h2>üí∞ Pricing & Cost Management</h2>

          <h3>Pricing Information</h3>
          <ul>
            <li><a href="https://azure.microsoft.com/pricing/details/service-bus/" target="_blank">Service Bus Pricing</a> - Official pricing page</li>
            <li><a href="https://azure.microsoft.com/pricing/calculator/" target="_blank">Pricing Calculator</a> - Estimate costs</li>
            <li><a href="https://learn.microsoft.com/azure/service-bus-messaging/service-bus-premium-messaging" target="_blank">Premium Tier</a> - Premium features and pricing</li>
          </ul>

          <h2>üîî Stay Updated</h2>

          <h3>News & Updates</h3>
          <ul>
            <li><a href="https://azure.microsoft.com/updates/?product=service-bus" target="_blank">Azure Updates</a> - Service Bus announcements</li>
            <li><a href="https://azure.microsoft.com/blog/" target="_blank">Azure Blog</a> - Official blog</li>
            <li><a href="https://devblogs.microsoft.com/azure-sdk/" target="_blank">Azure SDK Blog</a> - SDK releases</li>
          </ul>

          <h3>Release Notes</h3>
          <ul>
            <li><a href="https://github.com/Azure/azure-sdk-for-net/blob/main/sdk/servicebus/Azure.Messaging.ServiceBus/CHANGELOG.md" target="_blank">.NET SDK Changelog</a></li>
            <li><a href="https://github.com/Azure/azure-sdk-for-python/blob/main/sdk/servicebus/azure-servicebus/CHANGELOG.md" target="_blank">Python SDK Changelog</a></li>
            <li><a href="https://github.com/Azure/azure-sdk-for-java/blob/main/sdk/servicebus/azure-messaging-servicebus/CHANGELOG.md" target="_blank">Java SDK Changelog</a></li>
            <li><a href="https://github.com/Azure/azure-sdk-for-js/blob/main/sdk/servicebus/service-bus/CHANGELOG.md" target="_blank">JavaScript SDK Changelog</a></li>
          </ul>

          <h2>üéì Certifications</h2>

          <h3>Relevant Azure Certifications</h3>
          <ul>
            <li><a href="https://learn.microsoft.com/certifications/azure-developer/" target="_blank">Azure Developer Associate (AZ-204)</a> - Includes Service Bus</li>
            <li><a href="https://learn.microsoft.com/certifications/azure-solutions-architect/" target="_blank">Azure Solutions Architect Expert (AZ-305)</a> - Architecture patterns</li>
            <li><a href="https://learn.microsoft.com/certifications/azure-integration-architect/" target="_blank">Azure Integration Architect</a> - Integration scenarios</li>
          </ul>

          <h2>üìã Quick Reference Cards</h2>

          <div class="callout">
            <strong>üîó Essential Links</strong><br />
            ‚Ä¢ <a href="https://learn.microsoft.com/azure/service-bus-messaging/" target="_blank">Documentation</a><br />
            ‚Ä¢ <a href="https://portal.azure.com/" target="_blank">Azure Portal</a><br />
            ‚Ä¢ <a href="https://azure.microsoft.com/pricing/details/service-bus/" target="_blank">Pricing</a><br />
            ‚Ä¢ <a href="https://azure.microsoft.com/support/plans/" target="_blank">Support</a><br />
            ‚Ä¢ <a href="https://github.com/Azure/azure-sdk-for-net/tree/main/sdk/servicebus" target="_blank">GitHub (.NET SDK)</a><br />
            ‚Ä¢ <a href="https://learn.microsoft.com/answers/tags/72/azure-service-bus" target="_blank">Q&A Forum</a>
          </div>

          <h2>üöÄ Next Steps</h2>

          <ol>
            <li><strong>Get Started:</strong> Create your first namespace and queue using the <a href="#tutorials">Tutorials</a> section</li>
            <li><strong>Learn Patterns:</strong> Explore <a href="#messaging-patterns">Messaging Patterns</a> for your use case</li>
            <li><strong>Follow Best Practices:</strong> Review <a href="#best-practices">Best Practices</a> for production readiness</li>
            <li><strong>Secure Your Setup:</strong> Implement <a href="#security">Security & Authentication</a> properly</li>
            <li><strong>Monitor:</strong> Set up <a href="#monitoring">Monitoring & Diagnostics</a> from day one</li>
            <li><strong>Join Community:</strong> Ask questions on <a href="https://learn.microsoft.com/answers/tags/72/azure-service-bus" target="_blank">Microsoft Q&A</a></li>
          </ol>

          <div class="callout">
            <strong>üí° Pro Tip</strong><br />
            Bookmark this page and the official documentation. Service Bus is powerful but has many features - having quick access to references will speed up your development.
          </div>

          <p class="text-center mt-5">
            <strong>Happy Messaging! üéâ</strong><br />
            <span class="text-muted">Questions or feedback? Reach out via Microsoft Q&A or GitHub Issues.</span>
          </p>

          <hr />
          <div class="document-footer">
            <p>
              <strong>Last Updated:</strong> January 2026 | 
              <strong>Curated by:</strong> Murthy Vepa with ‚ù§Ô∏è | <strong>Powered by:</strong> GitHub Copilot
            </p>
          </div>
        </section>

        
        </div>
      </main>
    </div>
    
    <nav class="controls" role="navigation" aria-label="Pagination">
      <div class="btn-group" role="group">
        <button class="btn btn-outline-info btn-sm" id="prevBtn" title="Previous" aria-label="Previous concept">&nbsp;&lt;&nbsp;</button>
        <button class="btn btn-outline-info btn-sm" id="nextBtn" title="Next" aria-label="Next concept">&nbsp;&gt;&nbsp;</button>
      </div>
    </nav>
  </div>  <div class="offcanvas offcanvas-start" tabindex="-1" id="sidebarOffcanvas" aria-labelledby="sidebarLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="sidebarLabel">Contents</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body p-0">
      <ul class="list-group list-group-flush w-100" id="tocMobile"></ul>
    </div>
  </div>

  <script>
    // ---- Mermaid Initialization ----
    document.addEventListener('DOMContentLoaded', () => {
      if (window.mermaid) {
        window.mermaid.contentLoaded();
      }
    });

    // ---- Configuration ----
    const sectionConfig = [
      { id: "overview", title: "üìñ Overview", tags: ["intro", "overview", "basics"] },
      { id: "key-components", title: "üß© Key Components", tags: ["components", "namespaces", "queues", "topics"] },
      { id: "messaging-patterns", title: "üì® Messaging Patterns", tags: ["patterns", "queue", "pubsub", "messaging"] },
      { id: "advanced-features", title: "‚ö° Advanced Features", tags: ["advanced", "sessions", "transactions", "deadletter"] },
      { id: "key-concepts", title: "üí° Key Concepts", tags: ["concepts", "messages", "routing", "filters"] },
      { id: "security", title: "üîí Security & Authentication", tags: ["security", "authentication", "authorization", "sas"] },
      { id: "integration", title: "üîó Integration", tags: ["integration", "azure", "eventgrid", "logicapps"] },
      { id: "monitoring", title: "üìä Monitoring & Diagnostics", tags: ["monitoring", "diagnostics", "metrics", "alerts"] },
      { id: "tutorials", title: "üéì Getting Started & Tutorials", tags: ["tutorials", "quickstart", "getting-started"] },
      { id: "best-practices", title: "‚ú® Best Practices", tags: ["best-practices", "recommendations", "performance"] },
      { id: "comparison", title: "‚öñÔ∏è Service Comparison", tags: ["comparison", "vs", "eventgrid", "eventhub"] },
      { id: "resources", title: "üìö Resources", tags: ["docs", "community", "links"] }
    ];

    // ---- State & rendering ----
    const state = {
      index: 0,
      filtered: sectionConfig.map((_, i) => i), // indices
    };

    const els = {
      toc: document.getElementById('toc'),
      tocMobile: document.getElementById('tocMobile'),
      prev: document.getElementById('prevBtn'),
      next: document.getElementById('nextBtn'),
      toggleSidebar: document.getElementById('toggleSidebar'),
      themeToggle: document.getElementById('themeToggle'),
      main: document.getElementById('main'),
      sidebar: document.querySelector('nav.sidebar'),
      sidebarOffcanvas: document.getElementById('sidebarOffcanvas')
    };

    function buildTOC(){
      // Clear both TOC lists
      els.toc.innerHTML = '';
      els.tocMobile.innerHTML = '';
      
      state.filtered.forEach((idx) => {
        const s = sectionConfig[idx];
        
        // Desktop sidebar
        const liDesktop = document.createElement('li');
        liDesktop.className = 'list-group-item';
        const aDesktop = document.createElement('a');
        aDesktop.href = `#${s.id}`;
        aDesktop.textContent = s.title;
        aDesktop.addEventListener('click', (e) => {
          e.preventDefault();
          navigateToId(s.id);
          closeSidebar();
        });
        liDesktop.appendChild(aDesktop);
        els.toc.appendChild(liDesktop);
        
        // Mobile offcanvas
        const liMobile = document.createElement('li');
        liMobile.className = 'list-group-item';
        const aMobile = document.createElement('a');
        aMobile.href = `#${s.id}`;
        aMobile.textContent = s.title;
        aMobile.addEventListener('click', (e) => {
          e.preventDefault();
          navigateToId(s.id);
          closeSidebar();
        });
        liMobile.appendChild(aMobile);
        els.tocMobile.appendChild(liMobile);
      });
      highlightActiveTOC();
    }

    function setActiveByIndex(i){
      const ids = state.filtered.map(idx => sectionConfig[idx].id);
      document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
      const id = ids[i];
      const active = document.getElementById(id);
      if (active){
        active.classList.add('active');
        active.setAttribute('tabindex', '-1');
        active.focus({preventScroll:true});
      }
      updateControls();
      highlightActiveTOC();
      updateURLHash(id);
    }

    function updateControls(){
      const count = state.filtered.length;
      els.prev.disabled = state.index <= 0;
      els.next.disabled = state.index >= count - 1;
    }

    function filterTOC(query){
      const q = query.trim().toLowerCase();
      state.filtered = sectionConfig
        .map((s, i) => ({s, i}))
        .filter(({s}) => s.title.toLowerCase().includes(q) || s.tags.some(t => t.toLowerCase().includes(q)))
        .map(({i}) => i);

      state.index = Math.min(state.index, Math.max(0, state.filtered.length - 1));
      buildTOC();
      setActiveByIndex(state.index);
    }

    function navigate(delta){
      const count = state.filtered.length;
      const nextIndex = Math.min(Math.max(state.index + delta, 0), count - 1);
      if (nextIndex !== state.index){
        state.index = nextIndex;
        setActiveByIndex(state.index);
        // Scroll content to top
        const contentEl = document.querySelector('.content');
        if (contentEl) contentEl.scrollTop = 0;
      }
    }

    function navigateToId(id){
      const idxInFiltered = state.filtered.findIndex(fi => sectionConfig[fi].id === id);
      if (idxInFiltered !== -1){
        state.index = idxInFiltered;
        setActiveByIndex(state.index);
        // Scroll content to top
        const contentEl = document.querySelector('.content');
        if (contentEl) contentEl.scrollTop = 0;
      } else {
        state.filtered = sectionConfig.map((_, i) => i);
        buildTOC();
        navigateToId(id);
      }
    }

    function updateURLHash(id){
      const url = new URL(window.location);
      url.hash = id;
      history.replaceState(null, '', url);
    }

    function highlightActiveTOC(){
      const ids = state.filtered.map(idx => sectionConfig[idx].id);
      const activeId = ids[state.index];
      // Highlight desktop sidebar
      els.toc.querySelectorAll('a').forEach(a => a.classList.toggle('active', a.getAttribute('href') === `#${activeId}`));
      // Highlight mobile offcanvas
      els.tocMobile.querySelectorAll('a').forEach(a => a.classList.toggle('active', a.getAttribute('href') === `#${activeId}`));
    }

    function openSidebar(){
      const offcanvas = new bootstrap.Offcanvas(document.getElementById('sidebarOffcanvas'));
      offcanvas.show();
    }
    function closeSidebar(){
      const offcanvasElement = document.getElementById('sidebarOffcanvas');
      const offcanvas = bootstrap.Offcanvas.getInstance(offcanvasElement);
      if(offcanvas) offcanvas.hide();
    }

    // ---- Events ----
    els.prev.addEventListener('click', () => navigate(-1));
    els.next.addEventListener('click', () => navigate(1));

    // Keyboard navigation
    window.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') navigate(-1);
      else if (e.key === 'ArrowRight') navigate(1);
      else if (e.key === 'Escape') closeSidebar();
    });

    // Deep linking on load/hash change
    window.addEventListener('hashchange', () => {
      const id = location.hash.replace('#','');
      if (id) navigateToId(id);
    });

    // Sidebar toggle (mobile)
    els.toggleSidebar.addEventListener('click', () => {
      openSidebar();
    });

    // Restore theme
    (function(){
      try {
        const saved = localStorage.getItem('concepts-theme');
        if (saved) { 
          document.documentElement.setAttribute('data-theme', saved);
          els.themeToggle.textContent = saved === 'light' ? 'üåó' : 'üåô';
        }
      } catch {}
    })();

    // Initial render
    buildTOC();

    // Navigate to hash if present, otherwise show first section
    const initialId = location.hash.replace('#','');
    if (initialId){ 
      navigateToId(initialId); 
    } else {
      setActiveByIndex(0);
      // Scroll content to top on initial load
      const contentEl = document.querySelector('.content');
      if (contentEl) contentEl.scrollTop = 0;
    }

  </script>
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>